<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’åŠ¨ç”Ÿæ—¥è´ºå¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Kalam:wght@400;700&family=Fredoka:wght@400;600&family=Bubblegum+Sans&family=Quicksand:wght@500;700&family=Chewy&family=Luckiest+Guy&family=Permanent+Marker&display=swap');
        
        body {
            font-family: 'Comic Neue', 'Kalam', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #ffe4e1; /* æ”¹ä¸ºä¸å®¹å™¨ä¸€è‡´çš„çº¯è‰²èƒŒæ™¯ */
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        /* çƒŸèŠ±èƒŒæ™¯å®¹å™¨ */
        .fireworks-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        /* çƒŸèŠ±ç²’å­ */
        .firework-particle {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
            animation: fireworkFade 2s ease-out forwards;
        }

        /* æµæ˜Ÿé›¨å®¹å™¨ */
        .meteor-shower {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        /* æµæ˜Ÿæ ·å¼ */
        .meteor {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 
                0 0 10px 2px rgba(255, 255, 255, 0.8),
                0 0 20px 4px rgba(255, 182, 193, 0.6),
                0 0 30px 6px rgba(255, 105, 180, 0.4);
            pointer-events: none;
        }

        /* æµæ˜Ÿå°¾å·´ */
        .meteor::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 80px;
            height: 2px;
            background: linear-gradient(to left, 
                transparent 0%, 
                rgba(255, 255, 255, 0.1) 30%,
                rgba(255, 255, 255, 0.3) 60%,
                rgba(255, 182, 193, 0.5) 80%,
                rgba(255, 105, 180, 0.8) 95%,
                #fff 100%
            );
            transform-origin: right center;
            animation: meteorFade 1.5s ease-in infinite;
        }

        @keyframes meteorFall {
            0% {
                transform: translate(0, 0) rotate(-135deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translate(-400px, 400px) rotate(-135deg);
                opacity: 0;
            }
        }

        @keyframes meteorFade {
            0% {
                opacity: 0;
                transform: scaleX(0);
            }
            50% {
                opacity: 1;
                transform: scaleX(1);
            }
            100% {
                opacity: 0;
                transform: scaleX(0.3);
            }
        }

        @keyframes fireworkFade {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.3);
            }
        }
        
        /* å¼€å§‹é¡µé¢æ ·å¼ */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffe4e1; /* æ”¹ä¸ºä¸ä¸»é¡µé¢ä¸€è‡´çš„çº¯è‰²èƒŒæ™¯ */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.8s ease-out;
            overflow: hidden; /* ç¡®ä¿ç²’å­ä¸æº¢å‡º */
        }

        /* å¼€å§‹é¡µé¢ä¸“ç”¨ç²’å­å®¹å™¨ */
        .start-screen-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        /* è‡ªå®šä¹‰é¼ æ ‡æ ·å¼ */
        body {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8" fill="%23ff69b4" opacity="0.8"/><circle cx="12" cy="12" r="3" fill="%23fff"/></svg>') 12 12, auto;
        }

        /* å¯ç‚¹å‡»å…ƒç´ çš„é¼ æ ‡æ ·å¼ */
        .clickable-hover {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28"><circle cx="14" cy="14" r="10" fill="%23ff1493" opacity="0.9"/><circle cx="14" cy="14" r="4" fill="%23fff"/><circle cx="14" cy="14" r="2" fill="%23ff69b4"/></svg>') 14 14, pointer;
        }

        /* æ‹–åŠ¨æ—¶çš„é¼ æ ‡æ ·å¼ */
        .dragging-cursor {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="12" fill="%23ff85a2" opacity="0.95"/><path d="M12 16 L20 16 M16 12 L16 20" stroke="%23fff" stroke-width="2" stroke-linecap="round"/></svg>') 16 16, grabbing;
        }

        /* ä¸Šä¸‹æ‹–åŠ¨ä¸“ç”¨é¼ æ ‡æ ·å¼ */
        .vertical-drag-cursor {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30"><circle cx="15" cy="15" r="11" fill="%23ffb6c1" opacity="0.9"/><path d="M15 8 L15 22 M10 13 L15 8 L20 13 M10 17 L15 22 L20 17" stroke="%23fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>') 15 15, ns-resize;
        }

        /* é¼ æ ‡æ‚¬åœæ•ˆæœ */
        .hover-glow {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hover-glow:hover {
            filter: drop-shadow(0 0 12px rgba(255, 105, 180, 0.6));
            transform: scale(1.05);
        }

        /* ç‰¹æ®Šå…ƒç´ çš„é¼ æ ‡æ ·å¼ */
        .special-cursor {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><polygon points="13,2 16,9 23,9 17,14 20,21 13,16 6,21 9,14 3,9 10,9" fill="%23ffd700" stroke="%23fff" stroke-width="1"/></svg>') 13 13, pointer;
        }

        /* é¼ æ ‡è·Ÿéšå…‰æ™•æ•ˆæœ */
        .mouse-glow {
            position: fixed;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 105, 180, 0.3) 0%, transparent 70%);
            pointer-events: none;
            z-index: 9999;
            transform: translate(-50%, -50%);
            transition: all 0.2s ease-out;
            animation: glowPulse 2s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.8;
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
        }

        /* é¼ æ ‡ç‚¹å‡»æ³¢çº¹æ•ˆæœ */
        .click-ripple {
            position: fixed;
            border-radius: 50%;
            border: 2px solid rgba(255, 105, 180, 0.6);
            pointer-events: none;
            z-index: 9998;
            animation: ripple 0.6s ease-out forwards;
        }

        @keyframes ripple {
            0% {
                width: 0;
                height: 0;
                opacity: 1;
            }
            100% {
                width: 60px;
                height: 60px;
                opacity: 0;
            }
        }

        /* å¼€å§‹é¡µé¢ç²’å­æ ·å¼ */
        .start-particle {
            position: absolute;
            pointer-events: none;
            opacity: 0;
            animation: startParticleFloat 3s ease-in-out infinite;
        }

        @keyframes startParticleFloat {
            0% {
                opacity: 0;
                transform: translateY(100vh) scale(0);
            }
            20% {
                opacity: 0.8;
                transform: translateY(70vh) scale(1);
            }
            50% {
                opacity: 1;
                transform: translateY(40vh) scale(1);
            }
            80% {
                opacity: 0.8;
                transform: translateY(10vh) scale(0.8);
            }
            100% {
                opacity: 0;
                transform: translateY(-10vh) scale(0.5);
            }
        }

        /* æ˜Ÿæ˜Ÿç²’å­ - å¤§å¹…å¢å¤§ */
        .start-particle.star {
            width: 20px;
            height: 20px;
            background: #ffc0cb;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }

        /* å¿ƒå½¢ç²’å­ - å¤§å¹…å¢å¤§ */
        .start-particle.heart {
            width: 24px;
            height: 22px;
            background: #ff69b4;
            clip-path: path('M4,6 C4,6 2,4 2,2 C2,1 3,0 4,1 C4,0 5,1 5,2 C5,4 4,6 4,6 Z');
        }

        /* åœ†å½¢ç²’å­ - å¤§å¹…å¢å¤§ */
        .start-particle.circle {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #ffffff;
        }

        .start-button {
            padding: 20px 60px;
            font-size: 28px;
            font-weight: bold;
            color: #fff;
            background: linear-gradient(135deg, #ffb6d1 0%, #ff85a2 50%, #ffa6c1 100%);
            border: none;
            border-radius: 60px;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28"><circle cx="14" cy="14" r="10" fill="%23ff1493" opacity="0.9"/><circle cx="14" cy="14" r="4" fill="%23fff"/><circle cx="14" cy="14" r="2" fill="%23ff69b4"/></svg>') 14 14, pointer;
            box-shadow: 
                0 15px 35px rgba(255, 182, 193, 0.4),
                0 8px 20px rgba(255, 192, 203, 0.3),
                inset 0 4px 8px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            font-family: 'Comic Neue', 'Kalam', cursive;
            animation: startButtonPulse 2s ease-in-out infinite;
            z-index: 10000;
            position: relative;
        }

        .start-button:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 
                0 20px 45px rgba(255, 182, 193, 0.5),
                0 12px 30px rgba(255, 192, 203, 0.4),
                inset 0 4px 8px rgba(255, 255, 255, 0.4);
            background: linear-gradient(135deg, #ffc1db 0%, #ffb6d1 50%, #ff85a2 100%);
        }

        .start-button:active {
            transform: translateY(-2px) scale(1.05);
        }

        @keyframes startButtonPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .card-container {
            width: 100%;
            max-width: 500px;
            height: 600px;
            background: #ffe4e1; /* æ”¹ä¸ºçº¯è‰²èƒŒæ™¯ï¼Œç¡®ä¿æ‹–åŠ¨æ—¶èƒŒæ™¯ä¸€è‡´ */
            border-radius: 40px;
            box-shadow: 
                0 25px 50px rgba(255, 182, 193, 0.3),
                0 15px 30px rgba(255, 192, 203, 0.2),
                inset 0 4px 8px rgba(255, 255, 255, 0.8);
            position: relative;
            overflow: hidden; /* æ”¹ä¸ºéšè—ï¼Œæ‹–åŠ¨è¶…å‡ºè¾¹ç•Œçš„å†…å®¹çœ‹ä¸è§ */
            border: 3px solid #ffb6c1;
        }
        
        .initial-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }
        
        /* ç»Ÿä¸€çš„ç¤¼ç›’æ ·å¼ - åªä¿ç•™ä¸€ä¸ªå®šä¹‰ */
        #gift-box {
            position: relative !important;
            left: auto !important;
            top: auto !important;
            transform: none !important;
            margin: 0 auto !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 10 !important;
            pointer-events: auto !important;
            width: 160px !important;
            height: 160px !important;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><polygon points="13,2 16,9 23,9 17,14 20,21 13,16 6,21 9,14 3,9 10,9" fill="%23ffd700" stroke="%23fff" stroke-width="1"/></svg>') 13 13, pointer !important;
            perspective: 1000px !important;
        }
        
        /* é˜²æ­¢ä»£ç æ˜¾ç¤º - éšè—ä»»ä½•å¯èƒ½çš„æ–‡æœ¬å†…å®¹ */
        #gift-box script, #gift-box style:not([id]), #gift-box noscript {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        /* é˜²æ­¢åŠ¨ç”»è¿‡ç¨‹ä¸­æ˜¾ç¤ºåŸå§‹ä»£ç  */
        code, pre, .debug-info, script:not([src]), noscript {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            position: absolute !important;
            left: -9999px !important;
            top: -9999px !important;
        }
        
        /* é˜²æ­¢ä»»ä½•æ–‡æœ¬èŠ‚ç‚¹æ„å¤–æ˜¾ç¤º */
        .card-container text-node,
        .initial-screen text-node,
        #gift-box text-node {
            display: none !important;
        }
        
        .hint-text {
            margin-top: 30px;
            color: #5d7b9c;
            font-size: 20px;
            text-align: center;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.7);
            animation: pulse 2s infinite;
            z-index: 5;
            pointer-events: none;
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; transform: scale(0.95); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.7; transform: scale(0.95); }
        }
        
        .birthday-text {
            position: absolute;
            top: 65%;
            left: 50%;
            transform: translate(-50%, -50%) scale(1);
            font-size: 76px;
            color: #ff1493;
            text-align: center;
            opacity: 0;
            z-index: 800;
            text-shadow: 
                5px 5px 10px rgba(0, 0, 0, 0.25),
                -4px -4px 8px rgba(255, 255, 255, 0.95),
                3px 3px 6px rgba(255, 182, 193, 0.85),
                0 0 15px rgba(255, 20, 147, 0.5),
                0 0 30px rgba(255, 105, 180, 0.35),
                2px -2px 6px rgba(255, 192, 203, 0.7);
            font-weight: 900;
            transition: opacity 0.6s ease, transform 0.6s ease;
            pointer-events: none;
            letter-spacing: 12px;
            font-family: 'Chewy', 'Luckiest Guy', 'Bubblegum Sans', 'Fredoka', 'Comic Neue', 'Kalam', 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: linear-gradient(180deg, #ff69b4 0%, #ff1493 30%, #ff85a2 60%, #ff69b4 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: cuteBounce 2.5s ease-in-out infinite;
            white-space: nowrap;
            -webkit-text-stroke: 2px rgba(255, 255, 255, 0.6);
            text-stroke: 2px rgba(255, 255, 255, 0.6);
            filter: contrast(1.2) brightness(1.1);
        }

        /* ç”Ÿæ—¥æ–‡å­—å…¥åœºåŠ¨ç”»ï¼šå¼¹å‡ºå¹¶å‘å…‰ - æ›´æ¸…æ™° */
        @keyframes birthdayPop {
            0% { 
                transform: translate(-50%, -50%) scale(0.6); 
                opacity: 0; 
                filter: blur(3px) brightness(0.5);
            }
            30% { 
                transform: translate(-50%, -50%) scale(1.1); 
                opacity: 0.8; 
                filter: blur(0px) brightness(1.3);
            }
            60% { 
                transform: translate(-50%, -50%) scale(1.08); 
                opacity: 1; 
                filter: blur(0px) brightness(1.2);
            }
            100% { 
                transform: translate(-50%, -50%) scale(1); 
                opacity: 1; 
                filter: blur(0px) brightness(1.1);
            }
        }

        /* å¯çˆ±å¼¹è·³åŠ¨ç”» - æ›´æ¸©å’Œçš„ç§»åŠ¨ */
        @keyframes cuteBounce {
            0%, 100% { transform: translate(-50%, -50%) translateY(0) rotate(0deg); }
            25% { transform: translate(-50%, -50%) translateY(-5px) rotate(-1deg); }
            50% { transform: translate(-50%, -50%) translateY(2px) rotate(0.5deg); }
            75% { transform: translate(-50%, -50%) translateY(-2px) rotate(-0.5deg); }
        }

        /* æ¯ä¸ªå­—çš„ç‹¬ç«‹åŠ¨ç”» - æ›´å¯çˆ±æœ‰è¶£çš„åŠ¨ç”» */
        .birthday-text span {
            display: inline-block;
            animation: letterDance 2.2s ease-in-out infinite;
            position: relative;
            font-style: normal;
            text-decoration: none;
        }

        .birthday-text span:nth-child(1) { 
            animation-delay: 0s; 
            color: #ff69b4;
        }
        .birthday-text span:nth-child(2) { 
            animation-delay: 0.3s; 
            color: #ff1493;
        }
        .birthday-text span:nth-child(3) { 
            animation-delay: 0.6s; 
            color: #ff85a2;
        }
        .birthday-text span:nth-child(4) { 
            animation-delay: 0.9s; 
            color: #ff69b4;
        }

        /* ä¸ºæ¯ä¸ªå­—æ·»åŠ å°è£…é¥° */
        .birthday-text span::after {
            content: 'âœ¨';
            position: absolute;
            top: -15px;
            right: -8px;
            font-size: 12px;
            opacity: 0;
            animation: sparkle 3s ease-in-out infinite;
            pointer-events: none;
        }

        .birthday-text span:nth-child(1)::after { animation-delay: 0.5s; }
        .birthday-text span:nth-child(2)::after { animation-delay: 1.0s; }
        .birthday-text span:nth-child(3)::after { animation-delay: 1.5s; }
        .birthday-text span:nth-child(4)::after { animation-delay: 2.0s; }

        @keyframes sparkle {
            0%, 80%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
            85% { opacity: 1; transform: scale(1) rotate(180deg); }
            95% { opacity: 0.8; transform: scale(1.2) rotate(360deg); }
        }

        @keyframes cakeBounce {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.9; }
            25% { transform: scale(1.1) rotate(-5deg); opacity: 1; }
            50% { transform: scale(0.98) rotate(3deg); opacity: 0.8; }
            75% { transform: scale(1.05) rotate(-2deg); opacity: 0.95; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(2deg); }
            50% { transform: translateY(-5px) rotate(-1deg); }
            75% { transform: translateY(-12px) rotate(1deg); }
        }

        @keyframes letterDance {
            0%, 100% { 
                transform: translateY(0) rotate(0deg) scale(1); 
                filter: brightness(1) drop-shadow(0 0 10px rgba(255, 20, 147, 0.4));
            }
            20% { 
                transform: translateY(-3px) rotate(-2deg) scale(1.06); 
                filter: brightness(1.25) drop-shadow(0 0 15px rgba(255, 20, 147, 0.6));
            }
            40% { 
                transform: translateY(2px) rotate(1deg) scale(1.02); 
                filter: brightness(1.15) drop-shadow(0 0 12px rgba(255, 105, 180, 0.5));
            }
            60% { 
                transform: translateY(-2px) rotate(-0.5deg) scale(1.03); 
                filter: brightness(1.2) drop-shadow(0 0 14px rgba(255, 182, 193, 0.55));
            }
            80% { 
                transform: translateY(1px) rotate(0.3deg) scale(0.99); 
                filter: brightness(1.1) drop-shadow(0 0 8px rgba(255, 20, 147, 0.45));
            }
        }

        .birthday-entrance {
            animation: birthdayPop 700ms cubic-bezier(.2,.9,.2,1) forwards;
            color: #fffdf9;
        }
        
        .animation-container {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            overflow: hidden;
        }

        /* åŸºç¡€æ°”çƒæ ·å¼ */
        .balloon {
            position: absolute;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><circle cx="13" cy="13" r="9" fill="%23ff69b4" opacity="0.8"/><circle cx="13" cy="13" r="3" fill="%23fff"/></svg>') 13 13, pointer;
            pointer-events: auto;
            transition: all 0.3s ease;
            z-index: 600;
        }
        
        /* æ¤­åœ†å½¢æ°”çƒ */
        .balloon.ellipse {
            background: 
                radial-gradient(circle at 30% 30%, #ffffff 40%, transparent 50%),
                radial-gradient(circle at 70% 30%, #ffffff 30%, transparent 40%),
                radial-gradient(circle at 50% 50%, #ffc0cb 20%, #ffb6c1 50%, #ff69b4 100%);
            width: 75px;
            height: 55px;
            border-radius: 50%;
            box-shadow: 
                0 12px 30px rgba(255, 182, 193, 0.5),
                0 6px 18px rgba(255, 192, 203, 0.4),
                inset 0 3px 8px rgba(255, 255, 255, 0.8),
                inset 0 -2px 6px rgba(255, 105, 180, 0.3);
            animation: ellipseFloat 3.5s ease-in-out infinite;
        }
        
        @keyframes ellipseFloat {
            0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
            25% { transform: translateY(-8px) rotate(2deg) scale(1.03); }
            50% { transform: translateY(-4px) rotate(-1deg) scale(0.98); }
            75% { transform: translateY(-10px) rotate(1deg) scale(1.01); }
        }
        
        .balloon.ellipse:hover {
            animation-play-state: paused;
            transform: translateY(-7px) rotate(3deg) scale(1.15);
        }
        
        .balloon::before {
            content: '';
            position: absolute;
            width: 18px;
            height: 12px;
            background: inherit;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            border-radius: 0 0 8px 0;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.15);
        }
        
        /* æ˜Ÿæ˜Ÿæ°”çƒ */
        .balloon.star {
            background: 
                radial-gradient(circle at 25% 25%, #ffffff 20%, transparent 30%),
                radial-gradient(circle at 75% 25%, #ffffff 15%, transparent 25%),
                radial-gradient(circle at 50% 50%, #ffc0cb 30%, #ffb6c1 60%, #ff85a2 100%);
            width: 80px;
            height: 80px;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            box-shadow: 
                0 15px 35px rgba(255, 182, 193, 0.5),
                0 8px 20px rgba(255, 192, 203, 0.4),
                inset 0 3px 8px rgba(255, 255, 255, 0.8),
                inset 0 -2px 6px rgba(255, 140, 162, 0.3);
            animation: starFloat 3s ease-in-out infinite, sparkle 2s ease-in-out infinite;
            position: relative;
        }
        
        @keyframes starFloat {
            0%, 100% { transform: translateY(0) rotate(-5deg) scale(1); }
            25% { transform: translateY(-10px) rotate(3deg) scale(1.02); }
            50% { transform: translateY(-5px) rotate(-3deg) scale(0.98); }
            75% { transform: translateY(-12px) rotate(2deg) scale(1.01); }
        }
        
        @keyframes sparkle {
            0%, 100% { filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.25)) brightness(1); }
            50% { filter: drop-shadow(0 12px 24px rgba(255, 215, 0, 0.4)) brightness(1.2); }
        }
        
        /* çˆ±å¿ƒæ°”çƒ - æ›´åŠ é¥±æ»¡åœ†æ¶¦ */
        .balloon.heart {
            background: 
                radial-gradient(circle at 30% 30%, #ffffff 40%, transparent 45%),
                radial-gradient(circle at 70% 30%, #ffffff 30%, transparent 35%),
                radial-gradient(circle at 50% 50%, #ffc0cb 25%, #ffb6c1 50%, #ff69b4 100%);
            width: 70px;
            height: 65px;
            position: relative;
            clip-path: path('M35,60 C35,60 10,40 10,20 C10,10 15,5 25,5 C30,5 35,8 35,15 C35,8 40,5 45,5 C55,5 60,10 60,20 C60,40 35,60 35,60 Z');
            box-shadow: 
                0 15px 35px rgba(255, 182, 193, 0.5),
                0 8px 20px rgba(255, 192, 203, 0.4),
                inset 0 4px 10px rgba(255, 255, 255, 0.8),
                inset 0 -3px 8px rgba(255, 105, 180, 0.3);
            animation: heartPulse 2.5s ease-in-out infinite;
            transform: rotate(-8deg);
        }
        
        @keyframes heartPulse {
            0%, 100% { transform: rotate(-8deg) scale(1); }
            20% { transform: rotate(-5deg) scale(1.08); }
            40% { transform: rotate(-10deg) scale(1.03); }
            60% { transform: rotate(-6deg) scale(1.06); }
            80% { transform: rotate(-9deg) scale(1.02); }
        }
        

        
        .balloon:hover {
            filter: drop-shadow(0 12px 24px rgba(0, 0, 0, 0.35)) brightness(1.1);
            z-index: 1000;
        }
        
        .balloon.star:hover {
            animation-play-state: paused;
            transform: translateY(-5px) rotate(10deg) scale(1.15);
        }
        
        .balloon.heart:hover {
            animation-play-state: paused;
            transform: translateY(-8px) rotate(-5deg) scale(1.2);
        }
        

        
        .balloon.dragging {
            filter: drop-shadow(0 15px 30px rgba(0, 0, 0, 0.4)) brightness(1.2) saturate(1.1);
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="12" fill="%23ff85a2" opacity="0.95"/><path d="M12 16 L20 16 M16 12 L16 20" stroke="%23fff" stroke-width="2" stroke-linecap="round"/></svg>') 16 16, grabbing !important;
            transform: scale(1.05);
            transition: none !important;
        }
        
        /* çˆ±å¿ƒæŒ‰é’®æ ·å¼ */
        .heart-button {
            position: absolute;
            bottom: 30px;
            right: 30px;
            transform: scale(0);
            background: transparent;
            border: none;
            width: 60px;
            height: 60px;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28"><circle cx="14" cy="14" r="10" fill="%23ff1493" opacity="0.9"/><circle cx="14" cy="14" r="4" fill="%23fff"/><circle cx="14" cy="14" r="2" fill="%23ff69b4"/></svg>') 14 14, pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 801;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
        }
        
        .heart-button.show {
            transform: scale(1);
            opacity: 1;
            animation: heartButtonPulse 2s ease-in-out infinite;
        }
        
        .heart-button:hover {
            transform: scale(1.15);
        }
        
        .heart-button:active {
            transform: scale(1.05);
        }
        
        .cake-icon {
            font-size: 32px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3)) brightness(1.1);
            animation: cakeBounce 1.5s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.9) 0%, rgba(255, 182, 193, 0.8) 100%);
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 
                0 6px 12px rgba(255, 182, 193, 0.4),
                inset 0 2px 4px rgba(255, 255, 255, 0.8);
        }
        
        @keyframes heartButtonPulse {
            0%, 100% { 
                transform: scale(1);
            }
            50% { 
                transform: scale(1.08);
            }
        }
        

        

        
        // ç®­å¤´å‘å…‰åŠ¨ç”»
        @keyframes arrowGlow {
            0%, 100% { 
                opacity: 0.3; 
                transform: scale(1); 
            }
            50% { 
                opacity: 0.8; 
                transform: scale(1.2); 
            }
        }
        
        // ç®­å¤´æ‘‡æ‘†åŠ¨ç”»
        @keyframes arrowBounce {
            0%, 100% { 
                transform: rotate(0deg) translateX(0) scale(1); 
            }
            25% { 
                transform: rotate(5deg) translateX(5px) scale(1.1); 
            }
            50% { 
                transform: -5deg translateX(-3px) scale(1.05); 
            }
            75% { 
                transform: 3deg translateX(3px) scale(1.08); 
            }
        }
        
        /* çˆ±å¿ƒæŒ‰é’®æ ·å¼ */
        .love-button {
            position: relative;
            background: linear-gradient(135deg, #ffb6d1 0%, #ff85a2 50%, #ffa6c1 100%);
            border: none;
            border-radius: 15px;
            width: 200px;
            height: 60px;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28"><circle cx="14" cy="14" r="10" fill="%23ff1493" opacity="0.9"/><circle cx="14" cy="14" r="4" fill="%23fff"/><circle cx="14" cy="14" r="2" fill="%23ff69b4"/></svg>') 14 14, pointer;
            box-shadow: 
                0 10px 25px rgba(255, 182, 193, 0.4),
                0 5px 15px rgba(255, 192, 203, 0.3),
                inset 0 3px 6px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            font-family: 'Comic Neue', 'Kalam', cursive;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            animation: loveButtonPulse 2s ease-in-out infinite;
            overflow: hidden;
            margin: 20px auto;
            margin-left: auto;
            margin-right: auto;
        }

        .love-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .love-button:hover::before {
            left: 100%;
        }

        .love-button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 
                0 15px 35px rgba(255, 182, 193, 0.5),
                0 8px 20px rgba(255, 192, 203, 0.4),
                inset 0 3px 6px rgba(255, 255, 255, 0.4);
            background: linear-gradient(135deg, #ffc1db 0%, #ffb6d1 50%, #ff85a2 100%);
        }

        .love-button:active {
            transform: translateY(0px) scale(1.02);
        }



        .button-text {
            position: relative;
            z-index: 1;
        }

        @keyframes loveButtonPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 
                    0 10px 25px rgba(255, 182, 193, 0.4),
                    0 5px 15px rgba(255, 192, 203, 0.3),
                    inset 0 3px 6px rgba(255, 255, 255, 0.3);
            }
            50% { 
                transform: scale(1.03);
                box-shadow: 
                    0 12px 28px rgba(255, 182, 193, 0.45),
                    0 6px 18px rgba(255, 192, 203, 0.35),
                    inset 0 3px 6px rgba(255, 255, 255, 0.35);
            }
        }





        /* æµ·æŠ¥æŒ‰é’®æ ·å¼ */
        .poster-button {
            position: relative;
            margin-top: 30px;
            margin-left: auto;
            margin-right: auto;
            transform: scale(0);
            background: linear-gradient(135deg, #ffb6d1 0%, #ff85a2 50%, #ffa6c1 100%);
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28"><circle cx="14" cy="14" r="10" fill="%23ff1493" opacity="0.9"/><circle cx="14" cy="14" r="4" fill="%23fff"/><circle cx="14" cy="14" r="2" fill="%23ff69b4"/></svg>') 14 14, pointer;
            box-shadow: 
                0 15px 35px rgba(255, 182, 193, 0.4),
                0 8px 20px rgba(255, 192, 203, 0.3),
                inset 0 4px 8px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            font-family: 'Comic Neue', 'Kalam', cursive;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: posterButtonPulse 2.5s ease-in-out infinite;
            z-index: 803;
            opacity: 0;
        }

        .poster-button.show {
            opacity: 1;
            transform: scale(1);
        }

        .poster-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 20px 45px rgba(255, 182, 193, 0.5),
                0 10px 25px rgba(255, 192, 203, 0.4),
                inset 0 4px 8px rgba(255, 255, 255, 0.4);
            background: linear-gradient(135deg, #ffc1db 0%, #ffb6d1 50%, #ff85a2 100%);
        }

        .poster-button:active {
            transform: translateY(-1px) scale(1.02);
        }

        .poster-icon {
            font-size: 20px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .poster-text {
            position: relative;
            z-index: 1;
        }

        @keyframes posterButtonPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 
                    0 15px 35px rgba(255, 182, 193, 0.4),
                    0 8px 20px rgba(255, 192, 203, 0.3),
                    inset 0 4px 8px rgba(255, 255, 255, 0.3);
            }
            50% { 
                transform: scale(1.03);
                box-shadow: 
                    0 18px 40px rgba(255, 182, 193, 0.45),
                    0 10px 25px rgba(255, 192, 203, 0.35),
                    inset 0 4px 8px rgba(255, 255, 255, 0.35);
            }
        }

        @media (max-width: 500px) {
            .card-container {
                height: 500px;
            }
            

            
            .hint-text {
                font-size: 18px;
            }
            
            .birthday-text {
                font-size: 36px;
            }
            
            .love-button {
                width: 160px;
                height: 50px;
                font-size: 16px;
            }
            
            .poster-button {
                margin-top: 20px;
                padding: 12px 20px;
                font-size: 16px;
            }
            


        }
    </style>
</head>
<body>
        <script>
            // é¡µé¢æ¸²æŸ“ç¬é—´å°±æ‰§è¡Œçš„é˜²æŠ¤
            (function() {
                // ç­‰å¾…DOMå¯ç”¨
                function checkAndClean() {
                    const boxes = document.querySelectorAll('#gift-box, [id="gift-box"]');
                    if (boxes.length > 1) {
                        console.log('ğŸš¨ é¡µé¢æ¸²æŸ“æ—¶å‘ç°é‡å¤ç¤¼ç›’ï¼Œç«‹å³æ¸…ç†');
                        for (let i = 1; i < boxes.length; i++) {
                            boxes[i].remove();
                        }
                    }
                }
                
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', checkAndClean);
                } else {
                    checkAndClean();
                }
                
                // æ¯100msæ£€æŸ¥ä¸€æ¬¡ï¼ŒæŒç»­5ç§’
                let count = 50;
                const interval = setInterval(() => {
                    checkAndClean();
                    count--;
                    if (count <= 0) clearInterval(interval);
                }, 100);
            })();
        </script>
        <!-- çƒŸèŠ±èƒŒæ™¯ -->
        <div class="fireworks-background" id="fireworks-background"></div>
        
        <!-- å¼€å§‹é¡µé¢ -->
        <div class="start-screen" id="start-screen">
            <!-- å¼€å§‹é¡µé¢ç²’å­æ•ˆæœ -->
            <div class="start-screen-particles" id="start-particles"></div>
            <button class="start-button" id="start-button" onclick="handleStartClick()">å¼€å§‹</button>
        </div>
        
        <div class="card-container">
        <!-- æµ‹è¯•æŒ‰é’®å·²ç§»é™¤ -->
        
        <div class="initial-screen" id="initial-screen">
            <!-- æµ‹è¯•æŒ‰é’®å·²ç§»é™¤ -->
            
            <div id="gift-box">
                <!-- ç¤¼ç›’ä¸»ä½“ï¼ˆä¿¯è§†æ­£æ–¹å½¢ï¼‰ -->
                <div id="box-main" style="
                     position: absolute;
                     width: 100%;
                     height: 100%;
                     background: linear-gradient(135deg, #ffc0cb, #ffb6c1, #fff0f5);
                     border-radius: 30px;
                     box-shadow: 
                         0 20px 40px rgba(255, 182, 193, 0.4),
                         0 10px 20px rgba(255, 192, 203, 0.3),
                         inset 0 4px 8px rgba(255, 255, 255, 0.7);
                     border: 4px solid #fff;
                     transform: rotateX(20deg) rotateZ(0deg);
                     transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
                ">
                    <!-- æ¨ªå‘è£…é¥°æ¡ -->
                    <div style="
                        position: absolute;
                        width: 100%;
                        height: 24px;
                        background: linear-gradient(90deg, #fff 20%, #ffc0cb 50%, #fff 80%);
                        top: 50%;
                        left: 0;
                        transform: translateY(-50%);
                        border-radius: 15px;
                        box-shadow: 0 4px 8px rgba(255, 192, 203, 0.3);
                        border: 2px solid #fff;
                    "></div>
                    <!-- ç«–å‘è£…é¥°æ¡ -->
                    <div style="
                        position: absolute;
                        width: 24px;
                        height: 100%;
                        background: linear-gradient(180deg, #fff 20%, #ffc0cb 50%, #fff 80%);
                        left: 50%;
                        top: 0;
                        transform: translateX(-50%);
                        border-radius: 15px;
                        box-shadow: 4px 0 8px rgba(255, 192, 203, 0.3);
                        border: 2px solid #fff;
                    "></div>
                    <!-- ç”Ÿæ—¥æ–‡å­—å·²ç§»é™¤è‡³åŠ¨ç”»å±‚ï¼Œæ˜¾ç¤ºæ—¶ä¸æ°”çƒåŒæ—¶å‡ºç° -->
                </div>
                
                <!-- ç›’ç›–éƒ¨åˆ†ï¼ˆä¿¯è§†ç¿»ç›–ï¼‰ -->
                <div id="box-lid" style="
                     position: absolute;
                     top: 0;
                     left: 0;
                     width: 100%;
                     height: 100%;
                     background: linear-gradient(135deg, #ffc0cb, #ffb6c1, #fff0f5);
                     border-radius: 30px;
                     box-shadow: 
                         0 15px 30px rgba(255, 182, 193, 0.3),
                         inset 0 4px 8px rgba(255, 255, 255, 0.7);
                     border: 4px solid #fff;
                     transform-origin: top center;
                     transform: rotateX(20deg) rotateZ(0deg);
                     transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
                     z-index: 2;
                     pointer-events: none;
                ">
                    <!-- æ¨ªå‘è£…é¥°æ¡ -->
                    <div style="
                        position: absolute;
                        width: 100%;
                        height: 24px;
                        background: linear-gradient(90deg, #fff 20%, #ffc0cb 50%, #fff 80%);
                        top: 50%;
                        left: 0;
                        transform: translateY(-50%);
                        border-radius: 15px;
                        box-shadow: 0 4px 8px rgba(255, 192, 203, 0.3);
                        border: 2px solid #fff;
                    "></div>
                    <!-- ç«–å‘è£…é¥°æ¡ -->
                    <div style="
                        position: absolute;
                        width: 24px;
                        height: 100%;
                        background: linear-gradient(180deg, #fff 20%, #ffc0cb 50%, #fff 80%);
                        left: 50%;
                        top: 0;
                        transform: translateX(-50%);
                        border-radius: 15px;
                        box-shadow: 4px 0 8px rgba(255, 192, 203, 0.3);
                        border: 2px solid #fff;
                    "></div>
                </div>
                
                <!-- è´è¶ç»“ï¼ˆä¿¯è§†å›¾ï¼‰ -->
                <div id="bow-container" style="
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    z-index: 3;
                    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
                    pointer-events: none;
                ">
                    <!-- å·¦è¾¹è´è¶ç»“ -->
                    <div class="bow-left" style="
                        position: absolute;
                        width: 40px;
                        height: 40px;
                        background: radial-gradient(circle, #fff 60%, #ffc0cb 100%);
                        border-radius: 50% 15% 50% 15%;
                        left: -25px;
                        top: 0;
                        transform: rotate(-30deg);
                        box-shadow: 0 8px 16px rgba(255, 182, 193, 0.5);
                        border: 3px solid #fff;
                        transform-origin: right center;
                        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
                    "></div>
                    <!-- å³è¾¹è´è¶ç»“ -->
                    <div class="bow-right" style="
                        position: absolute;
                        width: 40px;
                        height: 40px;
                        background: radial-gradient(circle, #fff 60%, #ffc0cb 100%);
                        border-radius: 50% 15% 50% 15%;
                        right: -25px;
                        top: 0;
                        transform: rotate(30deg);
                        box-shadow: 0 8px 16px rgba(255, 182, 193, 0.5);
                        border: 3px solid #fff;
                        transform-origin: left center;
                        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
                    "></div>
                    <!-- ä¸­é—´ç»“ï¼ˆä¿¯è§†ï¼‰ -->
                    <div style="
                        position: absolute;
                        width: 30px;
                        height: 30px;
                        background: radial-gradient(circle, #fff 70%, #ffc0cb 100%);
                        border-radius: 50%;
                        left: 50%;
                        top: 50%;
                        transform: translate(-50%, -50%);
                        box-shadow: 0 6px 12px rgba(255, 182, 193, 0.4);
                        border: 2px solid #fff;
                    "></div>
                </div>
            </div>
            <div class="hint-text">è¯·æ‰“å¼€ç¤¼ç›’</div>
        </div>
        
        <div class="animation-container" id="animation-container"></div>
        <div class="birthday-text" id="birthday-text">
            <span>ç”Ÿ</span><span>æ—¥</span><span>å¿«</span><span>ä¹</span>
        </div>
        <!-- è›‹ç³•æŒ‰é’® -->
        <button class="heart-button" id="heart-button">
            <div class="cake-icon">ğŸ‚</div>
        </button>
        


    </div>

    <script>
        // ===== è¶…å¼ºç¤¼ç›’é˜²æŠ¤ç³»ç»Ÿ =====
        (function() {
            console.log('å¯åŠ¨è¶…å¼ºç¤¼ç›’é˜²æŠ¤ç³»ç»Ÿ...');
            
            function nuclearGiftBoxCleanup() {
                // æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„ç¤¼ç›’å…ƒç´ 
                const allGiftBoxes = document.querySelectorAll('#gift-box, [id="gift-box"], div[id*="gift"]');
                console.log(`ğŸ” æ ¸æ­¦å™¨çº§æ£€æŸ¥ï¼šå‘ç° ${allGiftBoxes.length} ä¸ªç¤¼ç›’ç›¸å…³å…ƒç´ `);
                
                if (allGiftBoxes.length === 0) {
                    console.warn('âš ï¸ æœªæ‰¾åˆ°ä»»ä½•ç¤¼ç›’å…ƒç´ ï¼');
                    return null;
                }
                
                if (allGiftBoxes.length > 1) {
                    console.log('ğŸ§¹ å¯åŠ¨æ ¸æ­¦å™¨çº§æ¸…ç†...');
                    
                    // ç¬¬ä¸€æ­¥ï¼šéšè—æ‰€æœ‰ç¤¼ç›’
                    allGiftBoxes.forEach(box => {
                        box.style.cssText = `
                            display: none !important;
                            visibility: hidden !important;
                            opacity: 0 !important;
                            position: absolute !important;
                            left: -999999px !important;
                            top: -999999px !important;
                            width: 0 !important;
                            height: 0 !important;
                            pointer-events: none !important;
                            z-index: -999999 !important;
                        `;
                    });
                    
                    // ç¬¬äºŒæ­¥ï¼šåªæ˜¾ç¤ºå¹¶ä¿®å¤ç¬¬ä¸€ä¸ªç¤¼ç›’
                    const theOneTrueGiftBox = allGiftBoxes[0];
                    theOneTrueGiftBox.style.cssText = `
                        position: relative !important;
                        left: auto !important;
                        top: auto !important;
                        transform: none !important;
                        margin: 0 auto !important;
                        display: block !important;
                        visibility: visible !important;
                        opacity: 1 !important;
                        z-index: 10 !important;
                        pointer-events: auto !important;
                        width: 160px !important;
                        height: 160px !important;
                        cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><polygon points="13,2 16,9 23,9 17,14 20,21 13,16 6,21 9,14 3,9 10,9" fill="%23ffd700" stroke="%23fff" stroke-width="1"/></svg>') 13 13, pointer !important;
                        perspective: 1000px !important;
                    `;
                    
                    // ç¬¬ä¸‰æ­¥ï¼šç‰©ç†ç§»é™¤å…¶ä»–ç¤¼ç›’
                    for (let i = 1; i < allGiftBoxes.length; i++) {
                        const duplicateBox = allGiftBoxes[i];
                        try {
                            duplicateBox.remove();
                            console.log(`ğŸ—‘ï¸ ç‰©ç†ç§»é™¤é‡å¤ç¤¼ç›’ ${i}`);
                        } catch (e) {
                            console.log(`âš¡ å¼ºåˆ¶éšè—é‡å¤ç¤¼ç›’ ${i}`);
                        }
                    }
                    
                    console.log('âœ… æ ¸æ­¦å™¨çº§æ¸…ç†å®Œæˆï¼åªä¿ç•™ä¸€ä¸ªç¤¼ç›’');
                } else {
                    // ç¡®ä¿å•ä¸ªç¤¼ç›’çš„æ ·å¼æ­£ç¡®
                    const singleBox = allGiftBoxes[0];
                    singleBox.style.cssText = `
                        position: relative !important;
                        left: auto !important;
                        top: auto !important;
                        transform: none !important;
                        margin: 0 auto !important;
                        display: block !important;
                        visibility: visible !important;
                        opacity: 1 !important;
                        z-index: 10 !important;
                        pointer-events: auto !important;
                        width: 160px !important;
                        height: 160px !important;
                        cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><polygon points="13,2 16,9 23,9 17,14 20,21 13,16 6,21 9,14 3,9 10,9" fill="%23ffd700" stroke="%23fff" stroke-width="1"/></svg>') 13 13, pointer !important;
                        perspective: 1000px !important;
                    `;
                    console.log('âœ… å•ä¸ªç¤¼ç›’æ ·å¼å·²ç¡®ä¿æ­£ç¡®');
                }
                
                return document.getElementById('gift-box');
            }
            
            // è®¾ç½®å…¨å±€é˜²æŠ¤å¯¹è±¡
            window.giftBoxProtection = {
                forceCleanup: nuclearGiftBoxCleanup,
                ensureUniqueness: nuclearGiftBoxCleanup
            };
            
            // ç«‹å³æ‰§è¡Œé˜²æŠ¤
            nuclearGiftBoxCleanup();
            
            // DOMå˜åŒ–æ—¶ç«‹å³æ¸…ç†
            const observer = new MutationObserver(() => {
                setTimeout(nuclearGiftBoxCleanup, 50);
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true,
                attributes: true,
                characterData: true
            });
            
            // å®šæœŸå¼ºåˆ¶æ£€æŸ¥
            setInterval(nuclearGiftBoxCleanup, 2000);
            
            // é¡µé¢åŠ è½½å®Œæˆåå†æ£€æŸ¥
            window.addEventListener('load', () => {
                setTimeout(nuclearGiftBoxCleanup, 100);
                setTimeout(nuclearGiftBoxCleanup, 500);
            });
            
            console.log('ğŸ’¥ è¶…å¼ºç¤¼ç›’é˜²æŠ¤ç³»ç»Ÿå·²å®Œå…¨éƒ¨ç½²ï¼');
        })();
    </script>

    <script>
        console.log('é¡µé¢åŠ è½½ä¸­...');
        
        // ===== å…¨å±€å˜é‡ - é˜²æ­¢é‡å¤åŠ¨ç”» =====
        let isAnimationRunning = false;
        
        // ===== è·å–å§“åå‡½æ•° =====
        function getStoredName() {
            // ä¼˜å…ˆä»URLå‚æ•°è·å–
            const urlParams = new URLSearchParams(window.location.search);
            const urlName = urlParams.get('name');
            
            // å…¶æ¬¡ä»localStorageè·å–
            const storedName = localStorage.getItem('birthdayPersonName');
            
            return urlName || storedName;
        }

        // ===== å…¨å±€å‡½æ•° - ç«‹å³å®šä¹‰ =====
        function handleStartClick() {
            console.log('å¼€å§‹æŒ‰é’®è¢«ç‚¹å‡»ï¼');
            
            // é˜²æ­¢åŠ¨ç”»é‡å¤æ‰§è¡Œ
            if (isAnimationRunning) {
                console.log('åŠ¨ç”»æ­£åœ¨è¿è¡Œä¸­ï¼Œå¿½ç•¥é‡å¤ç‚¹å‡»');
                return;
            }
            
            // è·å–å…³é”®å…ƒç´ å¹¶è¿›è¡Œæ£€æŸ¥
            const startScreen = document.getElementById('start-screen');
            const startButton = document.getElementById('start-button');
            
            if (!startScreen) {
                console.log('æ‰¾ä¸åˆ°å¼€å§‹å±å¹•å…ƒç´ ');
                return;
            }
            
            if (!startButton) {
                console.log('æ‰¾ä¸åˆ°å¼€å§‹æŒ‰é’®å…ƒç´ ');
                return;
            }
            
            // è®¾ç½®åŠ¨ç”»æ ‡å¿—
            isAnimationRunning = true;
            console.log('å¼€å§‹åŠ¨ç”»åºåˆ—ï¼Œè®¾ç½®è¿è¡Œæ ‡å¿—');
            
            // å¼€å§‹è¿ç»­åŠ¨ç”»åºåˆ—
            
            // ç¬¬1æ­¥ï¼šè·å–å§“åå¹¶æ”¹å˜æŒ‰é’®æ–‡å­—
            const urlParams = new URLSearchParams(window.location.search);
            const urlName = urlParams.get('name');
            const savedName = localStorage.getItem('birthdayPersonName');
            
            // ä¼˜å…ˆä½¿ç”¨URLå‚æ•°ï¼Œå…¶æ¬¡ä½¿ç”¨localStorage
            const displayName = urlName || savedName;
            
            startButton.style.transform = 'scale(0)';
            startButton.textContent = displayName ? `ä½ å¥½ï¼${displayName}` : 'ä½ å¥½ï¼';
            startButton.style.color = '#ff1493';
            startButton.style.fontSize = '32px';
            startButton.style.fontWeight = 'bold';
            startButton.style.textShadow = '0 0 20px rgba(255, 20, 147, 0.6)';
            // å»æ‰æ¤­åœ†å½¢èƒŒæ™¯æ¡†
            startButton.style.background = 'none';
            startButton.style.border = 'none';
            startButton.style.boxShadow = 'none';
            startButton.style.padding = '0';
            startButton.style.cursor = 'default';
            startButton.style.animation = 'none';
            
            setTimeout(() => {
                startButton.style.transform = 'scale(1.2)';
            }, 50);
            setTimeout(() => {
                startButton.style.transform = 'scale(1)';
            }, 200);
            
            // ç¬¬2æ­¥ï¼šæ”¹å˜ä¸º"ç¥ä½ ï¼"
            setTimeout(() => {
                startButton.style.transform = 'rotateY(90deg) scale(0.8)';
                setTimeout(() => {
                    startButton.textContent = 'ç¥ä½ ï¼';
                    startButton.style.color = '#ff69b4';
                    startButton.style.background = 'none';
                    startButton.style.border = 'none';
                    startButton.style.boxShadow = 'none';
                    startButton.style.padding = '0';
                    startButton.style.cursor = 'default';
                    startButton.style.animation = 'none';
                    startButton.style.transform = 'rotateY(0deg) scale(1.1)';
                    setTimeout(() => {
                        startButton.style.transform = 'rotateY(0deg) scale(1)';
                    }, 200);
                }, 150);
            }, 1500);
            
            // ç¬¬3æ­¥ï¼šæ˜¾ç¤º"ç”Ÿæ—¥å¿«ä¹"
            setTimeout(() => {
                startButton.style.transform = 'translateY(50px) scale(0.6) rotate(-10deg)';
                startButton.style.opacity = '0.3';
                setTimeout(() => {
                    startButton.textContent = 'ç”Ÿæ—¥å¿«ä¹';
                    startButton.style.color = '#ff85a2';
                    startButton.style.background = 'none';
                    startButton.style.border = 'none';
                    startButton.style.boxShadow = 'none';
                    startButton.style.padding = '0';
                    startButton.style.cursor = 'default';
                    startButton.style.animation = 'none';
                    startButton.style.transform = 'translateY(-20px) scale(1.2) rotate(5deg)';
                    startButton.style.opacity = '1';
                    setTimeout(() => {
                        startButton.style.transform = 'translateY(0) scale(1) rotate(0deg)';
                    }, 300);
                }, 200);
            }, 3000);
            
            // ç¬¬4æ­¥ï¼šå˜æˆ"happy birthday"
            setTimeout(() => {
                startButton.style.transform = 'translateX(-100px) rotate(-45deg) scale(0.5)';
                startButton.style.opacity = '0';
                setTimeout(() => {
                    startButton.textContent = 'happy birthday';
                    startButton.style.color = '#ff1493';
                    startButton.style.background = 'none';
                    startButton.style.border = 'none';
                    startButton.style.boxShadow = 'none';
                    startButton.style.padding = '0';
                    startButton.style.cursor = 'default';
                    startButton.style.animation = 'none';
                    startButton.style.transform = 'translateX(100px) rotate(45deg) scale(0.5)';
                    startButton.style.opacity = '1';
                    setTimeout(() => {
                        startButton.style.transform = 'translateX(0) rotate(0deg) scale(1)';
                    }, 400);
                }, 250);
            }, 4500);
            
            // ç¬¬5æ­¥ï¼šå€’æ•°"3"
            setTimeout(() => {
                startButton.style.fontSize = '48px';
                startButton.style.color = '#ff1493';
                startButton.style.fontWeight = '900';
                startButton.textContent = '3';
                startButton.style.background = 'none';
                startButton.style.border = 'none';
                startButton.style.boxShadow = 'none';
                startButton.style.padding = '0';
                startButton.style.cursor = 'default';
                startButton.style.animation = 'none';
                startButton.style.transform = 'scale(0.5)';
                setTimeout(() => {
                    startButton.style.transform = 'scale(1.5)';
                    setTimeout(() => {
                        startButton.style.transform = 'scale(1)';
                    }, 150);
                }, 100);
            }, 6000);
            
            // ç¬¬6æ­¥ï¼šå€’æ•°"2"
            setTimeout(() => {
                console.log('å¼€å§‹ç¬¬6æ­¥ï¼šæ˜¾ç¤º"2"');
                startButton.style.fontSize = '56px';
                startButton.style.color = '#ff69b4';
                startButton.textContent = '2';
                startButton.style.background = 'none';
                startButton.style.border = 'none';
                startButton.style.boxShadow = 'none';
                startButton.style.padding = '0';
                startButton.style.cursor = 'default';
                startButton.style.animation = 'none';
                startButton.style.transform = 'rotate(360deg) scale(0.8)';
                console.log('"2"æ˜¾ç¤ºå®Œæˆï¼Œå¼€å§‹æ—‹è½¬åŠ¨ç”»');
                
                setTimeout(() => {
                    console.log('ç¬¬ä¸€æ¬¡æ—‹è½¬åˆ°720deg');
                    startButton.style.transform = 'rotate(720deg) scale(1.3)';
                    
                    setTimeout(() => {
                        console.log('ç¬¬äºŒæ¬¡æ—‹è½¬åˆ°1080deg');
                        startButton.style.transform = 'rotate(1080deg) scale(1)';
                        console.log('"2"åŠ¨ç”»å®Œæˆï¼Œå‡†å¤‡ç¬¬7æ­¥');
                    }, 200);
                }, 100);
            }, 7000);
            
            // ç¬¬7æ­¥ï¼šå€’æ•°"1"
            setTimeout(() => {
                console.log('å¼€å§‹ç¬¬7æ­¥ï¼šæ˜¾ç¤º"1"');
                if (!startButton || !startScreen) {
                    console.error('å…³é”®å…ƒç´ ä¸¢å¤±ï¼ŒåŠ¨ç”»ç»ˆæ­¢');
                    isAnimationRunning = false;
                    return;
                }
                
                startButton.style.fontSize = '64px';
                startButton.style.color = '#ff1493';
                startButton.style.textShadow = '0 0 30px rgba(255, 20, 147, 0.8)';
                startButton.textContent = '1';
                startButton.style.background = 'none';
                startButton.style.border = 'none';
                startButton.style.boxShadow = 'none';
                startButton.style.padding = '0';
                startButton.style.cursor = 'default';
                startButton.style.animation = 'none';
                startButton.style.transform = 'scale(0)';
                console.log('"1"æ˜¾ç¤ºå®Œæˆï¼Œå¼€å§‹è„‰å†²åŠ¨ç”»');
                
                setTimeout(() => {
                    console.log('è„‰å†²åŠ¨ç”»ï¼šscale(2)');
                    startButton.style.transform = 'scale(2)';
                    
                    setTimeout(() => {
                        console.log('è„‰å†²åŠ¨ç”»ï¼šscale(1.5)');
                        startButton.style.transform = 'scale(1.5)';
                        
                        setTimeout(() => {
                            console.log('è„‰å†²åŠ¨ç”»ï¼šscale(1)');
                            startButton.style.transform = 'scale(1)';
                            console.log('"1"åŠ¨ç”»å®Œæˆï¼Œå‡†å¤‡ç¬¬8æ­¥');
                        }, 100);
                    }, 100);
                }, 100);
            }, 8000);
            
            // ç¬¬8æ­¥ï¼šåŠ¨ç”»ç»“æŸï¼Œéšè—å¼€å§‹å±å¹•
            setTimeout(() => {
                console.log('å¼€å§‹ç¬¬8æ­¥ï¼šæ¶ˆæ•£æ•ˆæœ');
                if (!startButton || !startScreen) {
                    console.error('å…³é”®å…ƒç´ ä¸¢å¤±ï¼Œæ— æ³•å®ŒæˆåŠ¨ç”»');
                    isAnimationRunning = false;
                    return;
                }
                
                startButton.style.transform = 'scale(1.5) rotate(180deg)';
                startButton.style.opacity = '0';
                startScreen.style.background = 'radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)';
                console.log('èƒŒæ™¯æ¸å˜å’ŒæŒ‰é’®é€æ˜è®¾ç½®å®Œæˆ');
                
                setTimeout(() => {
                    console.log('å¼€å§‹éšè—å¼€å§‹å±å¹•');
                    startScreen.style.opacity = '0';
                    startScreen.style.transform = 'scale(1.2)';
                    
                    setTimeout(() => {
                        startScreen.style.display = 'none';
                        console.log('å®Œæ•´åŠ¨ç”»åºåˆ—å·²å®Œæˆï¼');
                        
                        // é‡ç½®åŠ¨ç”»æ ‡å¿— - ç¡®ä¿æœ€ç»ˆé‡ç½®
                        isAnimationRunning = false;
                        console.log('åŠ¨ç”»å®Œæˆï¼Œé‡ç½®è¿è¡Œæ ‡å¿—');
                        console.log('åŠ¨ç”»åºåˆ—ç»“æŸï¼Œåœç•™åœ¨ç¤¼ç›’ç•Œé¢');

                        
                        // åŠ¨ç”»ç»“æŸååœç•™åœ¨ç¤¼ç›’ç•Œé¢ï¼Œä¸è‡ªåŠ¨è·³å›å¼€å§‹ç•Œé¢
                        // ç”¨æˆ·å¯ä»¥ç‚¹å‡»é‡æ–°å¼€å§‹æŒ‰é’®æ¥é‡æ–°æ’­æ”¾åŠ¨ç”»
                    }, 1000);
                }, 800);
            }, 9500);
        }
        

        
        // ===== é¼ æ ‡æ•ˆæœåˆå§‹åŒ– =====
        // ===== ç®€åŒ–åˆå§‹åŒ– =====
        // ===== ç¤¼ç›’é˜²æŠ¤å·²ç§»è‡³ä¸Šæ–¹ç»Ÿä¸€å¤„ç† =====


        // ===== DOMå†…å®¹åŠ è½½å®Œæˆååˆå§‹åŒ– =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆ');
            
            // åˆå§‹åŒ–é¼ æ ‡æ•ˆæœ
            if (typeof initMouseEffects === 'function') {
                initMouseEffects();
            }
            
            // ç¡®ä¿å¼€å§‹æŒ‰é’®æ­£ç¡®æ˜¾ç¤ºï¼ˆä¿æŒåŸå§‹æ–‡å­—ä¸å˜ï¼‰
            const startButton = document.getElementById('start-button');
            if (startButton) {
                console.log('å¼€å§‹æŒ‰é’®æ‰¾åˆ°');
                // ç¡®ä¿æŒ‰é’®å¯è§å’Œæ­£ç¡®æ ·å¼
                startButton.style.display = 'block';
                startButton.style.position = 'relative';
                startButton.style.zIndex = '10000';
            } else {
                console.error('å¼€å§‹æŒ‰é’®æœªæ‰¾åˆ°ï¼');
            }
            
            // ===== ç¤¼ç›’é˜²æŠ¤ç³»ç»Ÿå·²åœ¨ä¸Šæ–¹ç»Ÿä¸€å¤„ç† =====
            
            // è®¾ç½®ç¤¼ç›’ç‚¹å‡»äº‹ä»¶
            setupGiftBoxClick();
            
            // è®¾ç½®çˆ±å¿ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            setupLoveButton();
            

            
            // æ›¿æ¢ä¸Šä¼ çš„ç…§ç‰‡ - å»¶è¿Ÿæ‰§è¡Œç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
            setTimeout(() => {
                replaceUploadedPhotos();
            }, 2000);
            
            // å†æ¬¡å°è¯•æ›¿æ¢ï¼Œç¡®ä¿æˆåŠŸ
            setTimeout(() => {
                replaceUploadedPhotos();
            }, 5000);
            
            console.log('é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });
        
        // ===== å…¨å±€é…ç½®å¸¸é‡ =====
        const CONFIG = {
            // åŠ¨ç”»é…ç½®
            ANIMATION: {
                DURATION: {
                    FAST: 300,
                    NORMAL: 600,
                    SLOW: 800,
                    CELEBRATION: 1000
                },
                EASING: {
                    SMOOTH: 'cubic-bezier(0.4, 0, 0.2, 1)',
                    BOUNCE: 'cubic-bezier(0.68, -0.55, 0.265, 1.55)',
                    ELASTIC: 'cubic-bezier(0.34, 1.56, 0.64, 1)'
                }
            },
            
            // æ‹–æ‹½é…ç½®
            DRAG: {
                LIMITS: {
                    X: { MIN: 0, MAX: 0 }, // ç¦æ­¢å·¦å³æ‹–åŠ¨
                    Y: { MIN: -8000, MAX: 3000 } // å…è®¸å‘ä¸‹æ‹–åŠ¨3000pxï¼Œå‘ä¸Šæ‹–åŠ¨8000pxï¼ˆç¡®ä¿çœ‹åˆ°ç”Ÿæˆè´ºå¡æŒ‰é’®ï¼‰
                },
                ROTATION_FACTOR: 0, // ç¦æ­¢æ—‹è½¬
                THROTTLE_INTERVAL: 16 // 60fps
            },
            
            // é¢œè‰²é…ç½®
            COLORS: {
                PINK: ['#ff69b4', '#ffb6c1', '#ffc0cb', '#ff85a2'],
                CELEBRATION: ['#ff69b4', '#ffb6c1', '#ffc0cb', '#ff1493', '#ff85a2', '#ffd700', '#87ceeb']
            },
            
            // ç²’å­é…ç½®
            PARTICLES: {
                CONFETTI_COUNT: 60,
                SPARKLE_COUNT: 20,
                FALL_DISTANCE: 450
            }
        };
        
        // ===== å…¨å±€çŠ¶æ€å˜é‡ =====
        let isAnimating = false;
        
        // ===== é¼ æ ‡æ•ˆæœå˜é‡ =====
        let mouseGlow = null;
        let mouseX = 0;
        let mouseY = 0;
        
        // ===== é¼ æ ‡æ•ˆæœå‡½æ•° =====
        function initMouseEffects() {
            // åˆ›å»ºé¼ æ ‡å…‰æ™•
            mouseGlow = document.createElement('div');
            mouseGlow.className = 'mouse-glow';
            document.body.appendChild(mouseGlow);
            
            // é¼ æ ‡ç§»åŠ¨ç›‘å¬
            document.addEventListener('mousemove', function(e) {
                mouseX = e.clientX;
                mouseY = e.clientY;
                
                if (mouseGlow) {
                    mouseGlow.style.left = mouseX + 'px';
                    mouseGlow.style.top = mouseY + 'px';
                }
            });
            
            // é¼ æ ‡ç‚¹å‡»æ•ˆæœ
            document.addEventListener('click', function(e) {
                createClickRipple(e.clientX, e.clientY);
            });
        }
        
        function createClickRipple(x, y) {
            const ripple = document.createElement('div');
            ripple.className = 'click-ripple';
            ripple.style.left = (x - 30) + 'px';
            ripple.style.top = (y - 30) + 'px';
            
            document.body.appendChild(ripple);
            
            // ç§»é™¤æ³¢çº¹
            setTimeout(() => {
                if (ripple.parentElement) {
                    ripple.remove();
                }
            }, 600);
        }
        
        // åŠ¨æ€çƒŸèŠ±èƒŒæ™¯
        function createFireworkBackground() {
            const container = document.getElementById('fireworks-background');
            if (!container) return;
            
            // åˆå§‹åˆ›å»ºå°‘é‡çƒŸèŠ±
            for (let i = 0; i < 3; i++) {
                setTimeout(() => createFirework(container), i * 200);
            }
            
            // æŒç»­åˆ›å»ºçƒŸèŠ±ï¼Œé™ä½é¢‘ç‡
            setInterval(() => {
                if (Math.random() < 0.3) { // 30%æ¦‚ç‡åˆ›å»ºçƒŸèŠ±
                    createFirework(container);
                }
            }, 800); // å¢åŠ é—´éš”æ—¶é—´
        }
        
        function createFirework(container) {
            // å‡å°‘é¢œè‰²å˜åŒ–
            const colors = ['#ff69b4', '#ffb6c1', '#ffc0cb', '#ffffff'];
            
            // ä¿®æ”¹ä¸ºå³ä¸Šè§’åŒºåŸŸç”Ÿæˆ
            const x = window.innerWidth - 50 - Math.random() * 200; // å³ä¸Šè§’200pxèŒƒå›´å†…
            const y = 50 + Math.random() * 150; // å³ä¸Šè§’é™„è¿‘
            const color = colors[Math.floor(Math.random() * colors.length)];
            const particleCount = 20 + Math.floor(Math.random() * 15); // å¢åŠ ç²’å­æ•°é‡
            
            // åˆ›å»ºå•å±‚ç®€åŒ–ç²’å­
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'firework-particle';
                
                const particleSize = 12 + Math.random() * 12; // å¤§å¹…å¢åŠ ç²’å­å°ºå¯¸ï¼š12-24px
                particle.style.width = particleSize + 'px';
                particle.style.height = particleSize + 'px';
                particle.style.background = color; // ç§»é™¤æ¸å˜ï¼Œä½¿ç”¨çº¯è‰²
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.borderRadius = '50%';
                
                const angle = (Math.PI * 2 * i) / particleCount;
                const velocity = 90 + Math.random() * 80; // ç•¥å¾®å¢åŠ é€Ÿåº¦
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity;
                
                container.appendChild(particle);
                
                // ç®€åŒ–åŠ¨ç”»
                setTimeout(() => {
                    particle.style.transition = 'all 2s ease-out';
                    particle.style.transform = `translate(${vx}px, ${vy}px) scale(0.2)`; // è°ƒæ•´æœ€ç»ˆç¼©æ”¾
                    particle.style.opacity = '0';
                }, 10);
                
                // å¿«é€Ÿæ¸…ç†
                setTimeout(() => {
                    if (particle.parentElement) {
                        particle.remove();
                    }
                }, 2000);
            }
        }
        
        // è¿™äº›å˜é‡åœ¨å‰é¢å·²ç»å£°æ˜è¿‡äº†ï¼Œä¸éœ€è¦é‡å¤å£°æ˜
        let balloons = [];
        let isDragging = false;
        let draggedBalloon = null;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        
        // ç®€åŒ–çš„å¼€å§‹æŒ‰é’®åˆå§‹åŒ–å‡½æ•°ï¼ˆä¿ç•™ä»¥å¤‡å°†æ¥ä½¿ç”¨ï¼‰
        function initStartButton() {
            const startButton = document.getElementById('start-button');
            if (!startButton) {
                console.error('æ‰¾ä¸åˆ°å¼€å§‹æŒ‰é’®');
                return;
            }
            console.log('å¼€å§‹æŒ‰é’®åˆå§‹åŒ–å®Œæˆ');
        }





        // é˜²æ­¢é¼ æ ‡ç¦»å¼€çª—å£æ—¶æ‹–æ‹½çŠ¶æ€å¡ä½
        document.addEventListener('mouseleave', function(e) {
            if (isDragging && draggedBalloon) {
                // æ¢å¤è¿‡æ¸¡åŠ¨ç”»
                draggedBalloon.style.transition = 'all 0.3s ease';
                
                // æ¢å¤æ‘†åŠ¨åŠ¨ç”»
                draggedBalloon.style.animationPlayState = 'running';
                
                // ç§»é™¤æ‹–æ‹½æ ·å¼ï¼Œæ¢å¤é¼ æ ‡æ ·å¼å’Œz-index
                draggedBalloon.classList.remove('dragging');
                draggedBalloon.style.cursor = 'pointer';
                draggedBalloon.style.zIndex = '600';
                
                // é‡ç½®æ‹–æ‹½çŠ¶æ€
                isDragging = false;
                draggedBalloon = null;
                dragOffsetX = 0;
                dragOffsetY = 0;
            }
        });
        
        function pushBalloons() {
            const container = document.getElementById('animation-container');
            if (!container) return;
            
            const containerRect = container.getBoundingClientRect();
            
            // è®¡ç®—æ¯ä¸ªæ°”çƒå—åˆ°çš„æ¨åŠ›
            balloons.forEach((balloon, index) => {
                if (!balloon || !balloon.parentElement) return;
                
                const balloonRect = balloon.getBoundingClientRect();
                
                // è·å–æ°”çƒçš„å®é™…ä¸­å¿ƒä½ç½®
                const balloonCenterX = balloonRect.left - containerRect.left + balloonRect.width / 2;
                const balloonCenterY = balloonRect.top - containerRect.top + balloonRect.height / 2;
                
                // æ ¹æ®æ°”çƒç±»å‹è°ƒæ•´ç¢°æ’ä½“ç§¯
                let pushRadius = 60; // å¤§å¹…å‡å°‘æ¨åŠ¨åŠå¾„
                let pushMultiplier = 1;
                let mass = 1; // æ°”çƒè´¨é‡ï¼Œå½±å“æ¨åŠ¨é˜»åŠ›
                
                if (balloon.classList.contains('star')) {
                    pushRadius = 70; // ä»110å‡å°‘åˆ°70
                    pushMultiplier = 0.9;
                    mass = 1.1;
                } else if (balloon.classList.contains('heart')) {
                    pushRadius = 50; // ä»90å‡å°‘åˆ°50
                    pushMultiplier = 1.2;
                    mass = 0.9;
                } else if (balloon.classList.contains('ellipse')) {
                    pushRadius = 65; // æ¤­åœ†å½¢æ°”çƒçš„æ¨åŠ¨åŠå¾„
                    pushMultiplier = 1.0;
                    mass = 1.0;
                }
                
                // æ ¹æ®æ°”çƒå¤§å°è¿›ä¸€æ­¥è°ƒæ•´ç¢°æ’ä½“ç§¯
                const balloonSize = Math.max(balloonRect.width, balloonRect.height);
                const sizeMultiplier = balloonSize / 80; // ä»¥80pxä¸ºåŸºå‡†
                pushRadius = pushRadius * sizeMultiplier;
                mass = mass * sizeMultiplier;
                
                // è®¡ç®—é¼ æ ‡æ¨åŠ›
                const mouseDistance = Math.sqrt(
                    Math.pow(mouseX - balloonCenterX, 2) + 
                    Math.pow(mouseY - balloonCenterY, 2)
                );
                
                let totalPushX = 0;
                let totalPushY = 0;
                
                // é¼ æ ‡æ¨åŠ› - å¤§å¹…å‡å¼±æ¨åŠ›
                if (mouseDistance < pushRadius && mouseDistance > 0) {
                    const mouseAngle = Math.atan2(balloonCenterY - mouseY, balloonCenterX - mouseX);
                    const normalizedDistance = mouseDistance / pushRadius;
                    const mousePushStrength = Math.pow(1 - normalizedDistance, 0.8) * 8 * pushMultiplier / mass; // ä»25å‡å°‘åˆ°8
                    
                    totalPushX += Math.cos(mouseAngle) * mousePushStrength;
                    totalPushY += Math.sin(mouseAngle) * mousePushStrength;
                }
                
                // æ°”çƒä¹‹é—´çš„ç›¸äº’æ¨åŠ›
                balloons.forEach((otherBalloon, otherIndex) => {
                    if (index === otherIndex) return;
                    
                    const otherRect = otherBalloon.getBoundingClientRect();
                    const otherCenterX = otherRect.left - containerRect.left + otherRect.width / 2;
                    const otherCenterY = otherRect.top - containerRect.top + otherRect.height / 2;
                    
                    const balloonDistance = Math.sqrt(
                        Math.pow(otherCenterX - balloonCenterX, 2) + 
                        Math.pow(otherCenterY - balloonCenterY, 2)
                    );
                    
                    const collisionRadius = (balloonSize + Math.max(otherRect.width, otherRect.height)) / 3.5; // å¢å¤§åˆ†æ¯ï¼Œå‡å°‘ç¢°æ’åŠå¾„
                    
                    if (balloonDistance < collisionRadius && balloonDistance > 0) {
                        const collisionAngle = Math.atan2(balloonCenterY - otherCenterY, balloonCenterX - otherCenterX);
                        const collisionStrength = Math.pow(1 - balloonDistance / collisionRadius, 1.5) * 3; // ä»8å‡å°‘åˆ°3
                        
                        totalPushX += Math.cos(collisionAngle) * collisionStrength;
                        totalPushY += Math.sin(collisionAngle) * collisionStrength;
                    }
                });
                
                // åº”ç”¨æ¨åŠ›
                if (Math.abs(totalPushX) > 0.1 || Math.abs(totalPushY) > 0.1) {
                    const currentLeft = parseFloat(balloon.style.left) || 0;
                    const currentTop = parseFloat(balloon.style.top) || 0;
                    
                    balloon.classList.add('pushed');
                    
                    // è·å–å®¹å™¨çš„è¾¹ç•Œ
                    const maxX = containerRect.width - balloonRect.width;
                    const maxY = containerRect.height - balloonRect.height;
                    
                    // è®¡ç®—æ–°ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè¾¹ç•Œï¼Œå¹¶æ·»åŠ ä¸€äº›ç¼“å†²
                    const buffer = 8; // è¾¹ç•Œç¼“å†²
                    const newLeft = Math.max(buffer, Math.min(currentLeft + totalPushX, maxX - buffer));
                    const newTop = Math.max(buffer, Math.min(currentTop + totalPushY, maxY - buffer));
                    
                    balloon.style.left = newLeft + 'px';
                    balloon.style.top = newTop + 'px';
                    
                    // ç§»é™¤æ¨åŠ¨ç±»ï¼Œæ ¹æ®æ¨åŠ¨åŠ›åº¦è°ƒæ•´æ¢å¤æ—¶é—´
                    const pushMagnitude = Math.sqrt(totalPushX * totalPushX + totalPushY * totalPushY);
                    const recoveryTime = Math.min(200, Math.max(50, 150 / (pushMagnitude / 5)));
                    setTimeout(() => {
                        balloon.classList.remove('pushed');
                    }, recoveryTime);
                }
            });
        }
        
        // åˆ›å»ºå¼€å§‹é¡µé¢ç²’å­æ•ˆæœ
        function createStartParticles() {
            const container = document.getElementById('start-particles');
            if (!container) return;
            
            // å¢åŠ åˆå§‹ç²’å­
            for (let i = 0; i < 12; i++) {
                setTimeout(() => createStartParticle(container), i * 250);
            }
            
            // å¢åŠ åˆ›å»ºé¢‘ç‡
            setInterval(() => {
                if (Math.random() < 0.3) {
                    createStartParticle(container);
                }
            }, 800);
        }
        
        function createStartParticle(container) {
            const particleTypes = ['star', 'heart', 'circle'];
            const particleType = particleTypes[Math.floor(Math.random() * particleTypes.length)];
            
            const particle = document.createElement('div');
            particle.className = `start-particle ${particleType}`;
            
            // éšæœºä½ç½®å’ŒåŠ¨ç”»å»¶è¿Ÿ
            const startX = Math.random() * window.innerWidth;
            const animationDelay = Math.random() * 4;
            const animationDuration = 4 + Math.random() * 2;
            
            particle.style.left = startX + 'px';
            particle.style.animationDelay = animationDelay + 's';
            particle.style.animationDuration = animationDuration + 's';
            
            container.appendChild(particle);
            
            // æ¸…ç†æ—§ç²’å­
            setTimeout(() => {
                if (particle.parentElement) {
                    particle.remove();
                }
            }, (animationDelay + animationDuration) * 1000);
        }

        // é¡µé¢åŠ è½½æ—¶ç«‹å³å¯åŠ¨çƒŸèŠ±èƒŒæ™¯ - åœ¨å¼€å§‹ç•Œé¢å°±æœ‰ç²’å­æ•ˆæœ
        setTimeout(createFireworkBackground, 50); // è¿›ä¸€æ­¥å‡å°‘å»¶è¿Ÿï¼Œç«‹å³å¯åŠ¨
        
        // å¯åŠ¨å¼€å§‹é¡µé¢çš„ç²’å­æ•ˆæœ
        setTimeout(createStartParticles, 100);
        
        // æµ‹è¯•å…¥å£å·²ç§»é™¤
        
        // è›‹ç³•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('heart-button').addEventListener('click', function() {
            // ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
            this.style.pointerEvents = 'none';
            
            // å…ˆè®©"ç”Ÿæ—¥å¿«ä¹"å››ä¸ªå­—æ¶ˆå¤±
            const birthdayText = document.getElementById('birthday-text');
            if (birthdayText) {
                // å…ˆåœæ­¢CSSåŠ¨ç”»
                birthdayText.style.animation = 'none';
                // åŒæ—¶åœæ­¢æ‰€æœ‰spançš„åŠ¨ç”»
                const spans = birthdayText.querySelectorAll('span');
                spans.forEach(span => {
                    span.style.animation = 'none';
                });
                
                // ç„¶åæ‰§è¡Œæ¶ˆå¤±åŠ¨ç”»
                birthdayText.style.transition = 'all 0.6s ease-out';
                birthdayText.style.transform = 'translate(-50%, -50%) scale(0) rotate(180deg)';
                birthdayText.style.opacity = '0';
            }
            
            // åˆ›å»ºé¡µé¢è½¬åœºæ•ˆæœ
            createPageTransition();
            
            // å»¶è¿Ÿåè¿›å…¥æ–°é¡µé¢å¹¶æ˜¾ç¤ºè›‹ç³•
            setTimeout(() => {
                transitionToCakePage();
            }, 1200);
            
            // æŒ‰é’®åŠ¨ç”»æ•ˆæœ
            this.style.transform = 'scale(0.8)';
            setTimeout(() => {
                this.style.transform = 'scale(1.2)';
            }, 100);
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 200);
        });
        
        // åˆ›å»ºé¡µé¢è½¬åœºæ•ˆæœ
        function createPageTransition() {
            const container = document.getElementById('animation-container');
            if (!container) return;
            
            // åˆ›å»ºå…¨å±é®ç½©å±‚
            const transitionOverlay = document.createElement('div');
            transitionOverlay.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: radial-gradient(circle, rgba(255, 255, 255, 0) 0%, rgba(255, 182, 193, 0.9) 100%);
                z-index: 10000;
                opacity: 0;
                transition: all 1.2s cubic-bezier(0.4, 0, 0.2, 1);
                pointer-events: none;
            `;
            
            container.appendChild(transitionOverlay);
            
            // åŠ¨ç”»æ˜¾ç¤ºé®ç½©
            setTimeout(() => {
                transitionOverlay.style.opacity = '1';
            }, 10);
        }
        
        // è½¬åœºåˆ°è›‹ç³•é¡µé¢
        function transitionToCakePage() {
            const container = document.getElementById('animation-container');
            const cardContainer = document.querySelector('.card-container');
            if (!container || !cardContainer) return;
            
            // éšè—æ‰€æœ‰ç°æœ‰å…ƒç´ ï¼ˆé™¤äº†èƒŒæ™¯ï¼‰
            hideCurrentElements();
            
            // æ¸…ç©ºå®¹å™¨å¹¶åˆ›å»ºæ–°é¡µé¢
            setTimeout(() => {
                container.innerHTML = '';
                createCakePage();
            }, 600);
        }
        
        // éšè—å½“å‰é¡µé¢å…ƒç´ 
        function hideCurrentElements() {
            // éšè—ç”Ÿæ—¥æ–‡å­—
            const birthdayText = document.getElementById('birthday-text');
            if (birthdayText) {
                birthdayText.style.transition = 'all 0.6s ease-out';
                birthdayText.style.transform = 'translate(-50%, -50%) scale(0) rotate(180deg)';
                birthdayText.style.opacity = '0';
            }
            
            // éšè—æ°”çƒ
            balloons.forEach(balloon => {
                if (balloon && balloon.parentElement) {
                    balloon.style.transition = 'all 0.6s ease-out';
                    balloon.style.transform = 'translateY(100vh) scale(0) rotate(360deg)';
                    balloon.style.opacity = '0';
                }
            });
            
            // éšè—è›‹ç³•æŒ‰é’®
            const heartButton = document.getElementById('heart-button');
            if (heartButton) {
                heartButton.style.transition = 'all 0.6s ease-out';
                heartButton.style.transform = 'scale(0) rotate(180deg)';
                heartButton.style.opacity = '0';
            }
            
            // æ¸…ç©ºæ°”çƒæ•°ç»„
            balloons = [];
        }
        
        // åˆ›å»ºè›‹ç³•é¡µé¢
        function createCakePage() {
            const container = document.getElementById('animation-container');
            if (!container) return;
            
            // åˆ›å»ºè›‹ç³•é¡µé¢èƒŒæ™¯ - ä¿æŒåŸæœ‰ç²‰è‰²ç³»
            const cakeBackground = document.createElement('div');
            cakeBackground.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: 
                    radial-gradient(circle at 30% 70%, rgba(255, 218, 224, 0.3) 0%, transparent 60%),
                    radial-gradient(circle at 70% 30%, rgba(255, 192, 203, 0.3) 0%, transparent 60%),
                    #ffe4e1; /* æ”¹ä¸ºç»Ÿä¸€çš„èƒŒæ™¯é¢œè‰² */
                z-index: 1;
            `;
            
            container.appendChild(cakeBackground);
            
            // åˆ›å»ºæµæ˜Ÿé›¨å®¹å™¨
            const meteorShower = document.createElement('div');
            meteorShower.className = 'meteor-shower';
            meteorShower.id = 'meteor-shower';
            container.appendChild(meteorShower);
            
            // å»¶è¿Ÿåˆ›å»ºè›‹ç³•å’Œæµæ˜Ÿé›¨
            setTimeout(() => {
                createSimpleCake();
                createMeteorShower();
            }, 800);
        }
        
        // åˆ›å»ºè›‹ç³•çˆ†å‘æ•ˆæœ
        function createCakeBurst() {
            const button = document.getElementById('heart-button');
            const buttonRect = button.getBoundingClientRect();
            const container = document.getElementById('animation-container');
            
            // ä½¿ç”¨ä¸åŒçš„ç”Ÿæ—¥ç›¸å…³å›¾æ ‡
            const cakeIcons = ['ğŸ‚', 'ğŸ°', 'ğŸ§', 'ğŸˆ', 'âœ¨', 'ğŸŒŸ'];
            
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                particle.innerHTML = cakeIcons[Math.floor(Math.random() * cakeIcons.length)];
                particle.style.cssText = `
                    position: absolute;
                    left: ${buttonRect.left + buttonRect.width / 2}px;
                    top: ${buttonRect.top + buttonRect.height / 2}px;
                    transform: translate(-50%, -50%) scale(0) rotate(0deg);
                    font-size: ${14 + Math.random() * 10}px;
                    pointer-events: none;
                    z-index: 1000;
                    opacity: 0;
                `;
                
                container.appendChild(particle);
                
                // éšæœºæ–¹å‘å’Œè·ç¦»
                const angle = (Math.PI * 2 * i) / 12 + (Math.random() - 0.5) * 0.5;
                const distance = 40 + Math.random() * 80;
                const duration = 1 + Math.random() * 1;
                const rotation = Math.random() * 360;
                
                setTimeout(() => {
                    particle.style.transition = `all ${duration}s ease-out`;
                    particle.style.transform = `translate(${Math.cos(angle) * distance - 50}%, ${Math.sin(angle) * distance - 50}%) scale(1) rotate(${rotation}deg)`;
                    particle.style.opacity = '1';
                }, 50);
                
                setTimeout(() => {
                    particle.style.transform = `translate(${Math.cos(angle) * distance - 50}%, ${Math.sin(angle) * distance - 150}%) scale(0.3) rotate(${rotation + 180}deg)`;
                    particle.style.opacity = '0';
                }, duration * 800);
                
                setTimeout(() => {
                    particle.remove();
                }, duration * 1500);
            }
        }
        
        // åˆ›å»ºå¯çˆ±å¡é€šé£æ ¼è›‹ç³•
        function createSimpleCake() {
            const container = document.getElementById('animation-container');
            if (!container) return;
            
            // åˆ›å»ºè›‹ç³•å®¹å™¨ - ä½¿ç”¨æ›´ç®€å•çš„å®šä½æ–¹å¼
            const cakeWrapper = document.createElement('div');
            cakeWrapper.style.cssText = `
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                z-index: 900;
                pointer-events: none;
                transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                width: 200px;
                height: 200px;
            `;
            
            // è›‹ç³•åº•ç›˜ - å¯çˆ±å¡é€šé£æ ¼ï¼Œå»æ‰é˜´å½±
            const cakeBase = document.createElement('div');
            cakeBase.style.cssText = `
                position: absolute;
                bottom: 10px;
                left: 50%;
                transform: translateX(-50%);
                width: 180px;
                height: 25px;
                background: linear-gradient(90deg, #ffd4e5 0%, #ff9eb5 50%, #ffd4e5 100%);
                border-radius: 50%;
                z-index: 1;
            `;
            
            // è›‹ç³•åº•å±‚ - å¯çˆ±å¡é€šé£æ ¼
            const cakeLayer1 = document.createElement('div');
            cakeLayer1.style.cssText = `
                position: absolute;
                bottom: 35px;
                left: 50%;
                transform: translateX(-50%);
                width: 150px;
                height: 45px;
                background: linear-gradient(180deg, #ffe0f0 0%, #ffb8d1 50%, #ff8fab 100%);
                border-radius: 18px 18px 12px 12px;
                box-shadow: 
                    0 12px 30px rgba(255, 143, 171, 0.3),
                    inset 0 -5px 10px rgba(255, 105, 180, 0.2),
                    inset 0 4px 8px rgba(255, 255, 255, 0.6);
                z-index: 2;
            `;
            
            // è›‹ç³•ä¸­å±‚ - å¯çˆ±å¡é€šé£æ ¼
            const cakeLayer2 = document.createElement('div');
            cakeLayer2.style.cssText = `
                position: absolute;
                bottom: 80px;
                left: 50%;
                transform: translateX(-50%);
                width: 125px;
                height: 42px;
                background: linear-gradient(180deg, #fff0f5 0%, #ffd4e5 50%, #ffb8d1 100%);
                border-radius: 15px 15px 10px 10px;
                box-shadow: 
                    0 10px 25px rgba(255, 182, 193, 0.3),
                    inset 0 -4px 8px rgba(255, 143, 171, 0.15),
                    inset 0 4px 6px rgba(255, 255, 255, 0.7);
                z-index: 3;
            `;
            
            // è›‹ç³•é¡¶å±‚ - å¯çˆ±å¡é€šé£æ ¼
            const cakeLayer3 = document.createElement('div');
            cakeLayer3.style.cssText = `
                position: absolute;
                bottom: 122px;
                left: 50%;
                transform: translateX(-50%);
                width: 105px;
                height: 40px;
                background: linear-gradient(180deg, #fff8fa 0%, #ffe0f0 50%, #ffd4e5 100%);
                border-radius: 12px 12px 8px 8px;
                box-shadow: 
                    0 8px 20px rgba(255, 218, 224, 0.3),
                    inset 0 -3px 6px rgba(255, 182, 193, 0.1),
                    inset 0 3px 4px rgba(255, 255, 255, 0.8);
                z-index: 4;
            `;
            

            

            

            
            // å¡é€šèœ¡çƒ›
            const candle = document.createElement('div');
            candle.style.cssText = `
                position: absolute;
                bottom: 162px;
                left: 50%;
                transform: translateX(-50%);
                width: 14px;
                height: 36px;
                background: linear-gradient(90deg, #fff8f0 0%, #ffe4d6 50%, #fff8f0 100%);
                border-radius: 7px 7px 4px 4px;
                box-shadow: 
                    0 5px 12px rgba(255, 182, 193, 0.2),
                    inset 0 -4px 8px rgba(255, 143, 171, 0.1),
                    inset 0 3px 5px rgba(255, 255, 255, 0.8);
                z-index: 5;
            `;
            
            // èœ¡çƒ›èºæ—‹çº¹
            for (let i = 0; i < 5; i++) {
                const swirl = document.createElement('div');
                swirl.style.cssText = `
                    position: absolute;
                    width: 100%;
                    height: 2px;
                    background: rgba(255, 182, 193, 0.3);
                    top: ${8 + i * 6}px;
                    border-radius: 1px;
                    transform: rotate(3deg);
                `;
                candle.appendChild(swirl);
            }
            
            // å¯çˆ±ç«ç„°å®¹å™¨ - ä¿®å¤ä¸­å¿ƒå®šä½
            const flame = document.createElement('div');
            flame.style.cssText = `
                position: absolute;
                top: -38px;
                left: 50%;
                transform: translateX(-50%);
                width: 26px;
                height: 32px;
                pointer-events: none;
                z-index: 6;
            `;
            
            // åªä¿ç•™å†…ç„° - å»æ‰å¤–ç„°
            const flameInner = document.createElement('div');
            flameInner.style.cssText = `
                position: absolute;
                bottom: 0px;
                left: 50%;
                transform: translateX(-50%);
                width: 12px;
                height: 18px;
                background: 
                    radial-gradient(ellipse at center bottom, #fff 0%, #ffeaa7 40%, #fdcb6e 80%, transparent 100%);
                border-radius: 50% 50% 50% 50% / 70% 70% 30% 30%;
                animation: cuteInnerFlame 0.4s ease-in-out infinite alternate;
                filter: brightness(1.2);
                box-shadow: 
                    0 0 15px #ff9558,
                    0 0 25px rgba(255, 149, 88, 0.4);
            `;
            
            // ç«ç„°å¿ƒå½¢è£…é¥° - å±…ä¸­å¯¹é½
            const flameHeart = document.createElement('div');
            flameHeart.innerHTML = 'â™¥';
            flameHeart.style.cssText = `
                position: absolute;
                top: 5px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 11px;
                color: #ff6b35;
                opacity: 0.7;
                animation: heartFloat 2s ease-in-out infinite;
                filter: drop-shadow(0 0 4px rgba(255, 107, 53, 0.5));
            `;
            
            // å¯çˆ±ç«ç„°å’Œè›‹ç³•åŠ¨ç”»æ ·å¼
            const cuteStyles = document.createElement('style');
            cuteStyles.textContent = `
                @keyframes cuteFlameFlicker {
                    0% { 
                        transform: translateX(-50%) scale(1) rotate(-3deg); 
                        opacity: 0.85; 
                    }
                    100% { 
                        transform: translateX(-50%) scale(1.15) rotate(3deg); 
                        opacity: 1; 
                    }
                }
                @keyframes cuteInnerFlame {
                    0% { 
                        transform: translateX(-50%) scale(0.85); 
                        opacity: 0.7; 
                    }
                    100% { 
                        transform: translateX(-50%) scale(1.1); 
                        opacity: 1; 
                    }
                }

                @keyframes heartFloat {
                    0%, 100% { 
                        transform: translateX(-50%) translateY(0); 
                        opacity: 0.6; 
                    }
                    50% { 
                        transform: translateX(-50%) translateY(-3px); 
                        opacity: 0.8; 
                    }
                }

                @keyframes cuteCakeFloat {
                    0%, 100% { 
                        transform: translate(-50%, -50%) translateY(0) rotate(0deg) scale(1); 
                    }
                    25% { 
                        transform: translate(-50%, -50%) translateY(-3px) rotate(0.5deg) scale(1.01); 
                    }
                    50% { 
                        transform: translate(-50%, -50%) translateY(-2px) rotate(-0.5deg) scale(1); 
                    }
                    75% { 
                        transform: translate(-50%, -50%) translateY(-4px) rotate(0.3deg) scale(1.005); 
                    }
                }
            `;
            
            // æ·»åŠ æ˜Ÿå…‰è£…é¥°åˆ°è›‹ç³•é¡¶å±‚
            for (let i = 0; i < 3; i++) {
                const sparkle = document.createElement('div');
                const randomX = 20 + Math.random() * 60;
                const randomY = 10 + Math.random() * 30;
                sparkle.style.cssText = `
                    position: absolute;
                    width: 4px;
                    height: 4px;
                    background: #fff;
                    border-radius: 50%;
                    left: ${randomX}%;
                    top: ${randomY}%;
                    box-shadow: 
                        0 0 6px rgba(255, 255, 255, 0.8),
                        0 0 10px rgba(255, 255, 255, 0.4);
                    animation: twinkle 1.5s ease-in-out infinite;
                    animation-delay: ${i * 0.3}s;
                `;
                cakeLayer3.appendChild(sparkle);
            }
            
            // æ·»åŠ é—ªå…‰åŠ¨ç”»æ ·å¼
            const twinkleStyle = document.createElement('style');
            twinkleStyle.textContent = `
                @keyframes twinkle {
                    0%, 100% { opacity: 0.3; transform: scale(0.8); }
                    50% { opacity: 1; transform: scale(1.2); }
                }
            `;
            document.head.appendChild(twinkleStyle);
            
            // åˆ›å»ºäº‘æœµè£…é¥°
            function createCloud(x, y, scale, delay) {
                const cloud = document.createElement('div');
                cloud.style.cssText = `
                    position: absolute;
                    left: ${x}px;
                    top: ${y}px;
                    transform: scale(${scale});
                    opacity: 0.8;
                    animation: cloudFloat ${8 + Math.random() * 4}s ease-in-out infinite;
                    animation-delay: ${delay}s;
                    z-index: 0;
                    filter: drop-shadow(0 8px 16px rgba(255, 182, 193, 0.15));
                `;
                
                // äº‘æœµç”±å¤šä¸ªåœ†å½¢ç»„æˆï¼Œæ›´åŠ è“¬æ¾
                const cloudCircles = [
                    { size: 30, x: 0, y: 0, opacity: 0.9 },
                    { size: 25, x: 18, y: -3, opacity: 0.8 },
                    { size: 28, x: 32, y: 1, opacity: 0.85 },
                    { size: 22, x: -15, y: 3, opacity: 0.75 },
                    { size: 20, x: 48, y: 4, opacity: 0.7 },
                    { size: 18, x: 8, y: -8, opacity: 0.6 }
                ];
                
                cloudCircles.forEach((circle, index) => {
                    const puff = document.createElement('div');
                    puff.style.cssText = `
                        position: absolute;
                        width: ${circle.size}px;
                        height: ${circle.size}px;
                        background: radial-gradient(circle at 30% 30%, 
                            rgba(255, 255, 255, ${circle.opacity}) 0%, 
                            rgba(255, 248, 250, ${circle.opacity * 0.8}) 40%, 
                            rgba(255, 240, 245, ${circle.opacity * 0.6}) 70%,
                            rgba(255, 228, 235, ${circle.opacity * 0.3}) 100%);
                        border-radius: 50%;
                        left: ${circle.x}px;
                        top: ${circle.y}px;
                        box-shadow: 
                            0 6px 12px rgba(255, 182, 193, 0.15),
                            inset 0 3px 6px rgba(255, 255, 255, 0.9),
                            inset -2px -2px 4px rgba(255, 220, 230, 0.4);
                        animation: cloudPuff ${3 + index * 0.5}s ease-in-out infinite alternate;
                        animation-delay: ${delay + index * 0.2}s;
                    `;
                    cloud.appendChild(puff);
                });
                
                return cloud;
            }
            
            // æ·»åŠ äº‘æœµåˆ°è›‹ç³•ä¸Šæ–¹
            const cloud1 = createCloud(-60, -40, 0.8, 0);
            
            // ä¸ºcloud1æ·»åŠ å‘¨æœŸæ€§ç¼©æ”¾åŠ¨ç”»ï¼ˆ2ç§’å‘¨æœŸï¼‰
            cloud1.style.animation = 'cloudScale 2s ease-in-out infinite, cloudFloat 8s ease-in-out infinite';
            
            // ä¸ºå·¦ä¸Šè§’çš„äº‘æœµæ·»åŠ ç‚¹å‡»äº‹ä»¶ - å¹ç­èœ¡çƒ›
            cloud1.style.cursor = 'pointer';
            cloud1.style.pointerEvents = 'auto';
            // ç®€åŒ–äº‘æœµæ ·å¼ï¼Œç§»é™¤è§å…‰æ•ˆæœ
            cloud1.style.transition = 'all 0.3s ease';
            




            
            cloud1.addEventListener('click', function(e) {
                e.stopPropagation();
                blowOutCandles(flame, cloud1, candle);
            });
            
            // æ·»åŠ äº‘æœµåŠ¨ç”»æ ·å¼
            const cloudStyle = document.createElement('style');
            cloudStyle.textContent = `
                @keyframes cloudFloat {
                    0%, 100% { 
                        transform: translateY(0) scale(1); 
                        opacity: 0.8; 
                    }
                    25% { 
                        transform: translateY(-8px) scale(1.03); 
                        opacity: 0.85; 
                    }
                    50% { 
                        transform: translateY(-4px) scale(0.97); 
                        opacity: 0.75; 
                    }
                    75% { 
                        transform: translateY(-10px) scale(1.02); 
                        opacity: 0.8; 
                    }
                }
                
                @keyframes cloudScale {
                    0%, 100% { 
                        transform: scale(1); 
                    }
                    25% { 
                        transform: scale(1.1); 
                    }
                    50% { 
                        transform: scale(1); 
                    }
                    75% { 
                        transform: scale(0.9); 
                    }
                }
                

                

                
                @keyframes cloudPuff {
                    0% { 
                        transform: scale(1); 
                        filter: brightness(1) drop-shadow(0 8px 16px rgba(255, 182, 193, 0.15));
                    }
                    100% { 
                        transform: scale(1.05); 
                        filter: brightness(1.1) drop-shadow(0 10px 20px rgba(255, 182, 193, 0.2));
                    }
                }
            `;
            document.head.appendChild(cloudStyle);
            
            // ç»„è£…è›‹ç³•å…ƒç´ 
            flame.appendChild(flameInner);
            flame.appendChild(flameHeart);
            candle.appendChild(flame);
            cakeWrapper.appendChild(cakeBase);
            cakeWrapper.appendChild(cakeLayer1);
            cakeWrapper.appendChild(cakeLayer2);
            cakeWrapper.appendChild(cakeLayer3);
            cakeWrapper.appendChild(candle);
            
            // æ·»åŠ äº‘æœµåˆ°è›‹ç³•å®¹å™¨ï¼ˆåœ¨è›‹ç³•åé¢ï¼‰
            cakeWrapper.appendChild(cloud1);
            
            // æ·»åŠ åˆ°å®¹å™¨
            container.appendChild(cakeWrapper);
            document.head.appendChild(cuteStyles);
            
            // åŠ¨ç”»æ•ˆæœï¼šè›‹ç³•å‡ºç° - ä»ä¸Šæ–¹æ‰è½å¹¶å¼¹è·³
            setTimeout(() => {
                // åˆå§‹ä½ç½®ï¼šä»ä¸Šæ–¹å¾ˆé«˜å¤„å¼€å§‹
                cakeWrapper.style.transform = 'translate(-50%, -250%) scale(0.8) rotate(0deg)';
                cakeWrapper.style.opacity = '0';
                
                setTimeout(() => {
                    // å¿«é€Ÿæ‰è½
                    cakeWrapper.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                    cakeWrapper.style.transform = 'translate(-50%, -60%) scale(1.1) rotate(5deg)';
                    cakeWrapper.style.opacity = '1';
                    
                    setTimeout(() => {
                        // ç¬¬ä¸€æ¬¡å¼¹è·³
                        cakeWrapper.style.transition = 'all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                        cakeWrapper.style.transform = 'translate(-50%, -45%) scale(0.95) rotate(-3deg)';
                        
                        setTimeout(() => {
                            // ç¬¬äºŒæ¬¡å¼¹è·³
                            cakeWrapper.style.transform = 'translate(-50%, -52%) scale(1.02) rotate(2deg)';
                            
                            setTimeout(() => {
                                // ç¬¬ä¸‰æ¬¡å°å¼¹è·³
                                cakeWrapper.style.transform = 'translate(-50%, -49%) scale(0.98) rotate(-1deg)';
                                
                                setTimeout(() => {
                                    // æœ€ç»ˆä½ç½®
                                    cakeWrapper.style.transition = 'all 0.3s ease-out';
                                    cakeWrapper.style.transform = 'translate(-50%, -50%) scale(1) rotate(0deg)';
                                    cakeWrapper.style.opacity = '1';
                                }, 150);
                            }, 200);
                        }, 250);
                    }, 800);
                }, 100);
            }, 100);
            
            // æŒç»­çš„å¯çˆ±æµ®åŠ¨åŠ¨ç”»
            setTimeout(() => {
                cakeWrapper.style.animation = 'cuteCakeFloat 4s ease-in-out infinite';
            }, 1000);
            

            
            // è›‹ç³•ä¸å†è‡ªåŠ¨æ¶ˆå¤±ï¼Œä¿æŒæ˜¾ç¤º
        }
        
        // ===== æ˜¾ç¤ºç”Ÿæ—¥ç¥ç¦ =====
        function showBirthdayWish() {
            // ä»localStorageè·å–ä¿å­˜çš„ç¥ç¦è¯­
            const savedWish = localStorage.getItem('birthdayPersonWish');
            if (!savedWish) {
                // å¦‚æœæ²¡æœ‰ä¿å­˜çš„ç¥ç¦ï¼Œå°è¯•ä»ç”Ÿæ—¥æ•°æ®ä¸­è·å–æœ€æ–°çš„
                const savedData = localStorage.getItem('birthdayData');
                if (savedData) {
                    try {
                        const birthdayData = JSON.parse(savedData);
                        if (birthdayData.length > 0) {
                            // è·å–æœ€æ–°çš„ç”Ÿæ—¥ç¥ç¦
                            const latestData = birthdayData[birthdayData.length - 1];
                            if (latestData && latestData.wish) {
                                displayWish(latestData.wish);
                                return;
                            }
                        }
                    } catch (e) {
                        console.log('è§£æç”Ÿæ—¥æ•°æ®å¤±è´¥:', e);
                    }
                }
                
                // å¦‚æœä»ç„¶æ²¡æœ‰ç¥ç¦ï¼Œæ˜¾ç¤ºé»˜è®¤ç¥ç¦
                displayWish('ğŸ‰ ç”Ÿæ—¥å¿«ä¹ï¼æ„¿ä½ çš„æ¯ä¸€å¤©éƒ½å……æ»¡é˜³å…‰å’Œæ¬¢ç¬‘ï¼ğŸ‚');
            } else {
                displayWish(savedWish);
            }
        }
        
        // ===== æ˜¾ç¤ºç”Ÿæ—¥ç¥ç¦åœ¨å›¾ç‰‡åŒºåŸŸ =====
        function displayBirthdayWish() {
            // ä»localStorageè·å–ä¿å­˜çš„ç¥ç¦è¯­
            const savedWish = localStorage.getItem('birthdayPersonWish');
            if (!savedWish) {
                // å¦‚æœæ²¡æœ‰ä¿å­˜çš„ç¥ç¦ï¼Œå°è¯•ä»ç”Ÿæ—¥æ•°æ®ä¸­è·å–æœ€æ–°çš„
                const savedData = localStorage.getItem('birthdayData');
                if (savedData) {
                    try {
                        const birthdayData = JSON.parse(savedData);
                        if (birthdayData.length > 0) {
                            // è·å–æœ€æ–°çš„ç”Ÿæ—¥ç¥ç¦
                            const latestData = birthdayData[birthdayData.length - 1];
                            if (latestData && latestData.wish) {
                                insertWishContent(latestData.wish);
                                return;
                            }
                        }
                    } catch (e) {
                        console.log('è§£æç”Ÿæ—¥æ•°æ®å¤±è´¥:', e);
                    }
                }
                
                // å¦‚æœä»ç„¶æ²¡æœ‰ç¥ç¦ï¼Œæ˜¾ç¤ºé»˜è®¤ç¥ç¦
                insertWishContent('ğŸ‰ ç”Ÿæ—¥å¿«ä¹ï¼æ„¿ä½ çš„æ¯ä¸€å¤©éƒ½å……æ»¡é˜³å…‰å’Œæ¬¢ç¬‘ï¼ğŸ‚');
            } else {
                insertWishContent(savedWish);
            }
        }
        
        // ===== æ’å…¥ç¥ç¦å†…å®¹åˆ°æŒ‡å®šåŒºåŸŸ =====
        function insertWishContent(wishText) {
            const wishContainer = document.getElementById('birthday-wish-content');
            if (!wishContainer) {
                console.error('æ‰¾ä¸åˆ°ç”Ÿæ—¥ç¥ç¦å®¹å™¨');
                return;
            }
            
            // è®¾ç½®ç¥ç¦å†…å®¹ï¼Œæ”¯æŒæ¢è¡Œ
            wishContainer.innerHTML = wishText.replace(/\n/g, '<br>');
            
            // æ·»åŠ æ·¡å…¥åŠ¨ç”»æ•ˆæœ
            wishContainer.style.opacity = '0';
            wishContainer.style.transform = 'translateY(10px)';
            
            setTimeout(() => {
                wishContainer.style.transition = 'all 0.8s ease';
                wishContainer.style.opacity = '1';
                wishContainer.style.transform = 'translateY(0)';
            }, 100);
        }

        // å¹ç­èœ¡çƒ›çš„åŠ¨ç”»
        function blowOutCandles(flame, cloud, candle) {
            if (!flame || flame.dataset.extinguished === 'true') return;
            
            // æ ‡è®°èœ¡çƒ›å·²ç†„ç­
            flame.dataset.extinguished = 'true';
            
            // åˆ›å»ºé£ç²’å­æ•ˆæœ
            const windContainer = document.createElement('div');
            windContainer.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 1000;
            `;
            
            // åˆ›å»ºé£ç²’å­
            for (let i = 0; i < 15; i++) {
                const windParticle = document.createElement('div');
                const angle = Math.random() * 30 - 15; // -15åº¦åˆ°15åº¦
                const distance = 100 + Math.random() * 150;
                
                windParticle.style.cssText = `
                    position: absolute;
                    width: 3px;
                    height: 3px;
                    background: rgba(255, 255, 255, 0.8);
                    border-radius: 50%;
                    left: 50%;
                    top: 50%;
                    transform: translate(-50%, -50%);
                    opacity: 0;
                    box-shadow: 0 0 6px rgba(255, 255, 255, 0.6);
                `;
                
                windContainer.appendChild(windParticle);
                
                // é£ç²’å­åŠ¨ç”»
                setTimeout(() => {
                    windParticle.style.transition = 'all 1s ease-out';
                    windParticle.style.transform = `
                        translate(calc(-50% + ${Math.cos(angle * Math.PI / 180) * distance}px), 
                                 calc(-50% + ${Math.sin(angle * Math.PI / 180) * distance}px)) 
                        scale(0.5)
                    `;
                    windParticle.style.opacity = '1';
                    windParticle.style.background = `rgba(200, 220, 255, ${0.8 - i * 0.05})`;
                }, 10 + i * 20);
                
                setTimeout(() => {
                    windParticle.style.opacity = '0';
                }, 800 + i * 20);
                
                setTimeout(() => {
                    if (windParticle.parentElement) {
                        windParticle.remove();
                    }
                }, 1200 + i * 20);
            }
            
            // æ·»åŠ é£æ•ˆæœåˆ°å®¹å™¨
            const container = document.getElementById('animation-container');
            const cloudRect = cloud.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            windContainer.style.left = (cloudRect.left - containerRect.left + cloudRect.width / 2 - 100) + 'px';
            windContainer.style.top = (cloudRect.top - containerRect.top + cloudRect.height / 2 - 100) + 'px';
            container.appendChild(windContainer);
            
            // èœ¡çƒ›ç«ç„°è¢«å¹ç­çš„åŠ¨ç”»
            const flameInner = flame.querySelector('div');
            const flameHeart = flame.querySelector('div:last-child');
            
            // äº‘æœµå‘å‰ç§»åŠ¨æ•ˆæœ
            cloud.style.transition = 'all 0.3s ease-out';
            cloud.style.transform = 'scale(0.9) translateX(10px) translateY(-5px)';
            
            // ç«ç„°è¢«å¹åŠ¨æ•ˆæœ
            flame.style.transition = 'all 0.3s ease-out';
            flame.style.transform = 'translateX(-50%) rotate(-15deg) scale(0.8)';
            flameInner.style.animation = 'none';
            
            setTimeout(() => {
                flame.style.transform = 'translateX(-50%) rotate(25deg) scale(0.3)';
                flame.style.opacity = '0.5';
            }, 200);
            
            setTimeout(() => {
                flame.style.transform = 'translateX(-50%) rotate(-10deg) scale(0.1)';
                flame.style.opacity = '0.2';
            }, 400);
            
            setTimeout(() => {
                flame.style.transform = 'translateX(-50%) rotate(0deg) scale(0)';
                flame.style.opacity = '0';
                flameInner.style.display = 'none';
                flameHeart.style.display = 'none';
            }, 600);
            
            // èœ¡çƒ›ä¸Šå‡å¹¶æ¶ˆå¤±çš„åŠ¨ç”»
            setTimeout(() => {
                candle.style.transition = 'all 2s ease-out';
                candle.style.transform = 'translateX(-50%) translateY(-100px) scale(0.5)';
                candle.style.opacity = '0.7';
            }, 800);
            
            setTimeout(() => {
                candle.style.transform = 'translateX(-50%) translateY(-200px) scale(0.3)';
                candle.style.opacity = '0.4';
            }, 1200);
            
            setTimeout(() => {
                candle.style.transform = 'translateX(-50%) translateY(-300px) scale(0.1)';
                candle.style.opacity = '0.1';
            }, 1600);
            
            setTimeout(() => {
                candle.style.transform = 'translateX(-50%) translateY(-400px) scale(0)';
                candle.style.opacity = '0';
                // å®Œå…¨éšè—èœ¡çƒ›
                candle.style.display = 'none';
            }, 2000);
            
            // åˆ›å»ºçƒŸé›¾æ•ˆæœ
            createSmoke(flame);
            
            // èœ¡çƒ›æ¶ˆå¤±ååˆ›å»ºå‘å³ç®­å¤´æç¤º
            setTimeout(() => {
                createRightArrow();
            }, 2100);
            
            // äº‘æœµå›åˆ°åŸä½
            setTimeout(() => {
                cloud.style.transform = 'scale(0.8) translateX(0) translateY(0)';
            }, 800);
            
            // æ¸…ç†é£ç²’å­å®¹å™¨
            setTimeout(() => {
                if (windContainer.parentElement) {
                    windContainer.remove();
                }
            }, 2000);
        }
        
        // åˆ›å»ºçƒŸé›¾æ•ˆæœ
        function createSmoke(flame) {
            const smokeContainer = document.createElement('div');
            smokeContainer.style.cssText = `
                position: absolute;
                top: 100%;
                left: 50%;
                transform: translateX(-50%);
                width: 20px;
                height: 40px;
                pointer-events: none;
                z-index: 7;
            `;
            
            // åˆ›å»ºçƒŸé›¾ç²’å­
            for (let i = 0; i < 8; i++) {
                const smokeParticle = document.createElement('div');
                const offsetX = (Math.random() - 0.5) * 20;
                const delay = i * 100;
                
                smokeParticle.style.cssText = `
                    position: absolute;
                    width: ${6 + Math.random() * 8}px;
                    height: ${6 + Math.random() * 8}px;
                    background: rgba(200, 200, 200, 0.4);
                    border-radius: 50%;
                    left: ${10 + offsetX}px;
                    top: 0;
                    opacity: 0;
                    filter: blur(2px);
                `;
                
                smokeContainer.appendChild(smokeParticle);
                
                // çƒŸé›¾ä¸Šå‡åŠ¨ç”»
                setTimeout(() => {
                    smokeParticle.style.transition = 'all 2s ease-out';
                    smokeParticle.style.transform = `
                        translateY(-30 - Math.random() * 20px) 
                        translateX(${(Math.random() - 0.5) * 30}px) 
                        scale(2)
                    `;
                    smokeParticle.style.opacity = '0.6';
                    smokeParticle.style.background = 'rgba(180, 180, 180, 0.2)';
                }, delay);
                
                setTimeout(() => {
                    smokeParticle.style.opacity = '0';
                    smokeParticle.style.transform = `
                        translateY(-50 - Math.random() * 20px) 
                        translateX(${(Math.random() - 0.5) * 40}px) 
                        scale(3)
                    `;
                }, 1500 + delay);
                
                setTimeout(() => {
                    if (smokeParticle.parentElement) {
                        smokeParticle.remove();
                    }
                }, 2500 + delay);
            }
            
            flame.appendChild(smokeContainer);
            
            // æ¸…ç†çƒŸé›¾å®¹å™¨
            setTimeout(() => {
                if (smokeContainer.parentElement) {
                    smokeContainer.remove();
                }
            }, 5000);
        }
        
        // åˆ›å»ºæµæ˜Ÿé›¨æ•ˆæœ
        function createMeteorShower() {
            const meteorContainer = document.getElementById('meteor-shower');
            if (!meteorContainer) return;
            
            // åˆ›å»ºå•ä¸ªæµæ˜Ÿ
            function createMeteor() {
                const meteor = document.createElement('div');
                meteor.className = 'meteor';
                
                // éšæœºèµ·å§‹ä½ç½®ï¼ˆä»æ•´ä¸ªå±å¹•é¡¶éƒ¨åŒºåŸŸå¼€å§‹ï¼‰
                const startX = Math.random() * window.innerWidth; // æ•´ä¸ªå±å¹•å®½åº¦
                const startY = -50 + Math.random() * 150; // å±å¹•é¡¶éƒ¨åŒºåŸŸ
                
                meteor.style.cssText = `
                    position: absolute;
                    left: ${startX}px;
                    top: ${startY}px;
                    animation: meteorFall ${1.5 + Math.random() * 1.5}s linear infinite;
                    animation-delay: ${Math.random() * 2}s;
                `;
                
                meteorContainer.appendChild(meteor);
                
                // æ¸…ç†å·²ç»ç¦»å¼€å±å¹•çš„æµæ˜Ÿ
                setTimeout(() => {
                    if (meteor.parentElement) {
                        meteor.remove();
                    }
                }, 4000);
            }
            
            // åˆå§‹åˆ›å»ºæ›´å¤šæµæ˜Ÿ
            for (let i = 0; i < 12; i++) {
                setTimeout(() => createMeteor(), i * 200);
            }
            
            // åˆå§‹åˆ›å»ºä¸€äº›å½©è‰²æµæ˜Ÿ
            for (let i = 0; i < 6; i++) {
                setTimeout(() => createColorfulMeteor(), i * 400);
            }
            
            // æŒç»­åˆ›å»ºæ–°çš„æµæ˜Ÿ - å¢åŠ é¢‘ç‡å’Œæ¦‚ç‡
            setInterval(() => {
                if (Math.random() < 0.85) { // 85%æ¦‚ç‡åˆ›å»ºæ–°æµæ˜Ÿ
                    createMeteor();
                }
            }, 400); // å‡å°‘é—´éš”æ—¶é—´
            
            // åˆ›å»ºç‰¹æ®Šçš„å½©è‰²æµæ˜Ÿ
            function createColorfulMeteor() {
                const meteor = document.createElement('div');
                meteor.className = 'meteor';
                
                // éšæœºèµ·å§‹ä½ç½®ï¼ˆä»æ•´ä¸ªå±å¹•é¡¶éƒ¨åŒºåŸŸå¼€å§‹ï¼‰
                const startX = Math.random() * window.innerWidth; // æ•´ä¸ªå±å¹•å®½åº¦
                const startY = -50 + Math.random() * 150; // å±å¹•é¡¶éƒ¨åŒºåŸŸ
                
                // å›ºå®šä½¿ç”¨ç™½ç²‰è‰²ç³»
                const pinkShades = [
                    'rgba(255, 255, 255, 0.95)', // çº¯ç™½è‰²
                    'rgba(255, 250, 250, 0.9)', // é›ªèŠ±ç™½
                    'rgba(255, 245, 245, 0.9)', // æµ…ç²‰è‰²
                    'rgba(255, 240, 240, 0.9)', // æ¡ƒç²‰è‰²
                    'rgba(255, 235, 235, 0.9)', // æµ…æ¡ƒç²‰
                    'rgba(255, 230, 230, 0.9)', // ä¸­ç²‰è‰²
                    'rgba(255, 220, 220, 0.9)', // æ ‡å‡†ç²‰è‰²
                    'rgba(255, 210, 210, 0.9)', // ç«ç‘°ç²‰
                    'rgba(255, 200, 200, 0.9)', // æ·±ç²‰è‰²
                    'rgba(255, 182, 193, 0.9)', // åŸç²‰è‰²
                ];
                const selectedColor = pinkShades[Math.floor(Math.random() * pinkShades.length)];
                
                meteor.style.cssText = `
                    position: absolute;
                    left: ${startX}px;
                    top: ${startY}px;
                    width: 3px;
                    height: 3px;
                    background: ${selectedColor};
                    border-radius: 50%;
                    box-shadow: 
                        0 0 15px 3px ${selectedColor},
                        0 0 30px 6px ${selectedColor.replace('0.8', '0.4')},
                        0 0 45px 9px ${selectedColor.replace('0.8', '0.2')};
                    animation: meteorFall ${2 + Math.random() * 2}s linear infinite;
                `;
                
                // å½©è‰²æµæ˜Ÿçš„å°¾å·´
                const meteorTail = document.createElement('div');
                meteorTail.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 120px;
                    height: 3px;
                    background: linear-gradient(to left, 
                        transparent 0%, 
                        ${selectedColor.replace('0.8', '0.2')} 30%,
                        ${selectedColor.replace('0.8', '0.4')} 60%,
                        ${selectedColor.replace('0.8', '0.6')} 80%,
                        ${selectedColor} 100%
                    );
                    transform-origin: right center;
                `;
                
                meteor.appendChild(meteorTail);
                meteorContainer.appendChild(meteor);
                
                // æ¸…ç†å½©è‰²æµæ˜Ÿ
                setTimeout(() => {
                    if (meteor.parentElement) {
                        meteor.remove();
                    }
                }, 5000);
            }
            
            // å®šæœŸåˆ›å»ºå½©è‰²æµæ˜Ÿ - å¢åŠ é¢‘ç‡å’Œæ¦‚ç‡
            setInterval(() => {
                if (Math.random() < 0.5) { // 50%æ¦‚ç‡åˆ›å»ºå½©è‰²æµæ˜Ÿ
                    createColorfulMeteor();
                }
            }, 1000); // å‡å°‘é—´éš”æ—¶é—´
        }
        
        // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªé¡µé¢
        function switchToNextPage() {
            const cardContainer = document.querySelector('.card-container');
            if (!cardContainer) return;
            
            // æ¸…ç†æ—§çš„äº‹ä»¶ç›‘å¬å™¨å’ŒçŠ¶æ€
            cleanupOldState();
            
            // åˆ›å»ºå…¨å±è¿‡æ¸¡æ•ˆæœ
            const transitionOverlay = document.createElement('div');
            transitionOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #ffe4e1; /* æ”¹ä¸ºç»Ÿä¸€çš„èƒŒæ™¯é¢œè‰² */
                z-index: 10000;
                opacity: 0;
                transition: opacity 0.6s ease-in-out;
                pointer-events: none;
            `;
            
            document.body.appendChild(transitionOverlay);
            
            // æ·¡å…¥è¿‡æ¸¡æ•ˆæœ
            setTimeout(() => {
                transitionOverlay.style.opacity = '1';
            }, 50);
            
            // æ‰§è¡Œé¡µé¢åˆ‡æ¢
            setTimeout(() => {
                // æ¸…é™¤å½“å‰å†…å®¹
                cardContainer.innerHTML = '';
                
                // åˆ›å»ºæ–°çš„é¡µé¢å†…å®¹ - å¯æ‹–åŠ¨ç•Œé¢ï¼ˆå¢å¤§å°ºå¯¸ï¼‰
                const nextPageContent = document.createElement('div');
                nextPageContent.id = 'draggable-content';
                nextPageContent.style.cssText = `
                    width: 100%;
                    height: 700%; /* é€‚å½“å¢åŠ é«˜åº¦ï¼Œç¡®ä¿å¯ä»¥çœ‹åˆ°ç”Ÿæˆè´ºå¡æŒ‰é’® */
                    display: flex;
                    flex-direction: column;
                    justify-content: flex-start; /* æ”¹ä¸ºé¡¶éƒ¨å¯¹é½ */
                    align-items: center;
                    text-align: center;
                    padding: 40px 20px 100px 20px; /* é€‚å½“å‡å°‘åº•éƒ¨å†…è¾¹è·ï¼Œç”Ÿæˆè´ºå¡æŒ‰é’®åé¢ä¸éœ€è¦é¢å¤–ç©ºé—´ */
                    background: transparent; /* æ”¹ä¸ºé€æ˜ï¼Œæ˜¾ç¤ºå®¹å™¨èƒŒæ™¯ */
                    border-radius: 40px;
                    position: relative;
                    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30"><circle cx="15" cy="15" r="11" fill="%23ffb6c1" opacity="0.9"/><path d="M15 8 L15 22 M10 13 L15 8 L20 13 M10 17 L15 22 L20 17" stroke="%23fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>') 15 15, ns-resize;
                    user-select: none;
                    transition: transform 0.1s ease-out;
                    overflow-y: visible; /* å…è®¸å†…å®¹æº¢å‡ºæ˜¾ç¤º */
                `;
                
                // åˆ›å»ºç¥ç¦å†…å®¹ï¼ˆå¢å¤§å¹¶æ·»åŠ æ›´å¤šå†…å®¹ï¼‰
                const blessingContent = document.createElement('div');
                blessingContent.innerHTML = `
                    <div style="
                        font-size: 48px;
                        font-weight: bold;
                        color: #ff1493;
                        margin-bottom: 30px;
                        text-shadow: 0 4px 8px rgba(255, 20, 147, 0.3);
                        animation: fadeInScale 1s ease-out;
                    ">
                        ğŸ‰ ç”Ÿæ—¥å¿«ä¹! ğŸ‰
                    </div>
                    <div style="
                        font-size: 24px;
                        color: #ff69b4;
                        margin-bottom: 40px;
                        line-height: 1.6;
                        animation: fadeInUp 1s ease-out 0.3s both;
                    ">
                        æ„¿ä½ çš„æ¯ä¸€å¤©éƒ½å……æ»¡<br>
                        æ¬¢å£°ç¬‘è¯­å’Œå¹¸ç¦æ—¶å…‰
                    </div>
                    <div style="
                        display: flex;
                        gap: 20px;
                        flex-wrap: wrap;
                        justify-content: center;
                        animation: fadeInUp 1s ease-out 0.6s both;
                        margin-bottom: 50px;
                    ">
                        <span style="font-size: 36px;">ğŸ‚</span>
                        <span style="font-size: 36px;">ğŸˆ</span>
                        <span style="font-size: 36px;">ğŸ</span>
                        <span style="font-size: 36px;">ğŸŒŸ</span>
                        <span style="font-size: 36px;">ğŸ’</span>
                        <span style="font-size: 36px;">ğŸŠ</span>
                    </div>
                    
                    <!-- é¢å¤–å†…å®¹åŒºåŸŸ -->
                    <div style="
                        background: rgba(255, 255, 255, 0.3);
                        padding: 30px;
                        border-radius: 20px;
                        margin: 20px 0;
                        backdrop-filter: blur(10px);
                        animation: fadeInUp 1s ease-out 1.5s both;
                    ">
                        <div style="
                            font-size: 20px;
                            color: #ff1493;
                            margin-bottom: 20px;
                            font-weight: bold;
                        ">
                            âœ¨ ä¸“å±ç¥ç¦ âœ¨
                        </div>
                        <div style="
                            font-size: 18px;
                            color: #ff69b4;
                            line-height: 1.8;
                            margin-bottom: 20px;
                        ">
                            æ„¿ä½ çš„æ—¥å­ï¼Œå‘ç€å…‰ï¼Œé—ªé—ªå‘äº®ã€‚<br>
                            æ„¿ä½ çš„æ—…é€”ï¼Œè¿ç€é£ï¼Œå¼€é˜”æ˜æœ—ã€‚<br>
                            æ„¿ä½ çš„å¿ƒä¸­ï¼Œæœ‰çˆ±ï¼Œä¹Ÿæœ‰è¿œæ–¹ã€‚
                        </div>

                    </div>
                    
                    <!-- å›¾ç‰‡å±•ç¤ºåŒºåŸŸ - äº¤æ›¿æ’åˆ— -->
                    <div class="photo-gallery" style="
                        margin-top: 40px;
                        padding: 30px;
                        background: rgba(255, 255, 255, 0.4);
                        border-radius: 20px;
                        animation: fadeInUp 1s ease-out 1.8s both;
                        backdrop-filter: blur(5px);
                    ">
                        <div style="
                            font-size: 22px;
                            color: #ff1493;
                            margin-bottom: 30px;
                            text-align: center;
                            font-weight: bold;
                        ">

                        </div>
                        
                        <!-- ç¬¬1å¼ å›¾ç‰‡ + æ–‡å­— -->
                        <div style="margin-bottom: 40px; animation: fadeInUp 1s ease-out 2s both;">
                            <div style="
                                font-size: 18px;
                                color: #ff69b4;
                                line-height: 1.6;
                                text-align: center;
                                padding: 0 10px;
                                margin-bottom: 15px;
                                font-weight: bold;
                            ">
                                ğŸ‚ ç”Ÿæ—¥å¿«ä¹ï¼
                            </div>
                            <img src="1.jpg" style="
                                width: 100%;
                                height: auto;
                                object-fit: contain;
                                border-radius: 15px;
                                box-shadow: 0 8px 25px rgba(255, 182, 193, 0.3);
                                transition: all 0.3s ease;
                                cursor: pointer;
                                border: 3px solid rgba(255, 255, 255, 0.5);
                                margin-bottom: 15px;
                                max-width: 100%;
                            " onclick="this.style.transform='scale(1.02)'; setTimeout(() => this.style.transform='scale(1)', 500);">
                        </div>
                        
                        <!-- ç¬¬2å¼ å›¾ç‰‡ + æ–‡å­— -->
                        <div style="margin-bottom: 40px; animation: fadeInUp 1s ease-out 2.2s both;">
                            <img src="2.jpg" style="
                                width: 100%;
                                height: auto;
                                object-fit: contain;
                                border-radius: 15px;
                                box-shadow: 0 8px 25px rgba(255, 182, 193, 0.3);
                                transition: all 0.3s ease;
                                cursor: pointer;
                                border: 3px solid rgba(255, 255, 255, 0.5);
                                margin-bottom: 15px;
                                max-width: 100%;
                            " onclick="this.style.transform='scale(1.02)'; setTimeout(() => this.style.transform='scale(1)', 500);">
                            <div style="
                                font-size: 16px;
                                color: #ff69b4;
                                line-height: 1.6;
                                text-align: center;
                                padding: 0 10px;
                            ">
                                æ„¿çƒ›å…‰æ‘‡æ›³ï¼Œç…§äº®ä½ ä»Šæ—¥æ‰€æœ‰çš„ç¬‘å®¹<br>
                                æ‰€æœ‰ç¥ç¦ä¸æ¬¢ç¬‘ï¼Œéƒ½ä¸ºä½ è€Œæ¥
                            </div>
                        </div>
                        
                        <!-- ç¬¬3å¼ å›¾ç‰‡ + æ–‡å­— -->
                        <div style="margin-bottom: 40px; animation: fadeInUp 1s ease-out 2.4s both;">
                            <img src="3.jpg" style="
                                width: 100%;
                                height: auto;
                                object-fit: contain;
                                border-radius: 15px;
                                box-shadow: 0 8px 25px rgba(255, 182, 193, 0.3);
                                transition: all 0.3s ease;
                                cursor: pointer;
                                border: 3px solid rgba(255, 255, 255, 0.5);
                                margin-bottom: 15px;
                                max-width: 100%;
                            " onclick="this.style.transform='scale(1.02)'; setTimeout(() => this.style.transform='scale(1)', 500);">
                            <div style="
                                font-size: 16px;
                                color: #ff69b4;
                                line-height: 1.6;
                                text-align: center;
                                padding: 0 10px;
                            ">

                            </div>
                        </div>
                        
                        <!-- ç¬¬4å¼ å›¾ç‰‡ + æ–‡å­— -->
                        <div style="margin-bottom: 40px; animation: fadeInUp 1s ease-out 2.6s both;">
                            <div style="
                                font-size: 16px;
                                color: #ff69b4;
                                line-height: 1.6;
                                text-align: center;
                                padding: 0 10px;
                                margin-bottom: 15px;
                            ">

                            </div>
                            <img src="4.jpg" style="
                                width: 100%;
                                height: auto;
                                object-fit: contain;
                                border-radius: 15px;
                                box-shadow: 0 8px 25px rgba(255, 182, 193, 0.3);
                                transition: all 0.3s ease;
                                cursor: pointer;
                                border: 3px solid rgba(255, 255, 255, 0.5);
                                margin-bottom: 15px;
                                max-width: 100%;
                            " onclick="this.style.transform='scale(1.02)'; setTimeout(() => this.style.transform='scale(1)', 500);">
                            <div style="
                                font-size: 16px;
                                color: #ff69b4;
                                line-height: 1.6;
                                text-align: center;
                                padding: 0 10px;
                            ">
                                æ€€å¿µé‚£äº›ä¸€èµ·å¤§ç¬‘çš„æ—¥å­ï¼ŒæœŸå¾…æ›´å¤šæœªæ¥çš„æ•…äº‹
                            </div>
                        </div>
                        
                        <!-- ç¬¬5å¼ å›¾ç‰‡ + æ–‡å­— -->
                        <div style="margin-bottom: 40px; animation: fadeInUp 1s ease-out 2.8s both;">
                            <img src="5.jpg" style="
                                width: 100%;
                                height: auto;
                                object-fit: contain;
                                border-radius: 15px;
                                box-shadow: 0 8px 25px rgba(255, 182, 193, 0.3);
                                transition: all 0.3s ease;
                                cursor: pointer;
                                border: 3px solid rgba(255, 255, 255, 0.5);
                                margin-bottom: 15px;
                                max-width: 100%;
                            " onclick="this.style.transform='scale(1.02)'; setTimeout(() => this.style.transform='scale(1)', 500);">
                            <div style="
                                font-size: 16px;
                                color: #ff69b4;
                                line-height: 1.6;
                                text-align: center;
                                padding: 0 10px;
                            ">

                            </div>
                        </div>
                        
                        <!-- ç¬¬6å¼ å›¾ç‰‡ + æ–‡å­— -->
                        <div style="margin-bottom: 40px; animation: fadeInUp 1s ease-out 3s both;">
                            <div style="
                                font-size: 16px;
                                color: #ff69b4;
                                line-height: 1.6;
                                text-align: center;
                                padding: 0 10px;
                                margin-bottom: 15px;
                            ">

                            </div>
                            <img src="6.jpg" style="
                                width: 100%;
                                height: auto;
                                object-fit: contain;
                                border-radius: 15px;
                                box-shadow: 0 8px 25px rgba(255, 182, 193, 0.3);
                                transition: all 0.3s ease;
                                cursor: pointer;
                                border: 3px solid rgba(255, 255, 255, 0.5);
                                margin-bottom: 15px;
                                max-width: 100%;
                            " onclick="this.style.transform='scale(1.02)'; setTimeout(() => this.style.transform='scale(1)', 500);">
                            <div style="
                                font-size: 16px;
                                color: #ff69b4;
                                line-height: 1.6;
                                text-align: center;
                                padding: 0 10px;
                            ">
                                ä¸æ­¢ç”Ÿæ—¥ï¼Œæ„¿ä½ çš„æ¯ä¸€å¤©éƒ½å¥”èµ°åœ¨è‡ªå·±çš„çƒ­çˆ±é‡Œ
                            </div>
                        </div>
                        
                        <!-- ç¬¬7å¼ å›¾ç‰‡ + æ–‡å­— -->
                        <div style="margin-bottom: 40px; animation: fadeInUp 1s ease-out 3.2s both;">
                            <img src="7.jpg" style="
                                width: 100%;
                                height: 200px;
                                object-fit: cover;
                                border-radius: 15px;
                                box-shadow: 0 8px 25px rgba(255, 182, 193, 0.3);
                                transition: all 0.3s ease;
                                cursor: pointer;
                                border: 3px solid rgba(255, 255, 255, 0.5);
                                margin-bottom: 15px;
                            " onclick="this.style.transform='scale(1.02)'; setTimeout(() => this.style.transform='scale(1)', 500);">
                            <div style="
                                font-size: 16px;
                                color: #ff69b4;
                                line-height: 1.6;
                                text-align: center;
                                padding: 0 10px;
                            ">
                                é’æ˜¥ä¸æ•£åœºï¼Œæˆ‘ä»¬çš„æ•…äº‹æ°¸è¿œåœ¨ç»§ç»­
                            </div>
                        </div>
                        
                        <!-- ç¬¬8å¼ å›¾ç‰‡ + æ–‡å­— -->
                        <div style="margin-bottom: 40px; animation: fadeInUp 1s ease-out 3.4s both;">

                            <img src="8.jpg" style="
                                width: 100%;
                                height: 200px;
                                object-fit: cover;
                                border-radius: 15px;
                                box-shadow: 0 8px 25px rgba(255, 182, 193, 0.3);
                                transition: all 0.3s ease;
                                cursor: pointer;
                                border: 3px solid rgba(255, 255, 255, 0.5);
                                margin-bottom: 15px;
                            " onclick="this.style.transform='scale(1.02)'; setTimeout(() => this.style.transform='scale(1)', 500);">
                            <div style="
                                font-size: 16px;
                                color: #ff69b4;
                                line-height: 1.6;
                                text-align: center;
                                padding: 0 10px;
                            ">
                                æ„¿ä½ éå†å±±æ²³ï¼Œè§‰å¾—äººé—´å€¼å¾—
                            </div>
                        </div>
                        
                        <!-- ç¬¬9å¼ å›¾ç‰‡ + ç”Ÿæ—¥ç¥ç¦åŒºåŸŸ -->
                        <div style="margin-bottom: 20px; animation: fadeInUp 1s ease-out 3.6s both;">
                            <img src="9.jpg" style="
                                width: 100%;
                                height: auto;
                                object-fit: contain;
                                border-radius: 15px;
                                box-shadow: 0 8px 25px rgba(255, 182, 193, 0.3);
                                transition: all 0.3s ease;
                                cursor: pointer;
                                border: 3px solid rgba(255, 255, 255, 0.5);
                                margin-bottom: 20px;
                                max-width: 100%;
                            " onclick="this.style.transform='scale(1.02)'; setTimeout(() => this.style.transform='scale(1)', 500);">
                            
                            <!-- ä¸“å±ç”Ÿæ—¥ç¥ç¦åŒºåŸŸ -->
                            <div style="
                                background: linear-gradient(135deg, rgba(255, 182, 193, 0.3), rgba(255, 105, 180, 0.2));
                                padding: 25px;
                                border-radius: 20px;
                                text-align: center;
                                border: 2px solid rgba(255, 255, 255, 0.5);
                                box-shadow: 0 8px 20px rgba(255, 182, 193, 0.2);
                                position: relative;
                                overflow: hidden;
                            ">
                                <div style="
                                    font-size: 18px;
                                    color: #ff1493;
                                    font-weight: bold;
                                    margin-bottom: 15px;
                                    line-height: 1.5;
                                ">
                                    ğŸ’Œ ä¸“å±ç”Ÿæ—¥ç¥ç¦ ğŸ’Œ
                                </div>
                                <div id="birthday-wish-content" style="
                                    font-size: 16px;
                                    color: #ff69b4;
                                    line-height: 1.8;
                                    min-height: 80px;
                                    padding: 15px;
                                    background: rgba(255, 255, 255, 0.6);
                                    border-radius: 12px;
                                    border: 1px dashed rgba(255, 105, 180, 0.5);
                                    transition: all 0.3s ease;
                                    word-wrap: break-word;
                                ">
                                    <!-- ä¸“å±ç¥ç¦å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ’å…¥ -->
                                </div>
                            </div>
                        </div>
                        

                    </div>
                    


                `;
                
                nextPageContent.appendChild(blessingContent);
                
                // æ˜¾ç¤ºä¸ªæ€§åŒ–ç”Ÿæ—¥ç¥ç¦
                setTimeout(() => {
                    displayBirthdayWish();
                }, 4000); // å»¶è¿Ÿ4ç§’æ˜¾ç¤ºï¼Œç¡®ä¿æ‰€æœ‰å›¾ç‰‡åŠ¨ç”»å®Œæˆ
                
                // ç«‹å³è®¾ç½®çˆ±å¿ƒæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
                const loveButton = document.getElementById('love-button');
                if (loveButton && !loveButton.hasAttribute('data-click-setup')) {
                    console.log('ç«‹å³è®¾ç½®çˆ±å¿ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    loveButton.setAttribute('data-click-setup', 'true');
                    
                    loveButton.addEventListener('click', function(e) {
                        console.log('çˆ±å¿ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶è§¦å‘ï¼');
                        
                        // åˆ›å»ºçˆ±å¿ƒé£˜æ•£æ•ˆæœ
                        createHeartExplosion(e.clientX, e.clientY);
                        
                        // æ˜¾ç¤ºçˆ±æ„æ¶ˆæ¯
                        showLoveMessage();
                        
                    }, { once: false });
                    
                    console.log('çˆ±å¿ƒæŒ‰é’®äº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®');
                }
                
                // æ·»åŠ å›¾ç‰‡åŠ è½½é”™è¯¯å¤„ç†
                const images = nextPageContent.querySelectorAll('img');
                images.forEach((img, index) => {
                    img.onerror = function() {
                        // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºå ä½ç¬¦
                        this.style.background = 'linear-gradient(135deg, #ffb6c1, #ffc0cb)';
                        this.style.display = 'flex';
                        this.style.alignItems = 'center';
                        this.style.justifyContent = 'center';
                        this.style.fontSize = '24px';
                        this.style.color = '#fff';
                        this.innerHTML = 'ğŸ“·';
                        this.style.objectFit = 'none';
                    };
                });
                
                // æ·»åŠ åŠ¨ç”»æ ·å¼
                const animationStyles = document.createElement('style');
                animationStyles.textContent = `
                    @keyframes fadeInScale {
                        0% {
                            opacity: 0;
                            transform: scale(0.8);
                        }
                        100% {
                            opacity: 1;
                            transform: scale(1);
                        }
                    }
                    
                    @keyframes fadeInUp {
                        0% {
                            opacity: 0;
                            transform: translateY(30px);
                        }
                        100% {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }
                    
                    @keyframes photoFloat {
                        0%, 100% {
                            transform: translateY(0) rotate(0deg);
                        }
                        25% {
                            transform: translateY(-3px) rotate(1deg);
                        }
                        50% {
                            transform: translateY(2px) rotate(-0.5deg);
                        }
                        75% {
                            transform: translateY(-1px) rotate(0.5deg);
                        }
                    }
                    
                    @keyframes photoGlow {
                        0%, 100% {
                            box-shadow: 0 8px 20px rgba(255, 182, 193, 0.3);
                        }
                        50% {
                            box-shadow: 0 12px 30px rgba(255, 182, 193, 0.5);
                        }
                    }
                    
                    .photo-gallery {
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .photo-gallery img {
                        animation: photoFloat 4s ease-in-out infinite;
                        animation-delay: calc(var(--img-index) * 0.2s);
                    }
                    
                    .photo-gallery img:hover {
                        animation-play-state: paused;
                        animation: photoGlow 1s ease-in-out infinite;
                        z-index: 10;
                    }
                    
                    @media (max-width: 480px) {
                        .photo-gallery .grid-2x2 {
                            grid-template-columns: 1fr !important;
                            gap: 10px !important;
                        }
                        
                        .photo-gallery .grid-3x1 {
                            grid-template-columns: 1fr !important;
                            gap: 8px !important;
                        }
                        
                        .photo-gallery img {
                            height: 150px !important;
                        }
                        
                        #wish-display {
                            margin: 30px 20px 0 !important;
                            padding: 20px 25px !important;
                        }
                        
                        #wish-display > div:first-child {
                            font-size: 18px !important;
                        }
                        
                        #wish-content {
                            font-size: 16px !important;
                        }
                    }
                `;
                document.head.appendChild(animationStyles);
                
                cardContainer.appendChild(nextPageContent);
                

                
                // æ·»åŠ æ‹–åŠ¨åŠŸèƒ½
                makeDraggable(nextPageContent);
                
                // åˆ›å»ºåº†ç¥æ•ˆæœ
                createCelebrationEffect();
                
                // æ·¡å‡ºè¿‡æ¸¡æ•ˆæœ
                setTimeout(() => {
                    transitionOverlay.style.opacity = '0';
                    setTimeout(() => {
                        if (transitionOverlay.parentElement) {
                            transitionOverlay.remove();
                        }
                    }, 600);
                }, 300);
                
            }, 800);
        }
        
        // æ¸…ç†æ—§çŠ¶æ€å‡½æ•°ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
        function cleanupOldState() {
            // ç§»é™¤ç®­å¤´
            const arrow = document.getElementById('right-arrow');
            if (arrow) {
                arrow.remove();
            }
            
            // æ¸…ç†æ°”çƒçš„æ‹–æ‹½çŠ¶æ€
            if (isDragging) {
                isDragging = false;
                draggedBalloon = null;
                dragOffsetX = 0;
                dragOffsetY = 0;
            }
            
            // æ¸…ç†æ°”çƒæ•°ç»„
            balloons = [];
            
            // æ¸…ç†å¯æ‹–åŠ¨å…ƒç´ çš„çŠ¶æ€
            const draggableContent = document.getElementById('draggable-content');
            if (draggableContent && draggableContent.cleanup) {
                draggableContent.cleanup();
            }
            
            // ç§»é™¤æ—§çš„å®šæ—¶å™¨å’Œäº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœéœ€è¦ï¼‰
            const animationContainer = document.getElementById('animation-container');
            if (animationContainer) {
                // æ¸…ç†å®¹å™¨å†…å®¹ï¼Œä½†ä¸ç§»é™¤å®¹å™¨æœ¬èº«
                animationContainer.innerHTML = '';
            }
            
            console.log('æ¸…ç†æ—§çŠ¶æ€å®Œæˆ');
        }
        
        // æ·»åŠ æ‹–åŠ¨åŠŸèƒ½å‡½æ•°ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
        function makeDraggable(element) {
            let isDragging = false;
            let currentX = 0;
            let currentY = 0;
            let initialX = 0;
            let initialY = 0;
            let xOffset = 0;
            let yOffset = 0;
            let lastTimestamp = 0;
            
            // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ requestAnimationFrame
            let animationFrameId = null;
            
            // ä½¿ç”¨å…¨å±€é…ç½®çš„æ‹–åŠ¨é™åˆ¶
            
            // ä½¿ç”¨èŠ‚æµä¼˜åŒ–çš„æ‹–æ‹½å‡½æ•°
            const throttledDrag = (timestamp) => {
                if (!isDragging) return;
                
                // ä½¿ç”¨é…ç½®çš„èŠ‚æµé—´éš”
                if (timestamp - lastTimestamp < CONFIG.DRAG.THROTTLE_INTERVAL) {
                    animationFrameId = requestAnimationFrame(throttledDrag);
                    return;
                }
                
                lastTimestamp = timestamp;
                setTranslate(currentX, currentY, element);
                animationFrameId = requestAnimationFrame(throttledDrag);
            };
            
            const dragStart = (e) => {
                // æ£€æŸ¥æ˜¯å¦åœ¨å¯æ‹–åŠ¨åŒºåŸŸå†…
                if (!e.target.closest('#draggable-content')) return;
                
                // æ¸…ç†ä¹‹å‰çš„åŠ¨ç”»å¸§
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
                
                if (e.type === "touchstart") {
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }
                
                isDragging = true;
                element.style.cursor = 'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="12" fill="%23ff85a2" opacity="0.95"/><path d="M12 16 L20 16 M16 12 L16 20" stroke="%23fff" stroke-width="2" stroke-linecap="round"/></svg>\') 16 16, grabbing';
                element.style.transition = 'none';
                element.style.willChange = 'transform'; // æ€§èƒ½ä¼˜åŒ–
                
                e.preventDefault();
            };
            
            const dragEnd = (e) => {
                if (!isDragging) return;
                
                // æ¸…ç†åŠ¨ç”»å¸§
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                
                initialX = currentX;
                initialY = currentY;
                
                isDragging = false;
                element.style.cursor = 'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30"><circle cx="15" cy="15" r="11" fill="%23ffb6c1" opacity="0.9"/><path d="M15 8 L15 22 M10 13 L15 8 L20 13 M10 17 L15 22 L20 17" stroke="%23fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>\') 15 15, ns-resize';
                element.style.willChange = 'auto'; // é‡ç½®æ€§èƒ½ä¼˜åŒ–
                
                // ç§»é™¤å›å¼¹æ•ˆæœï¼Œä¿æŒå½“å‰ä½ç½®
                // ä¸å†è‡ªåŠ¨å›åˆ°åŸç‚¹ï¼Œè®©ç”¨æˆ·èƒ½çœ‹åˆ°ä¸‹é¢çš„å†…å®¹
                element.style.transition = 'none';
            };
            
            const drag = (e) => {
                if (!isDragging) return;
                
                e.preventDefault();
                e.stopPropagation();
                
                if (e.type === "touchmove") {
                    currentX = e.touches[0].clientX - initialX;
                    currentY = e.touches[0].clientY - initialY;
                } else {
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                }
                
                // é™åˆ¶æ‹–åŠ¨èŒƒå›´ï¼ˆä½¿ç”¨é…ç½®ï¼‰
                currentX = Math.max(CONFIG.DRAG.LIMITS.X.MIN, Math.min(currentX, CONFIG.DRAG.LIMITS.X.MAX));
                currentY = Math.max(CONFIG.DRAG.LIMITS.Y.MIN, Math.min(currentY, CONFIG.DRAG.LIMITS.Y.MAX));
                
                xOffset = currentX;
                yOffset = currentY;
                
                // ä½¿ç”¨ requestAnimationFrame ä¼˜åŒ–æ€§èƒ½
                if (!animationFrameId) {
                    animationFrameId = requestAnimationFrame(throttledDrag);
                }
            };
            
            const setTranslate = (xPos, yPos, el) => {
                // ä½¿ç”¨ transform3d å¯ç”¨ç¡¬ä»¶åŠ é€Ÿï¼Œåªå…è®¸å‚ç›´ç§»åŠ¨
                el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
            };
            
            // äº‹ä»¶ç›‘å¬å™¨ç®¡ç†
            const addGlobalListeners = () => {
                document.addEventListener('mousemove', drag, { passive: false });
                document.addEventListener('mouseup', dragEnd);
                document.addEventListener('touchmove', drag, { passive: false });
                document.addEventListener('touchend', dragEnd);
            };
            
            const removeGlobalListeners = () => {
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', dragEnd);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('touchend', dragEnd);
            };
            
            // ä¼˜åŒ–çš„æ‹–æ‹½å¼€å§‹å‡½æ•°
            const dragStartWithGlobal = (e) => {
                dragStart(e);
                addGlobalListeners();
            };
            
            const dragEndWithCleanup = (e) => {
                removeGlobalListeners();
                dragEnd(e);
            };
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            element.addEventListener('mousedown', dragStartWithGlobal);
            element.addEventListener('touchstart', dragStartWithGlobal);
            
            // æ¸…ç†å‡½æ•°ï¼Œåœ¨é¡µé¢åˆ‡æ¢æ—¶è°ƒç”¨
            element.cleanup = () => {
                removeGlobalListeners();
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
                element.style.willChange = 'auto';
            };
        }
        
        // åˆ›å»ºåº†ç¥æ•ˆæœï¼ˆå¢å¼ºç‰ˆï¼‰
        function createCelebrationEffect() {
            const container = document.getElementById('animation-container');
            if (!container) return;
            
            // åˆ›å»ºå¤šæ ·åŒ–çš„å½©çº¸æ•ˆæœ
            const createConfetti = () => {
                const colors = CONFIG.COLORS.CELEBRATION;
                const shapes = ['square', 'circle', 'triangle', 'star'];
                const confettiCount = CONFIG.PARTICLES.CONFETTI_COUNT;
                
                for (let i = 0; i < confettiCount; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        const shape = shapes[Math.floor(Math.random() * shapes.length)];
                        const color = colors[Math.floor(Math.random() * colors.length)];
                        const size = 8 + Math.random() * 12;
                        
                        // æ ¹æ®å½¢çŠ¶è®¾ç½®æ ·å¼
                        let shapeStyle = '';
                        switch (shape) {
                            case 'circle':
                                shapeStyle = `border-radius: 50%;`;
                                break;
                            case 'triangle':
                                shapeStyle = `clip-path: polygon(50% 0%, 0% 100%, 100% 100%);`;
                                break;
                            case 'star':
                                shapeStyle = `clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);`;
                                break;
                            default:
                                shapeStyle = `border-radius: 10%;`;
                        }
                        
                        confetti.style.cssText = `
                            position: absolute;
                            width: ${size}px;
                            height: ${size}px;
                            background: ${color};
                            left: ${Math.random() * 100}%;
                            top: -20px;
                            ${shapeStyle}
                            opacity: ${0.7 + Math.random() * 0.3};
                            animation: confettiFall ${2.5 + Math.random() * 1.5}s ease-in forwards;
                            transform: rotate(${Math.random() * 360}deg);
                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        `;
                        container.appendChild(confetti);
                        
                        // è‡ªåŠ¨æ¸…ç†
                        setTimeout(() => {
                            if (confetti.parentElement) {
                                confetti.remove();
                            }
                        }, 4000);
                    }, i * 30);
                }
            };
            
            // åˆ›å»ºé—ªå…‰æ•ˆæœ
            const createSparkles = () => {
                for (let i = 0; i < CONFIG.PARTICLES.SPARKLE_COUNT; i++) {
                    setTimeout(() => {
                        const sparkle = document.createElement('div');
                        sparkle.style.cssText = `
                            position: absolute;
                            width: 4px;
                            height: 4px;
                            background: #fff;
                            border-radius: 50%;
                            left: ${Math.random() * 100}%;
                            top: ${Math.random() * 100}%;
                            opacity: 0;
                            animation: sparkleAnim 1s ease-out forwards;
                            box-shadow: 0 0 10px rgba(255,255,255,0.8);
                        `;
                        container.appendChild(sparkle);
                        
                        setTimeout(() => {
                            if (sparkle.parentElement) {
                                sparkle.remove();
                            }
                        }, 1000);
                    }, i * 100);
                }
            };
            
            // æ·»åŠ æ ·å¼
            const celebrationStyle = document.createElement('style');
            celebrationStyle.textContent = `
                @keyframes confettiFall {
                    0% {
                        transform: translateY(0) rotate(0deg) scale(1);
                        opacity: 1;
                    }
                    25% {
                        transform: translateY(100px) rotate(180deg) scale(1.1);
                        opacity: 0.9;
                    }
                    50% {
                        transform: translateY(200px) rotate(360deg) scale(0.9);
                        opacity: 0.7;
                    }
                    75% {
                        transform: translateY(300px) rotate(540deg) scale(0.8);
                        opacity: 0.5;
                    }
                    100% {
                        transform: translateY(${CONFIG.PARTICLES.FALL_DISTANCE}px) rotate(720deg) scale(0.6);
                        opacity: 0;
                    }
                }
                
                @keyframes sparkleAnim {
                    0% {
                        opacity: 0;
                        transform: scale(0);
                    }
                    50% {
                        opacity: 1;
                        transform: scale(1.5);
                    }
                    100% {
                        opacity: 0;
                        transform: scale(0);
                    }
                }
            `;
            document.head.appendChild(celebrationStyle);
            
            // æ‰§è¡ŒåŠ¨ç”»
            createConfetti();
            setTimeout(createSparkles, 500);
        }
        
        // åˆ›å»ºå³ä¸‹è§’å‘å³ç®­å¤´æç¤º
        function createRightArrow() {
            const container = document.getElementById('animation-container');
            if (!container) return;
            
            // åˆ›å»ºç®­å¤´å®¹å™¨
            const arrowContainer = document.createElement('div');
            arrowContainer.id = 'right-arrow';
            arrowContainer.style.cssText = `
                position: absolute;
                bottom: 100px;
                right: 120px;
                z-index: 1000;
                pointer-events: auto;
                cursor: pointer;
                transform: scale(0) rotate(0deg);
                transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            `;
            
            // åˆ›å»ºç®­å¤´ä¸»ä½“
            const arrow = document.createElement('div');
            arrow.style.cssText = `
                width: 0;
                height: 0;
                border-top: 15px solid transparent;
                border-bottom: 15px solid transparent;
                border-left: 25px solid #ffb6c1;
                border-right: 8px solid transparent;
                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
                position: relative;
                z-index: 2;
            `;
            

            arrowContainer.appendChild(arrow);
            container.appendChild(arrowContainer);
            
            // åŠ¨ç”»æ˜¾ç¤ºç®­å¤´
            setTimeout(() => {
                arrowContainer.style.transform = 'scale(1) rotate(0deg)';
            }, 100);
            
            // ç®­å¤´æ‘‡æ‘†åŠ¨ç”»
            setTimeout(() => {
                arrowContainer.style.animation = 'arrowBounce 2.5s ease-in-out infinite';
            }, 800);
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ - åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªé¡µé¢
            arrowContainer.addEventListener('click', function(e) {
                console.log('ç®­å¤´è¢«ç‚¹å‡»äº†ï¼');
                e.stopPropagation();
                
                // æ·»åŠ ç‚¹å‡»åé¦ˆåŠ¨ç”»
                arrowContainer.style.animation = 'none';
                arrowContainer.style.transform = 'scale(1.3) rotate(0deg)';
                arrowContainer.style.filter = 'brightness(1.5) drop-shadow(0 0 30px rgba(255, 105, 180, 1))';
                
                setTimeout(() => {
                    console.log('ç¬¬ä¸€ä¸ªåŠ¨ç”»å®Œæˆ');
                    arrowContainer.style.transform = 'scale(1.5) rotate(10deg)';
                    setTimeout(() => {
                        console.log('ç¬¬äºŒä¸ªåŠ¨ç”»å®Œæˆ');
                        arrowContainer.style.transform = 'scale(1.8) rotate(-10deg)';
                        setTimeout(() => {
                            console.log('å‡†å¤‡åˆ‡æ¢é¡µé¢');
                            // è§¦å‘é¡µé¢åˆ‡æ¢
                            switchToNextPage();
                        }, 150);
                    }, 150);
                }, 100);
            });
            
            // æ·»åŠ æ‚¬åœæ•ˆæœ
            arrowContainer.addEventListener('mouseenter', function() {
                arrowContainer.style.filter = 'brightness(1.2) drop-shadow(0 0 20px rgba(255, 105, 180, 0.8))';
                arrowContainer.style.transform = 'scale(1.1) rotate(0deg)';
            });
            
            arrowContainer.addEventListener('mouseleave', function() {
                arrowContainer.style.filter = '';
                arrowContainer.style.transform = 'scale(1) rotate(0deg)';
            });
        }
        

        

        
        function startGiftBoxAnimation() {
            if (isAnimating) return;
            isAnimating = true;
            
            console.log('å¼€å§‹ç¤¼ç›’æ‰“å¼€åŠ¨ç”»ï¼');
            
            // åœ¨åŠ¨ç”»å¼€å§‹æ—¶å¼ºåˆ¶ç¡®ä¿ç¤¼ç›’å”¯ä¸€æ€§
            if (window.giftBoxProtection) {
                window.giftBoxProtection.forceCleanup();
            }
            
            try {
                const bowContainer = document.getElementById('bow-container');
                const bowLeft = document.querySelector('.bow-left');
                const bowRight = document.querySelector('.bow-right');
                const boxLid = document.getElementById('box-lid');
                const giftBox = document.getElementById('gift-box');
                
                if (!giftBox || !bowContainer) {
                    console.error('ç¤¼ç›’å…ƒç´ æœªæ‰¾åˆ°ï¼');
                    isAnimating = false;
                    return;
                }
                
                console.log('æ‰€æœ‰å…ƒç´ éƒ½æ‰¾åˆ°äº†ï¼Œå¼€å§‹åŠ¨ç”»');
                
                // ç¦ç”¨ç‚¹å‡»
                giftBox.style.pointerEvents = 'none';
                
                // ç¬¬ä¸€æ­¥ï¼šæ‹‰å¼€è´è¶ç»“
                setTimeout(() => {
                    try {
                        if (bowLeft) bowLeft.style.transform = 'rotate(-45deg) translateX(-10px)';
                        if (bowRight) bowRight.style.transform = 'rotate(45deg) translateX(10px)';
                    } catch (e) {
                        console.error('è´è¶ç»“åŠ¨ç”»é”™è¯¯:', e);
                    }
                }, 100);
                
                // ç¬¬äºŒæ­¥ï¼šè´è¶ç»“é£èµ°
                setTimeout(() => {
                    try {
                        if (bowContainer) {
                            bowContainer.style.transform = 'translateX(-50%) translateY(-50px) scale(0.5) rotate(180deg)';
                            bowContainer.style.opacity = '0';
                        }
                    } catch (e) {
                        console.error('è´è¶ç»“é£èµ°åŠ¨ç”»é”™è¯¯:', e);
                    }
                }, 500);
                
                // ç¬¬ä¸‰æ­¥ï¼šç›’ç›–å¹³ç§»åˆ°ä¸€æ—
                setTimeout(() => {
                    try {
                        if (boxLid) {
                            boxLid.style.transform = 'translateX(-180px) translateY(-20px) scale(0.8) rotate(-15deg)';
                            boxLid.style.opacity = '0.9';
                        }
                    } catch (e) {
                        console.error('ç›’ç›–åŠ¨ç”»é”™è¯¯:', e);
                    }
                }, 800);
                
                // ç¬¬å››æ­¥ï¼šå¼€å§‹è¿ç»­åº†ç¥
                setTimeout(() => {
                    try {
                        startContinuousCelebration();
                    } catch (e) {
                        console.error('åº†ç¥åŠ¨ç”»é”™è¯¯:', e);
                        isAnimating = false;
                    }
                }, 1200);
                
            } catch (error) {
                console.error('ç¤¼ç›’åŠ¨ç”»åˆå§‹åŒ–é”™è¯¯:', error);
                isAnimating = false;
            }
        }
        
        function startContinuousCelebration() {
            const initialScreen = document.getElementById('initial-screen');
            const birthdayText = document.getElementById('birthday-text');
            const giftBox = document.getElementById('gift-box');
            const boxMain = document.getElementById('box-main');
            
            // å…ˆæ˜¾ç¤ºæ–‡å­—å¹¶æ”¾å¤§ç¤¼ç›’ï¼Œéšåä»æ”¾å¤§çš„ç¤¼ç›’å†…éƒ¨å‘å°„æ°”çƒå’Œçº¸å¸¦
            
            // ç”Ÿæ—¥æ–‡å­—æ˜¾ç¤ºæ—¶æœºå·²è°ƒæ•´ï¼Œä¸çº¸å¸¦/æ°”çƒåŒæ—¶è§¦å‘

            // å°†ç¤¼ç›’å¤§å¹…æ”¾å¤§å¹¶ä¿æŒå¯è§ï¼Œæ–‡å­—ç½®äºç¤¼ç›’å†…éƒ¨
            setTimeout(() => {
                giftBox.style.transition = 'all 2.2s cubic-bezier(0.4, 0, 0.2, 1)';
                // æ›´å¤§æ¯”ä¾‹ä»¥ä¾¿â€œåœ¨ç¤¼ç›’é‡Œâ€å¯ä»¥çœ‹åˆ°æ–‡å­—å’Œä»å†…éƒ¨å‘å‡ºçš„æ°”çƒ/çº¸å¸¦
                giftBox.style.transform = 'scale(14) translateZ(400px)';
                giftBox.style.opacity = '1';
                giftBox.style.zIndex = '9999';
                boxMain.style.background = 'radial-gradient(circle, rgba(255,255,255,0.95) 0%, rgba(255,192,203,0.05) 100%)';
            }, 1000);

            // åœ¨æ”¾å¤§åŠ¨ç”»ç¨ååŒæ—¶è§¦å‘çº¸å¸¦ã€æ°”çƒå’Œç”Ÿæ—¥æ–‡å­—
            setTimeout(() => {
                createConfetti();
                createBalloons();
                if (birthdayText) {
                    // ç¡®ä¿ç”Ÿæ—¥æ–‡å­—åŠ¨ç”»åªè§¦å‘ä¸€æ¬¡
                    if (!birthdayText.classList.contains('birthday-entrance')) {
                        birthdayText.classList.add('birthday-entrance');
                        birthdayText.style.opacity = '1';
                    }
                }
                
                // æ˜¾ç¤ºçˆ±å¿ƒæŒ‰é’®
                const heartButton = document.getElementById('heart-button');
                if (heartButton) {
                    heartButton.classList.add('show');
                }
            }, 1250);
            
            setTimeout(() => {
                initialScreen.style.transition = 'all 0.6s ease-out';
                initialScreen.style.opacity = '0';
                setTimeout(() => {
                    initialScreen.style.display = 'none';
                    showFireworks();
                }, 600);
            }, 1600);
            
            // é‡ç½®åŠ¨ç”»çŠ¶æ€
            setTimeout(() => {
                isAnimating = false;
            }, 2500);
        }
        

        
        function createConfetti() {
            console.log('åˆ›å»ºäº”å½©çº¸å¸¦...');
            
            const container = document.getElementById('animation-container');
            if (!container) {
                return;
            }
            
            const colors = [
                'radial-gradient(circle, #fff 30%, #ffc0cb 70%, #ffb6c1 100%)',
                'radial-gradient(circle, #fff 40%, #ffe4e1 80%, #ffc0cb 100%)',
                'radial-gradient(circle, #fff 25%, #ffb6c1 60%, #ffc0cb 100%)',
                'radial-gradient(circle, #fff 50%, #fff0f5 90%, #ffc0cb 100%)',
                'radial-gradient(circle, #fff 35%, #ffe4e6 75%, #ffb6c1 100%)',
                'radial-gradient(circle, #fff 45%, #ffc0cb 85%, #ffb6c1 100%)'
            ];
            
            console.log('å¼€å§‹åˆ›å»ºçº¸ç‰‡...');
            
            // åˆ›å»ºä»ä¸Šæ–¹è½ä¸‹çš„äº”å½©çº¸å¸¦
            for (let i = 0; i < 120; i++) {
                const confetti = document.createElement('div');
                
                // éšæœºå¤§å°å’Œé¢œè‰²
                const size = 10 + Math.random() * 10;
                const gradient = colors[Math.floor(Math.random() * colors.length)];
                const shapeType = Math.random();
                
                // è®¡ç®—ç¤¼ç›’åœ¨å®¹å™¨å†…çš„ä¸­å¿ƒä½ç½®ï¼ˆåƒç´ ï¼‰ï¼Œä»ç¤¼ç›’å†…éƒ¨å‘å°„çº¸å¸¦
                const containerRect = container.getBoundingClientRect();
                const gift = document.getElementById('gift-box');
                let centerXpx = containerRect.width / 2;
                let centerYpx = containerRect.height / 2;
                let giftW = 80, giftH = 80;
                if (gift) {
                    const giftRect = gift.getBoundingClientRect();
                    centerXpx = giftRect.left - containerRect.left + giftRect.width / 2;
                    centerYpx = giftRect.top - containerRect.top + giftRect.height / 2;
                    giftW = giftRect.width;
                    giftH = giftRect.height;
                }

                const randomXpx = centerXpx + (Math.random() - 0.5) * (giftW * 0.5);
                const randomYpx = centerYpx + (Math.random() - 0.5) * (giftH * 0.5);

                // ä»ç¤¼ç›’å†…éƒ¨å¼€å§‹ï¼ˆåƒç´ å®šä½ï¼‰
                confetti.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    background: ${gradient};
                    left: ${randomXpx}px;
                    top: ${randomYpx}px;
                    z-index: 1000;
                    opacity: 0;
                    border-radius: ${shapeType > 0.6 ? '50%' : shapeType > 0.3 ? '45%' : '30%'};
                    pointer-events: none;
                    box-shadow: 
                        0 8px 16px rgba(255, 182, 193, 0.3),
                        0 4px 8px rgba(255, 192, 203, 0.2),
                        inset 0 2px 4px rgba(255, 255, 255, 0.6);
                    border: 2px solid rgba(255, 255, 255, 0.5);
                    transform: rotate(${Math.random() * 360}deg);
                `;
                
                container.appendChild(confetti);
                
                // éšæœºå»¶è¿Ÿåˆ›å»ºä»ä¸­å¿ƒæ‰©æ•£æ•ˆæœ
                const delay = Math.random() * 400;
                setTimeout(() => {
                    confetti.style.transition = 'all 2.5s ease-out';
                    confetti.style.opacity = '1';
                    
                    // ä»ä¸­å¿ƒå‘å¤–æ‰©æ•£ï¼Œä¸è¦å‡é€Ÿ
                    const angle = Math.random() * Math.PI * 2; // éšæœºè§’åº¦
                    // æ ¹æ®å®¹å™¨å°ºå¯¸è®¡ç®—æ‰©æ•£è·ç¦»å¹¶åå‘å‘ä¸Šæ‰©æ•£ï¼Œè§†è§‰ä¸Šæ›´åƒä»ç¤¼ç›’é‡Œå†²å‡º
                    const maxDim = Math.max(containerRect.width, containerRect.height);
                    const distance = Math.max(160, Math.min(600, Math.floor(maxDim * (0.25 + Math.random() * 0.6))));
                    const xDrift = Math.cos(angle) * distance * (0.6 + Math.random() * 0.9);
                    // yDrift åå‘è´Ÿå€¼ï¼ˆå‘ä¸Šï¼‰ï¼Œå‡å°‘å‘ä¸‹çš„åˆ†é‡
                    const yDrift = -Math.abs(Math.sin(angle)) * distance * (0.4 + Math.random() * 1.1);
                    const rotation = Math.random() * 720; // æ—‹è½¬
                    const finalScale = 0.8 + Math.random() * 0.4; // æœ€ç»ˆå¤§å°
                    
                    confetti.style.transform = `translate(${xDrift}px, ${yDrift}px) rotate(${rotation}deg) scale(${finalScale})`;
                    
                    // é•¿æ—¶é—´åœç•™åœ¨å±å¹•ä¸Š
                    setTimeout(() => {
                        confetti.style.transition = 'all 1.8s ease-in';
                        confetti.style.opacity = '0';
                        confetti.style.transform = `translate(${xDrift}px, ${yDrift + 30}px) rotate(${rotation}deg) scale(${finalScale * 0.8})`;
                    }, 2500); // 2.5ç§’åå¼€å§‹æ¶ˆå¤±
                }, delay);
                
                // æ›´é•¿ç”Ÿå‘½å‘¨æœŸ
                setTimeout(() => {
                    confetti.remove();
                }, 6000); // 6ç§’åæ¸…ç†
            }
            
            console.log('çº¸å¸¦åˆ›å»ºå®Œæˆï¼æ€»å…±' + 120 + 'ä¸ªçº¸ç‰‡');
        }

        // ç®€å•çš„ç„°ç«æ•ˆæœï¼šä»å®¹å™¨ä¸­å¤®å‘å°„è‹¥å¹²å½©è‰²åœ†ç‚¹å¹¶æ‰©æ•£
        function showFireworks() {
            const container = document.getElementById('animation-container');
            if (!container) return;

            const centerX = container.clientWidth / 2;
            const centerY = container.clientHeight / 2 - 40;

            for (let i = 0; i < 18; i++) {
                const p = document.createElement('div');
                const size = 6 + Math.random() * 8;
                p.style.cssText = `position:absolute; left:${centerX}px; top:${centerY}px; width:${size}px; height:${size}px; border-radius:50%; background:${['#ff6b6b','#ffd166','#6bcB77','#6b8cff','#ff9ad1'][Math.floor(Math.random()*5)]}; box-shadow:0 6px 18px rgba(0,0,0,0.12); z-index:1200; opacity:1; transform:translate(-50%,-50%) scale(1)`;
                container.appendChild(p);

                const angle = Math.random() * Math.PI * 2;
                const dist = 80 + Math.random() * 160;
                const dx = Math.cos(angle) * dist;
                const dy = Math.sin(angle) * dist;

                // æ‰©æ•£å¹¶æ·¡å‡º
                setTimeout(() => {
                    p.style.transition = 'transform 900ms cubic-bezier(.2,.8,.2,1), opacity 900ms ease-out';
                    p.style.transform = `translate(${dx}px, ${dy}px) scale(1.2)`;
                    p.style.opacity = '0';
                }, 50 + Math.random() * 200);

                setTimeout(() => p.remove(), 1200);
            }
        }
        
        function createBalloons() {
            const container = document.getElementById('animation-container');
            
            // æ¸…ç©ºç°æœ‰æ°”çƒæ•°ç»„
            balloons = [];
            
            // ç¥ç¦è¯­åˆ—è¡¨
            const blessings = [
                'å‰ç¨‹ä¼¼é”¦ğŸŒˆ',
                'å¿ƒæƒ³äº‹æˆâ­',
                'å²æœˆæ¸©æŸ”ğŸŒ¸',
                'å¥½è¿çˆ†æ£šğŸ€',
                'å¿«ä¹ä¸æ­¢ğŸ‰',
                'å‰ç¨‹ä¼¼é”¦ğŸŒˆ',
                'å¿ƒæƒ³äº‹æˆâ­',
                'å²æœˆæ¸©æŸ”ğŸŒ¸',
                'å¥½è¿çˆ†æ£šğŸ€',
                'å¿«ä¹ä¸æ­¢ğŸ‰'
            ];
            
            // åˆ›å»º10ä¸ªæ°”çƒ
            for (let i = 0; i < 10; i++) {
                const balloon = document.createElement('div');
                const balloonType = i % 3 === 0 ? 'star' : i % 3 === 1 ? 'heart' : 'ellipse';
                balloon.className = `balloon ${balloonType}`;
                
                // è®¾ç½®æ°”çƒæ•°æ®
                const isBlessing = i % 2 === 1;
                balloon.dataset.balloonType = isBlessing ? 'blessing' : 'confetti';
                balloon.dataset.blessing = blessings[i];
                balloon.dataset.index = i;
                
                // è®¾ç½®æ°”çƒå¤§å°
                const size = 60 + Math.random() * 20;
                balloon.style.width = size + 'px';
                balloon.style.height = size + 'px';
                balloon.style.position = 'absolute';
                balloon.style.cursor = 'pointer';
                balloon.style.opacity = '0';
                balloon.style.transition = 'all 0.3s ease';
                
                // å°†æ°”çƒåˆ†æ•£åˆ°ç”Ÿæ—¥å¿«ä¹æ–‡å­—ä¸Šæ–¹çš„åŒºåŸŸ
                const containerRect = container.getBoundingClientRect();
                
                // è®¡ç®—ç”Ÿæ—¥å¿«ä¹æ–‡å­—ä¸Šæ–¹çš„å¯ç”¨åŒºåŸŸï¼ˆ0-60%çš„å±å¹•ç©ºé—´ï¼‰
                const availableHeight = containerRect.height * 0.6; // ä½¿ç”¨å±å¹•ä¸Š60%çš„åŒºåŸŸ
                const startY = 0; // ä»é¡¶éƒ¨å¼€å§‹
                
                // å°†åŒºåŸŸåˆ†ä¸ºç½‘æ ¼ï¼Œç¡®ä¿æ°”çƒåœ¨å¯è§èŒƒå›´å†…
                const gridCols = 4;
                const gridRows = 3;
                const cellWidth = containerRect.width / gridCols;
                const cellHeight = availableHeight / gridRows;
                
                const col = i % gridCols;
                const row = Math.floor(i / gridCols) % gridRows;
                
                const zoneX = col * cellWidth;
                const zoneY = startY + row * cellHeight;
                
                // åœ¨æ¯ä¸ªç½‘æ ¼å•å…ƒå†…éšæœºåˆ†å¸ƒï¼Œä½†ç¡®ä¿åœ¨å¯è§èŒƒå›´å†…
                const padding = 10;
                const startLeft = zoneX + padding + Math.random() * (cellWidth - padding * 2);
                const startTop = zoneY + padding + Math.random() * (cellHeight - padding * 2);
                
                balloon.style.left = startLeft + 'px';
                balloon.style.top = startTop + 'px';
                
                container.appendChild(balloon);
                balloons.push(balloon);
                
                // å»¶è¿Ÿæ˜¾ç¤ºæ°”çƒ
                const delay = i * 300;
                setTimeout(() => {
                    balloon.style.opacity = '1';
                    balloon.style.transform = 'translateY(-50px) scale(1)';
                    
                    // æ·»åŠ ç®€å•çš„ä¸Šä¸‹æµ®åŠ¨åŠ¨ç”»
                    setTimeout(() => {
                        balloon.style.animation = `float ${3 + Math.random() * 2}s ease-in-out infinite`;
                    }, 1000);
                }, delay);
                
                // ç»‘å®šç‚¹å‡»äº‹ä»¶
                balloon.onclick = function(e) {
                    e.stopPropagation();
                    console.log('æ°”çƒè¢«ç‚¹å‡»äº†ï¼', i, balloon.dataset.balloonType);
                    handleBalloonClick(balloon, i);
                };
                
                // ç»‘å®šæ‹–æ‹½äº‹ä»¶
                balloon.onmousedown = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const containerRect = container.getBoundingClientRect();
                    const balloonRect = balloon.getBoundingClientRect();
                    
                    dragOffsetX = e.clientX - balloonRect.left;
                    dragOffsetY = e.clientY - balloonRect.top;
                    isDragging = true;
                    draggedBalloon = balloon;
                    
                    balloon.style.zIndex = '1000';
                    balloon.style.transition = 'none';
                };
                
                // æ·»åŠ è§¦æ‘¸ç§»åŠ¨äº‹ä»¶
                balloon.addEventListener('touchmove', function(e) {
                    e.preventDefault();
                    if (!isDragging || !draggedBalloon) return;
                    
                    const touch = e.touches[0];
                    const container = document.getElementById('animation-container');
                    const containerRect = container.getBoundingClientRect();
                    const balloonRect = draggedBalloon.getBoundingClientRect();
                    
                    // è®¡ç®—æ–°ä½ç½®ï¼Œç¡®ä¿æ°”çƒåœ¨å®¹å™¨å†…
                    let newX = touch.clientX - containerRect.left - dragOffsetX;
                    let newY = touch.clientY - containerRect.top - dragOffsetY;
                    
                    // è¾¹ç•Œæ£€æŸ¥
                    const maxX = containerRect.width - balloonRect.width;
                    const maxY = containerRect.height - balloonRect.height;
                    newX = Math.max(0, Math.min(newX, maxX));
                    newY = Math.max(0, Math.min(newY, maxY));
                    
                    // æ›´æ–°æ°”çƒä½ç½®
                    draggedBalloon.style.left = newX + 'px';
                    draggedBalloon.style.top = newY + 'px';
                    draggedBalloon.style.transition = 'none';
                    draggedBalloon.style.animationPlayState = 'paused';
                });
                
                // æ·»åŠ è§¦æ‘¸ç»“æŸäº‹ä»¶
                balloon.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    if (isDragging && draggedBalloon) {
                        // æ¢å¤è¿‡æ¸¡åŠ¨ç”»
                        draggedBalloon.style.transition = 'all 0.3s ease';
                        
                        // æ¢å¤æ‘†åŠ¨åŠ¨ç”»
                        draggedBalloon.style.animationPlayState = 'running';
                        
                        // æ¢å¤z-index
                        draggedBalloon.style.zIndex = '600';
                        
                        // å¦‚æœæ²¡æœ‰æ‹–æ‹½è·ç¦»ï¼Œè§¦å‘ç‚¹å‡»äº‹ä»¶
                        const touch = e.changedTouches[0];
                        const balloonRect = balloon.getBoundingClientRect();
                        const wasDragged = Math.abs(touch.clientX - (balloonRect.left + balloonRect.width/2)) > 5 ||
                                        Math.abs(touch.clientY - (balloonRect.top + balloonRect.height/2)) > 5;
                        
                        if (!wasDragged) {
                            handleBalloonClick(balloon, i);
                        }
                        
                        // é‡ç½®æ‹–æ‹½çŠ¶æ€
                        isDragging = false;
                        draggedBalloon = null;
                        dragOffsetX = 0;
                        dragOffsetY = 0;
                    }
                });
            }
        }
        
        function startBalloonSwing(balloon, index) {
            const swingInterval = setInterval(() => {
                if (!balloon.isPopped && !document.hidden && !balloon.classList.contains('pushed')) {
                    const time = Date.now() / 1000;
                    const swing = Math.sin(time + index) * 15;
                    const rotation = Math.sin(time + index) * 5;
                    
                    // ä¿å­˜åŸå§‹ä½ç½®
                    const originalLeft = parseFloat(balloon.style.left) || 0;
                    const originalTop = parseFloat(balloon.style.top) || 0;
                    
                    balloon.style.transform = `translateX(${swing}px) rotate(${rotation}deg)`;
                }
            }, 50);
        }
        
        function balloonBounce(balloon) {
            if (balloon.isBouncing) return;
            balloon.isBouncing = true;
            
            // å¼¹è·³åŠ¨ç”»
            balloon.style.transition = 'transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
            balloon.style.transform = 'scale(1.3) translateY(-20px) rotate(10deg)';
            
            setTimeout(() => {
                balloon.style.transition = 'transform 0.3s ease';
                balloon.style.transform = 'scale(1) translateY(0px) rotate(0deg)';
                balloon.isBouncing = false;
            }, 400);
        }

        function handleBalloonClick(balloon, index) {
            console.log('å¤„ç†æ°”çƒç‚¹å‡»', balloon.dataset.balloonType);
            
            if (balloon.isPopped) return;
            balloon.isPopped = true;
            
            const balloonType = balloon.dataset.balloonType;
            const container = document.getElementById('animation-container');
            
            // çˆ†ç‚¸åŠ¨ç”»
            balloon.style.transition = 'all 0.3s ease-out';
            balloon.style.transform = 'scale(1.5)';
            balloon.style.opacity = '0';
            
            // åˆ›å»ºçˆ†ç‚¸ç²’å­
            const colors = ['#ff69b4', '#ffb6c1', '#ffc0cb', '#ff85a2', '#ffd700'];
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                const color = colors[Math.floor(Math.random() * colors.length)];
                const size = 6 + Math.random() * 8;
                
                particle.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    background: ${color};
                    border-radius: 50%;
                    left: ${balloon.offsetLeft + balloon.offsetWidth/2}px;
                    top: ${balloon.offsetTop + balloon.offsetHeight/2}px;
                    z-index: 1000;
                    pointer-events: none;
                `;
                
                container.appendChild(particle);
                
                // ç²’å­æ‰©æ•£åŠ¨ç”»
                setTimeout(() => {
                    const angle = (Math.PI * 2 * i) / 15;
                    const distance = 50 + Math.random() * 100;
                    const x = Math.cos(angle) * distance;
                    const y = Math.sin(angle) * distance;
                    
                    particle.style.transition = 'all 1s ease-out';
                    particle.style.transform = `translate(${x}px, ${y}px) scale(0)`;
                    particle.style.opacity = '0';
                }, 10);
                
                setTimeout(() => particle.remove(), 1000);
            }
            
            // æ˜¾ç¤ºç¥ç¦è¯­ï¼ˆå¦‚æœæ˜¯ç¥ç¦æ°”çƒï¼‰
            if (balloonType === 'blessing' && balloon.dataset.blessing) {
                const blessing = document.createElement('div');
                blessing.style.cssText = `
                    position: absolute;
                    left: ${balloon.offsetLeft}px;
                    top: ${balloon.offsetTop - 50}px;
                    background: #ffe4e1; /* æ”¹ä¸ºç»Ÿä¸€çš„èƒŒæ™¯é¢œè‰² */
                    color: #ff1493;
                    padding: 10px 20px;
                    border-radius: 20px;
                    font-size: 16px;
                    font-weight: bold;
                    z-index: 1001;
                    transform: scale(0) rotate(-10deg);
                    transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                    box-shadow: 0 8px 25px rgba(255, 105, 180, 0.3);
                    white-space: nowrap;
                `;
                blessing.textContent = balloon.dataset.blessing;
                container.appendChild(blessing);
                
                setTimeout(() => {
                    blessing.style.transform = 'scale(1) rotate(0deg)';
                }, 10);
                
                setTimeout(() => {
                    blessing.style.opacity = '0';
                    blessing.style.transform = 'scale(0.8) translateY(-20px)';
                }, 2000);
                
                setTimeout(() => blessing.remove(), 2500);
            }
            
            // ç§»é™¤æ°”çƒ
            setTimeout(() => {
                balloon.remove();
                const balloonIndex = balloons.indexOf(balloon);
                if (balloonIndex > -1) {
                    balloons.splice(balloonIndex, 1);
                }
            }, 300);
        }

        function createBalloonExplosion(balloon) {
            if (balloon.isPopped) return;
            balloon.isPopped = true;

            const container = document.getElementById('animation-container');
            const balloonRect = balloon.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            // è®¡ç®—æ°”çƒä¸­å¿ƒä½ç½®
            const centerX = balloonRect.left - containerRect.left + balloonRect.width / 2;
            const centerY = balloonRect.top - containerRect.top + balloonRect.height / 2;

            // çˆ†ç‚¸éŸ³æ•ˆï¼ˆè§†è§‰åé¦ˆï¼‰
            balloon.style.transition = 'all 0.2s ease-out';
            balloon.style.transform = 'scale(1.5)';
            balloon.style.opacity = '0.8';

            setTimeout(() => {
                balloon.style.opacity = '0';
                balloon.style.transform = 'scale(0)';
            }, 150);

            // åˆ›å»ºçˆ†ç‚¸å½©å¸¦
            const colors = [
                '#ff69b4', '#ff1493', '#ffc0cb', '#ff85a2', 
                '#ffd700', '#ff6347', '#87ceeb', '#98fb98',
                '#dda0dd', '#f0e68c', '#ffa500', '#ff4500'
            ];

            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                const size = 8 + Math.random() * 8;
                const color = colors[Math.floor(Math.random() * colors.length)];
                const shapeType = Math.random();

                confetti.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    background: ${color};
                    left: ${centerX}px;
                    top: ${centerY}px;
                    z-index: 1000;
                    opacity: 1;
                    border-radius: ${shapeType > 0.5 ? '50%' : shapeType > 0.25 ? '45%' : '20%'};
                    pointer-events: none;
                    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.6);
                    transform: translate(-50%, -50%) rotate(${Math.random() * 360}deg);
                `;

                container.appendChild(confetti);

                const delay = Math.random() * 50;
                setTimeout(() => {
                    confetti.style.transition = 'all 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                    
                    // å‘å››å‘¨çˆ†ç‚¸æ‰©æ•£
                    const angle = (Math.PI * 2 / 30) * i + Math.random() * 0.5;
                    const distance = 100 + Math.random() * 150;
                    const xDrift = Math.cos(angle) * distance;
                    const yDrift = Math.sin(angle) * distance;
                    const rotation = Math.random() * 720;
                    const finalScale = 0.6 + Math.random() * 0.4;

                    confetti.style.transform = `translate(calc(-50% + ${xDrift}px), calc(-50% + ${yDrift}px)) rotate(${rotation}deg) scale(${finalScale})`;
                }, delay);

                setTimeout(() => {
                    confetti.style.transition = 'all 0.8s ease-in';
                    confetti.style.opacity = '0';
                    confetti.style.transform += ' translateY(50px)';
                }, 1500 + delay);

                setTimeout(() => {
                    confetti.remove();
                }, 2500 + delay);
            }

            // ç§»é™¤æ°”çƒ
            setTimeout(() => {
                balloon.remove();
                // ä»æ°”çƒæ•°ç»„ä¸­ç§»é™¤
                const balloonIndex = balloons.indexOf(balloon);
                if (balloonIndex > -1) {
                    balloons.splice(balloonIndex, 1);
                }
            }, 300);
        }

        function showBalloonBlessing(balloon) {
            if (balloon.isShowingBlessing) return;
            balloon.isShowingBlessing = true;

            const blessing = balloon.dataset.blessing || 'ç¥ä½ å¤©å¤©å¼€å¿ƒï¼ğŸ‰';
            const container = document.getElementById('animation-container');
            const balloonRect = balloon.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            // è®¡ç®—æ°”çƒçš„ä¸­å¿ƒç‚¹
            const balloonCenterX = balloonRect.left - containerRect.left + balloonRect.width / 2;
            const balloonCenterY = balloonRect.top - containerRect.top + balloonRect.height / 2;
            
            // è®¡ç®—å®¹å™¨è¾¹ç•Œ
            const containerWidth = containerRect.width;
            const containerHeight = containerRect.height;
            const buffer = 20; // è¾¹ç•Œç¼“å†²
            
            // é¢„è®¾ç¥ç¦è¯­å°ºå¯¸
            const estimatedBlessingWidth = 200; // ä¼°ç®—ç¥ç¦è¯­å®½åº¦
            const estimatedBlessingHeight = 50; // ä¼°ç®—ç¥ç¦è¯­é«˜åº¦
            
            // è®¡ç®—æœ€ä½³æ˜¾ç¤ºä½ç½®
            let offsetX = 0;
            let offsetY = -balloonRect.height / 2 - 30; // é»˜è®¤åœ¨æ°”çƒä¸Šæ–¹
            
            // æ£€æŸ¥ä¸Šæ–¹ç©ºé—´
            if (balloonCenterY + offsetY - estimatedBlessingHeight < buffer) {
                // ä¸Šæ–¹ç©ºé—´ä¸è¶³ï¼Œå°è¯•æ˜¾ç¤ºåœ¨å³ä¸‹è§’
                offsetY = balloonRect.height / 2 + 20;
                offsetX = balloonRect.width / 2 + 20;
                
                // æ£€æŸ¥å³ä¾§ç©ºé—´
                if (balloonCenterX + offsetX + estimatedBlessingWidth > containerWidth - buffer) {
                    // å³ä¾§ç©ºé—´ä¸è¶³ï¼Œæ˜¾ç¤ºåœ¨å·¦ä¸‹è§’
                    offsetX = -balloonRect.width / 2 - 20;
                    
                    // æ£€æŸ¥å·¦ä¾§ç©ºé—´
                    if (balloonCenterX + offsetX - estimatedBlessingWidth < buffer) {
                        // å·¦ä¾§ä¹Ÿä¸è¶³ï¼Œæ˜¾ç¤ºåœ¨ä¸‹æ–¹ä¸­é—´
                        offsetX = 0;
                        offsetY = balloonRect.height / 2 + 20;
                    }
                }
            }
            
            // è®¡ç®—æœ€ç»ˆä½ç½®
            const finalX = balloonCenterX + offsetX;
            const finalY = balloonCenterY + offsetY;

            // åˆ›å»ºç¥ç¦è¯­å…ƒç´ 
            const blessingElement = document.createElement('div');
            blessingElement.style.cssText = `
                position: absolute;
                left: ${finalX}px;
                top: ${finalY}px;
                transform: translate(-50%, -50%) scale(0);
                background: #ffe4e1; /* æ”¹ä¸ºç»Ÿä¸€çš„èƒŒæ™¯é¢œè‰² */
                color: #ff1493;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 18px;
                font-weight: 700;
                font-family: 'Comic Neue', 'Kalam', cursive;
                box-shadow: 
                    0 8px 25px rgba(255, 182, 193, 0.4),
                    0 4px 12px rgba(255, 192, 203, 0.3),
                    inset 0 2px 4px rgba(255, 255, 255, 0.8);
                border: 3px solid #fff;
                z-index: 2000;
                opacity: 0;
                transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                white-space: nowrap;
                max-width: 300px;
                text-align: center;
                line-height: 1.4;
            `;

            blessingElement.textContent = blessing;
            container.appendChild(blessingElement);

            // æ°”çƒç¼©æ”¾åŠ¨ç”»
            balloon.style.transition = 'transform 0.3s ease';
            balloon.style.transform = 'scale(1.2)';

            // ç¥ç¦è¯­å¼¹å‡ºåŠ¨ç”»
            setTimeout(() => {
                blessingElement.style.opacity = '1';
                blessingElement.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 100);

            // æ·»åŠ å…³é—­æ•ˆæœ
            setTimeout(() => {
                blessingElement.style.transition = 'all 0.3s ease';
                blessingElement.style.opacity = '0';
                blessingElement.style.transform = 'translate(-50%, -80%) scale(0.8)';
                
                balloon.style.transform = 'scale(1)';
            }, 3000);

            setTimeout(() => {
                blessingElement.remove();
                balloon.isShowingBlessing = false;
            }, 3500);
        }
        
        function showFinalBlessing() {
            const birthdayText = document.getElementById('birthday-text');
            const container = document.getElementById('animation-container');
            
            // éšè—æ‰€æœ‰æ°”çƒ
            const balloons = container.querySelectorAll('.balloon');
            balloons.forEach(balloon => {
                balloon.style.transition = 'all 0.5s ease';
                balloon.style.opacity = '0';
                balloon.style.transform = 'translateY(100px) scale(0.5)';
            });
            
            // åˆ›å»ºèƒŒæ™¯é®ç½©
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: absolute;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.3);
                top: 0;
                left: 0;
                z-index: 50;
                opacity: 0;
                transition: opacity 0.5s ease;
                backdrop-filter: blur(5px);
            `;
            
            container.appendChild(overlay);
            
            // æ˜¾ç¤ºæœ€ç»ˆç¥ç¦
            setTimeout(() => {
                overlay.style.opacity = '1';
                
                // åˆ›å»ºç¥ç¦æ¡†
                const blessingBox = document.createElement('div');
                blessingBox.style.cssText = `
                    position: absolute;
                    width: 85%;
                    height: auto;
                    background: 
                        radial-gradient(circle at 30% 30%, #fff 40%, #ffe4e1 80%, #ffc0cb 100%);
                    border-radius: 35px;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%) scale(0) rotate(-5deg);
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    padding: 40px;
                    box-shadow: 
                        0 25px 50px rgba(255, 182, 193, 0.4),
                        0 15px 30px rgba(255, 192, 203, 0.3),
                        inset 0 4px 8px rgba(255, 255, 255, 0.8);
                    z-index: 100;
                    transition: transform 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                    border: 4px solid #fff;
                `;
                
                blessingBox.innerHTML = `
                    <div style="font-size: 22px; color: #d87093; text-align: center; margin-bottom: 25px; line-height: 1.8; font-weight: 700; text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8); font-family: 'Comic Neue', cursive;">
                        æ„¿ä½ æ¯ä¸€å¤©éƒ½å……æ»¡é˜³å…‰å’Œæ¬¢ç¬‘ ğŸŒ¸<br>
                        æ„¿ä½ çš„æ‰€æœ‰æ¢¦æƒ³éƒ½èƒ½å®ç° ğŸ¯<br>
                        æ„¿å¹¸ç¦æ°¸è¿œä¼´éšç€ä½ ï¼ ğŸ’•
                    </div>
                    <div style="font-size: 18px; color: #ff69b4; align-self: flex-end; font-weight: 700; font-style: italic; margin-top: 15px; text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);">
                        With ğŸ’– From Your Friend
                    </div>
                    <div style="margin-top: 25px; font-size: 35px; animation: bounce 2s infinite;">
                        ğŸŒ¸âœ¨ğŸ’•ğŸ‰ğŸŒˆ
                    </div>
                `;
                
                // æ·»åŠ å¼¹è·³åŠ¨ç”»
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes bounce {
                        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                        40% { transform: translateY(-10px); }
                        60% { transform: translateY(-5px); }
                    }
                `;
                document.head.appendChild(style);
                
                container.appendChild(blessingBox);
                
                // æ˜¾ç¤ºç¥ç¦æ¡†
                setTimeout(() => {
                    blessingBox.style.transform = 'translate(-50%, -50%) scale(1) rotate(0deg)';
                }, 200);
                
                // æ·»åŠ ç‚¹å‡»é®ç½©å…³é—­åŠŸèƒ½
                overlay.addEventListener('click', function() {
                    overlay.style.opacity = '0';
                    blessingBox.style.transform = 'translate(-50%, -50%) scale(0) rotate(-5deg)';
                    setTimeout(() => {
                        overlay.remove();
                        blessingBox.remove();
                    }, 500);
                });
                
            }, 600);
        }
        
        // ç¤¼ç›’ç‚¹å‡»äº‹ä»¶ç»‘å®š - ç§»è‡³DOMContentLoadedä¸­ç¡®ä¿åªç»‘å®šä¸€æ¬¡
        function setupGiftBoxClick() {
            const giftBox = document.getElementById('gift-box');
            if (giftBox && !giftBox.hasAttribute('data-click-setup')) {
                console.log('è®¾ç½®ç¤¼ç›’ç‚¹å‡»äº‹ä»¶');
                giftBox.setAttribute('data-click-setup', 'true');
                
                // ç§»é™¤ä»»ä½•ç°æœ‰çš„ç‚¹å‡»ç›‘å¬å™¨
                giftBox.removeEventListener('click', startGiftBoxAnimation);
                // æ·»åŠ æ–°çš„ç‚¹å‡»ç›‘å¬å™¨
                giftBox.addEventListener('click', function(e) {
                    console.log('ç¤¼ç›’ç‚¹å‡»äº‹ä»¶è§¦å‘ï¼');
                    
                    // åœ¨åŠ¨ç”»å¼€å§‹å‰å†æ¬¡ç¡®ä¿ç¤¼ç›’å”¯ä¸€æ€§
                    if (window.giftBoxProtection) {
                        window.giftBoxProtection.forceCleanup();
                    }
                    
                    e.preventDefault();
                    e.stopPropagation();
                    startGiftBoxAnimation();
                }, { once: false });
                
                console.log('ç¤¼ç›’äº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®');
            } else {
                console.log('ç¤¼ç›’å…ƒç´ æœªæ‰¾åˆ°æˆ–å·²è®¾ç½®è¿‡äº‹ä»¶');
            }
        }
        
        // ===== å¯¼å…¥ç…§ç‰‡æŒ‰é’®ç‚¹å‡»äº‹ä»¶å¤„ç† =====
        function setupImportPhotosButton() {
            const importBtn = document.getElementById('import-photos-btn');
            if (importBtn) {
                importBtn.addEventListener('click', () => {
                    console.log('ğŸ“¸ å¯¼å…¥ç…§ç‰‡æŒ‰é’®è¢«ç‚¹å‡»');
                    
                    // å°è¯•å¯¼å…¥ç…§ç‰‡
                    const uploadedPhotos = localStorage.getItem('birthdayPersonPhotos');
                    if (!uploadedPhotos) {
                        alert('âŒ æ²¡æœ‰æ‰¾åˆ°ä¸Šä¼ çš„ç…§ç‰‡ï¼\n\nè¯·å…ˆåœ¨"ç”Ÿæ—¥ä¿¡æ¯ç®¡ç†"é¡µé¢ä¸Šä¼ ç…§ç‰‡ï¼Œç„¶åç‚¹å‡»"ä¿å­˜ä¿¡æ¯"ã€‚');
                        return;
                    }
                    
                    try {
                        const photos = JSON.parse(uploadedPhotos);
                        if (!photos || photos.length === 0) {
                            alert('âŒ ç…§ç‰‡æ•°æ®ä¸ºç©ºï¼\n\nè¯·é‡æ–°ä¸Šä¼ ç…§ç‰‡ã€‚');
                            return;
                        }
                        
                        console.log(`ğŸ“¸ æ‰‹åŠ¨å¯¼å…¥ ${photos.length} å¼ ç…§ç‰‡`);
                        replaceUploadedPhotos();
                        
                        // æ˜¾ç¤ºæˆåŠŸæç¤º
                        const toast = document.createElement('div');
                        toast.style.cssText = `
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
                            color: white;
                            padding: 15px 25px;
                            border-radius: 15px;
                            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
                            z-index: 10000;
                            transform: translateX(400px);
                            transition: transform 0.3s ease;
                            font-weight: bold;
                            font-size: 16px;
                        `;
                        toast.textContent = `âœ… æˆåŠŸå¯¼å…¥ ${photos.length} å¼ ç…§ç‰‡ï¼`;
                        document.body.appendChild(toast);
                        
                        setTimeout(() => {
                            toast.style.transform = 'translateX(0)';
                        }, 100);
                        
                        setTimeout(() => {
                            toast.style.transform = 'translateX(400px)';
                            setTimeout(() => {
                                document.body.removeChild(toast);
                            }, 300);
                        }, 3000);
                        
                    } catch (error) {
                        console.error('âŒ å¯¼å…¥ç…§ç‰‡å¤±è´¥:', error);
                        alert('âŒ å¯¼å…¥ç…§ç‰‡å¤±è´¥ï¼\n\nè¯·æ£€æŸ¥ç…§ç‰‡æ•°æ®æ˜¯å¦æ­£ç¡®ã€‚');
                    }
                });
            }
        }
        
        // ===== æ›¿æ¢ä¸Šä¼ çš„ç…§ç‰‡ =====
        function replaceUploadedPhotos() {
            console.log('ğŸ”„ å¼€å§‹æ‰§è¡Œç…§ç‰‡æ›¿æ¢åŠŸèƒ½...');
            
            try {
                // ä»localStorageè·å–ä¸Šä¼ çš„ç…§ç‰‡
                const uploadedPhotos = localStorage.getItem('birthdayPersonPhotos');
                if (!uploadedPhotos) {
                    console.log('âŒ æ²¡æœ‰æ‰¾åˆ°ä¸Šä¼ çš„ç…§ç‰‡');
                    return;
                }
                
                const photos = JSON.parse(uploadedPhotos);
                if (!photos || photos.length === 0) {
                    console.log('âŒ ç…§ç‰‡æ•°æ®ä¸ºç©º');
                    return;
                }
                
                console.log(`âœ… æ‰¾åˆ° ${photos.length} å¼ ä¸Šä¼ çš„ç…§ç‰‡:`, photos.map(p => p.name));
                
                // å¤šæ¬¡å°è¯•æ›¿æ¢æœ€åä¸€ä¸ªé¡µé¢çš„å›¾ç‰‡
                const attempts = [1000, 3000, 5000];
                
                attempts.forEach((delay, attemptIndex) => {
                    setTimeout(() => {
                        console.log(`ğŸ”„ ç¬¬ ${attemptIndex + 1} æ¬¡å°è¯•æ›¿æ¢æœ€åä¸€ä¸ªé¡µé¢çš„ç…§ç‰‡...`);
                        
                        // æŸ¥æ‰¾æ‰€æœ‰imgå…ƒç´ 
                        const allImages = document.querySelectorAll('img');
                        console.log(`ğŸ“¸ é¡µé¢ä¸­å…±æ‰¾åˆ° ${allImages.length} ä¸ªimgå…ƒç´ `);
                        
                        // ç­›é€‰å‡ºæœ€åä¸€ä¸ªé¡µé¢çš„å›¾ç‰‡ï¼ˆé€šè¿‡srcåŒ…å«1.jpg-9.jpgï¼‰
                        const targetImages = [];
                        for (let i = 1; i <= 9; i++) {
                            const img = Array.from(allImages).find(img => 
                                img.src && (
                                    img.src.includes(`${i}.jpg`) || 
                                    img.src.endsWith(`${i}.jpg`) ||
                                    img.getAttribute('src')?.includes(`${i}.jpg`)
                                )
                            );
                            if (img) {
                                targetImages.push(img);
                                console.log(`ğŸ¯ æ‰¾åˆ°ç¬¬ ${i} å¼ å›¾ç‰‡:`, img.src.substring(0, 100) + '...');
                            }
                        }
                        
                        console.log(`ğŸ¯ æ€»å…±æ‰¾åˆ° ${targetImages.length} ä¸ªç›®æ ‡å›¾ç‰‡å…ƒç´ `);
                        
                        // æ›¿æ¢å›¾ç‰‡
                        let replacedCount = 0;
                        photos.forEach((photo, index) => {
                            if (index < targetImages.length) {
                                const targetImg = targetImages[index];
                                if (targetImg) {
                                    console.log(`ğŸ”„ æ­£åœ¨æ›¿æ¢ç¬¬ ${index + 1} å¼ å›¾ç‰‡: ${photo.name}`);
                                    console.log(`ğŸ“¤ åŸå§‹src: ${targetImg.src.substring(0, 100)}...`);
                                    console.log(`ğŸ“¥ æ–°src: ${photo.src.substring(0, 100)}...`);
    
                                    // ä¿å­˜åŸå§‹srcä½œä¸ºå¤‡ä»½
                                    const originalSrc = targetImg.src;
    
                                    // æ›¿æ¢src
                                    targetImg.src = photo.src;
                                    targetImg.setAttribute('data-original-src', originalSrc);
                                    targetImg.setAttribute('data-uploaded-photo', 'true');
                                    targetImg.setAttribute('data-filename', photo.name);
                                    targetImg.setAttribute('data-index', index + 1);
    
                                    // å¼ºåˆ¶é‡æ–°åŠ è½½å›¾ç‰‡
                                    targetImg.style.display = 'none';
                                    setTimeout(() => {
                                        targetImg.style.display = '';
                                    }, 100);
    
                                    replacedCount++;
    
                                    // æ·»åŠ åŠ è½½äº‹ä»¶
                                    targetImg.onload = function() {
                                        console.log(`âœ… ç¬¬ ${index + 1} å¼ å›¾ç‰‡æ›¿æ¢æˆåŠŸ: ${photo.name}`);
                                    };
                                    targetImg.onerror = function() {
                                        console.error(`âŒ ç¬¬ ${index + 1} å¼ å›¾ç‰‡åŠ è½½å¤±è´¥: ${photo.name}`);
                                        // å¦‚æœå¤±è´¥ï¼Œå°è¯•æ¢å¤åŸå›¾
                                        setTimeout(() => {
                                            targetImg.src = originalSrc;
                                        }, 1000);
                                    };
                                } else {
                                    console.warn(`âš ï¸ æœªæ‰¾åˆ°ç¬¬ ${index + 1} å¼ å›¾ç‰‡å…ƒç´ `);
                                }
                            }
                        });
                        
                        console.log(`ğŸ‰ ç¬¬ ${attemptIndex + 1} æ¬¡å°è¯•å®Œæˆï¼ŒæˆåŠŸæ›¿æ¢ ${replacedCount} å¼ ç…§ç‰‡`);
                        
                    }, delay);
                });
                
            } catch (error) {
                console.error('âŒ æ›¿æ¢ç…§ç‰‡æ—¶å‡ºé”™:', error);
            }
        }
        

        
        // çˆ±å¿ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶å¤„ç†
        function setupLoveButton() {
            const loveButton = document.getElementById('love-button');
            if (loveButton && !loveButton.hasAttribute('data-click-setup')) {
                console.log('è®¾ç½®çˆ±å¿ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                loveButton.setAttribute('data-click-setup', 'true');
                
                loveButton.addEventListener('click', function(e) {
                    console.log('çˆ±å¿ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶è§¦å‘ï¼');
                    
                    // åˆ›å»ºçˆ±å¿ƒé£˜æ•£æ•ˆæœ
                    createHeartExplosion(e.clientX, e.clientY);
                    
                    // æ˜¾ç¤ºçˆ±æ„æ¶ˆæ¯
                    showLoveMessage();
                    
                    // ä¸‹è½½ç”Ÿæ—¥æµ·æŠ¥
                    downloadBirthdayPoster();
                    
                }, { once: false });
                
                console.log('çˆ±å¿ƒæŒ‰é’®äº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®');
            }
        }
        
        // åˆ›å»ºçˆ±å¿ƒé£˜æ•£æ•ˆæœ
        function createHeartExplosion(x, y) {
            for (let i = 0; i < 15; i++) {
                const heart = document.createElement('div');
                heart.innerHTML = 'â¤ï¸';
                heart.style.cssText = `
                    position: fixed;
                    left: ${x}px;
                    top: ${y}px;
                    font-size: ${15 + Math.random() * 20}px;
                    pointer-events: none;
                    z-index: 10000;
                    animation: heartFloat ${2 + Math.random() * 2}s ease-out forwards;
                `;
                
                document.body.appendChild(heart);
                
                // è®¾ç½®é£˜æ•£æ–¹å‘
                setTimeout(() => {
                    const angle = (Math.PI * 2 * i) / 15;
                    const velocity = 100 + Math.random() * 150;
                    heart.style.transform = `translate(${Math.cos(angle) * velocity}px, ${Math.sin(angle) * velocity - 100}px) scale(0)`;
                    heart.style.opacity = '0';
                }, 10);
                
                // ç§»é™¤çˆ±å¿ƒå…ƒç´ 
                setTimeout(() => {
                    if (heart.parentElement) {
                        heart.remove();
                    }
                }, 3000);
            }
        }
        
        // æ˜¾ç¤ºçˆ±æ„æ¶ˆæ¯
        function showLoveMessage() {
            const messages = [
                "çˆ±ä½ å“Ÿï¼ğŸ’•",
                "ä½ æ˜¯æœ€æ£’çš„ï¼ğŸŒŸ",
                "æ°¸è¿œçˆ±ä½ ï¼ğŸ’",
                "ä½ æ˜¯æˆ‘çš„å°å®è´ï¼ğŸ€",
                "çˆ±ä½ ç›´åˆ°æ°¸è¿œï¼ğŸ’–"
            ];
            
            const message = messages[Math.floor(Math.random() * messages.length)];
            
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            messageDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(0);
                background: linear-gradient(135deg, #ff69b4, #ff1493);
                color: white;
                padding: 20px 40px;
                border-radius: 25px;
                font-size: 24px;
                font-weight: bold;
                font-family: 'Comic Neue', 'Kalam', cursive;
                box-shadow: 0 10px 30px rgba(255, 105, 180, 0.4);
                z-index: 10001;
                animation: messagePopup 2s ease-out forwards;
            `;
            
            document.body.appendChild(messageDiv);
            
            // ç§»é™¤æ¶ˆæ¯
            setTimeout(() => {
                if (messageDiv.parentElement) {
                    messageDiv.remove();
                }
            }, 2000);
        }
        
        // ä¸‹è½½ç”Ÿæ—¥æµ·æŠ¥åŠŸèƒ½
        function downloadBirthdayPoster() {
            console.log('å¼€å§‹ç”Ÿæˆç”Ÿæ—¥æµ·æŠ¥...');
            
            // åˆ›å»ºcanvas
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // è®¾ç½®æµ·æŠ¥å°ºå¯¸ (A4æ¯”ä¾‹)
            canvas.width = 1200;
            canvas.height = 1600;
            
            // èƒŒæ™¯æ¸å˜
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#ffe4e1');
            gradient.addColorStop(0.5, '#ffc0cb');
            gradient.addColorStop(1, '#ffb6c1');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // æ·»åŠ è£…é¥°è¾¹æ¡†
            ctx.strokeStyle = '#ff69b4';
            ctx.lineWidth = 8;
            ctx.setLineDash([20, 10]);
            ctx.strokeRect(40, 40, canvas.width - 80, canvas.height - 80);
            ctx.setLineDash([]);
            
            // åŠ è½½å¹¶ç»˜åˆ¶8å¼ å›¾ç‰‡ (3x3ç½‘æ ¼ï¼Œä¸­é—´ç•™ç©º)
            const imageFiles = ['1.jpg', '2.jpg', '3.jpg', '4.jpg', '5.jpg', '6.jpg', '7.jpg', '8.jpg'];
            const positions = [
                {x: 100, y: 100}, {x: 450, y: 100}, {x: 800, y: 100},  // ç¬¬ä¸€è¡Œ
                {x: 100, y: 450}, {x: 800, y: 450},                    // ç¬¬äºŒè¡Œï¼ˆä¸­é—´ç•™ç©ºï¼‰
                {x: 100, y: 800}, {x: 450, y: 800}, {x: 800, y: 800}   // ç¬¬ä¸‰è¡Œ
            ];
            
            let loadedImages = 0;
            const images = [];
            
            // åŠ è½½æ‰€æœ‰å›¾ç‰‡
            imageFiles.forEach((fileName, index) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                
                img.onload = function() {
                    images[index] = img;
                    loadedImages++;
                    
                    if (loadedImages === imageFiles.length) {
                        // æ‰€æœ‰å›¾ç‰‡åŠ è½½å®Œæˆï¼Œå¼€å§‹ç»˜åˆ¶
                        drawPoster();
                    }
                };
                
                img.onerror = function() {
                    console.log(`å›¾ç‰‡ ${fileName} åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å ä½ç¬¦`);
                    // åˆ›å»ºå ä½ç¬¦å›¾ç‰‡
                    const placeholderCanvas = document.createElement('canvas');
                    placeholderCanvas.width = 300;
                    placeholderCanvas.height = 300;
                    const pCtx = placeholderCanvas.getContext('2d');
                    
                    // ç»˜åˆ¶å ä½ç¬¦èƒŒæ™¯
                    pCtx.fillStyle = '#ffb6c1';
                    pCtx.fillRect(0, 0, 300, 300);
                    
                    // æ·»åŠ æ–‡å­—
                    pCtx.fillStyle = '#ff1493';
                    pCtx.font = 'bold 20px Arial';
                    pCtx.textAlign = 'center';
                    pCtx.textBaseline = 'middle';
                    pCtx.fillText('å›¾ç‰‡' + (index + 1), 150, 150);
                    
                    images[index] = placeholderCanvas;
                    loadedImages++;
                    
                    if (loadedImages === imageFiles.length) {
                        drawPoster();
                    }
                };
                
                img.src = fileName;
            });
            
            function drawPoster() {
                // ç»˜åˆ¶å›¾ç‰‡
                positions.forEach((pos, index) => {
                    if (images[index]) {
                        // æ·»åŠ å›¾ç‰‡é˜´å½±
                        ctx.shadowColor = 'rgba(255, 105, 180, 0.3)';
                        ctx.shadowBlur = 15;
                        ctx.shadowOffsetX = 5;
                        ctx.shadowOffsetY = 5;
                        
                        // ç»˜åˆ¶åœ†è§’çŸ©å½¢å›¾ç‰‡
                        ctx.save();
                        roundRect(ctx, pos.x, pos.y, 300, 300, 20);
                        ctx.clip();
                        ctx.drawImage(images[index], pos.x, pos.y, 300, 300);
                        ctx.restore();
                        
                        // é‡ç½®é˜´å½±
                        ctx.shadowColor = 'transparent';
                        ctx.shadowBlur = 0;
                        ctx.shadowOffsetX = 0;
                        ctx.shadowOffsetY = 0;
                    }
                });
                
                // ä¸­é—´åŒºåŸŸç»˜åˆ¶ç”Ÿæ—¥ç¥ç¦
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                // ç»˜åˆ¶è£…é¥°åœ†å½¢èƒŒæ™¯
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                roundRect(ctx, centerX - 200, centerY - 150, 400, 300, 30);
                ctx.fill();
                
                // æ·»åŠ è¾¹æ¡†
                ctx.strokeStyle = '#ff69b4';
                ctx.lineWidth = 3;
                roundRect(ctx, centerX - 200, centerY - 150, 400, 300, 30);
                ctx.stroke();
                
                // ç»˜åˆ¶ç”Ÿæ—¥ç¥ç¦æ–‡å­—
                ctx.fillStyle = '#ff1493';
                ctx.font = 'bold 48px "Comic Neue", cursive';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // æ·»åŠ æ–‡å­—é˜´å½±
                ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                ctx.shadowBlur = 4;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                
                ctx.fillText('ç”Ÿæ—¥å¿«ä¹ï¼', centerX, centerY - 50);
                
                ctx.font = 'bold 32px "Comic Neue", cursive';
                ctx.fillStyle = '#ff69b4';
                ctx.fillText('æ„¿ä½ æ°¸è¿œå¿«ä¹ï¼', centerX, centerY + 20);
                
                ctx.font = '24px "Comic Neue", cursive';
                ctx.fillStyle = '#ff85a2';
                ctx.fillText('â€”â€” çˆ±ä½ çš„æˆ‘ â¤ï¸', centerX, centerY + 80);
                
                // æ·»åŠ æ—¥æœŸ
                const currentDate = new Date();
                const dateStr = `${currentDate.getFullYear()}å¹´${currentDate.getMonth() + 1}æœˆ${currentDate.getDate()}æ—¥`;
                
                ctx.font = 'bold 28px "Comic Neue", cursive';
                ctx.fillStyle = '#ff69b4';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // æ·»åŠ æ—¥æœŸé˜´å½±
                ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                ctx.shadowBlur = 3;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;
                
                ctx.fillText(dateStr, centerX, centerY + 120);
                
                // é‡ç½®é˜´å½±
                ctx.shadowColor = 'transparent';
                ctx.shadowBlur = 0;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;
                
                // æ·»åŠ è£…é¥°å…ƒç´ 
                drawDecorations(ctx, canvas.width, canvas.height);
                
                // ä¸‹è½½æµ·æŠ¥
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'ç”Ÿæ—¥ç¥ç¦æµ·æŠ¥_' + new Date().getTime() + '.jpg';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    console.log('æµ·æŠ¥ä¸‹è½½å®Œæˆï¼');
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    showDownloadSuccess();
                }, 'image/jpeg', 0.9);
            }
            
            function roundRect(ctx, x, y, width, height, radius) {
                ctx.beginPath();
                ctx.moveTo(x + radius, y);
                ctx.lineTo(x + width - radius, y);
                ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
                ctx.lineTo(x + width, y + height - radius);
                ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                ctx.lineTo(x + radius, y + height);
                ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
                ctx.lineTo(x, y + radius);
                ctx.quadraticCurveTo(x, y, x + radius, y);
                ctx.closePath();
            }
            
            function drawDecorations(ctx, width, height) {
                // ç»˜åˆ¶è£…é¥°çˆ±å¿ƒ
                const hearts = [
                    {x: 80, y: 80, size: 20},
                    {x: width - 80, y: 80, size: 20},
                    {x: 80, y: height - 80, size: 20},
                    {x: width - 80, y: height - 80, size: 20},
                    {x: 200, y: 200, size: 15},
                    {x: width - 200, y: 200, size: 15},
                    {x: 200, y: height - 200, size: 15},
                    {x: width - 200, y: height - 200, size: 15}
                ];
                
                ctx.fillStyle = 'rgba(255, 105, 180, 0.6)';
                hearts.forEach(heart => {
                    drawHeart(ctx, heart.x, heart.y, heart.size);
                });
                
                // ç»˜åˆ¶è£…é¥°æ˜Ÿæ˜Ÿ
                const stars = [
                    {x: 150, y: 150}, {x: width - 150, y: 150},
                    {x: 150, y: height - 150}, {x: width - 150, y: height - 150}
                ];
                
                ctx.fillStyle = 'rgba(255, 215, 0, 0.6)';
                stars.forEach(star => {
                    drawStar(ctx, star.x, star.y, 15);
                });
            }
            
            function drawHeart(ctx, x, y, size) {
                ctx.save();
                ctx.translate(x, y);
                ctx.scale(size / 20, size / 20);
                ctx.beginPath();
                ctx.moveTo(0, -8);
                ctx.bezierCurveTo(-8, -16, -16, -8, -16, 0);
                ctx.bezierCurveTo(-16, 8, -8, 16, 0, 20);
                ctx.bezierCurveTo(8, 16, 16, 8, 16, 0);
                ctx.bezierCurveTo(16, -8, 8, -16, 0, -8);
                ctx.fill();
                ctx.restore();
            }
            
            function drawStar(ctx, x, y, size) {
                ctx.save();
                ctx.translate(x, y);
                ctx.beginPath();
                for (let i = 0; i < 5; i++) {
                    const angle = (i * 4 * Math.PI) / 5 - Math.PI / 2;
                    const innerAngle = ((i * 4 + 2) * Math.PI) / 5 - Math.PI / 2;
                    
                    if (i === 0) {
                        ctx.moveTo(Math.cos(angle) * size, Math.sin(angle) * size);
                    } else {
                        ctx.lineTo(Math.cos(angle) * size, Math.sin(angle) * size);
                    }
                    ctx.lineTo(Math.cos(innerAngle) * (size / 2), Math.sin(innerAngle) * (size / 2));
                }
                ctx.closePath();
                ctx.fill();
                ctx.restore();
            }
        }
        
        // æ˜¾ç¤ºä¸‹è½½æˆåŠŸæç¤º
        function showDownloadSuccess() {
            const successDiv = document.createElement('div');
            successDiv.textContent = 'ğŸ‰ ç”Ÿæ—¥æµ·æŠ¥å·²ä¸‹è½½ï¼';
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #4CAF50, #45a049);
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 18px;
                font-weight: bold;
                font-family: 'Comic Neue', 'Kalam', cursive;
                box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
                z-index: 10002;
                animation: slideInRight 0.5s ease-out, slideOutRight 0.5s ease-out 2.5s forwards;
            `;
            
            document.body.appendChild(successDiv);
            
            // æ·»åŠ åŠ¨ç”»æ ·å¼
            if (!document.querySelector('#download-success-style')) {
                const style = document.createElement('style');
                style.id = 'download-success-style';
                style.textContent = `
                    @keyframes slideInRight {
                        0% {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        100% {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                    
                    @keyframes slideOutRight {
                        0% {
                            transform: translateX(0);
                            opacity: 1;
                        }
                        100% {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // ç§»é™¤æç¤º
            setTimeout(() => {
                if (successDiv.parentElement) {
                    successDiv.remove();
                }
            }, 3000);
        }
        
        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes heartFloat {
                0% {
                    opacity: 1;
                    transform: scale(1);
                }
                100% {
                    opacity: 0;
                    transform: scale(0.3);
                }
            }
            
            @keyframes messagePopup {
                0% {
                    transform: translate(-50%, -50%) scale(0);
                    opacity: 0;
                }
                50% {
                    transform: translate(-50%, -50%) scale(1.2);
                    opacity: 1;
                }
                100% {
                    transform: translate(-50%, -50%) scale(1);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
        
        console.log('è„šæœ¬åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>
